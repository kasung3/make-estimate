(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[563],{9402:function(e,t,s){Promise.resolve().then(s.bind(s,6794))},6794:function(e,t,s){"use strict";s.d(t,{BoqEditorClient:function(){return ee}});var a=s(5444),r=s(9300),n=s(9047),l=s(1084),i=s(7367),o=s(2422),c=s(4678),d=s(5522);let m=r.forwardRef(({className:e,...t},s)=>(0,a.jsx)("textarea",{className:(0,d.cn)("flex min-h-[100px] w-full rounded-xl border-2 border-purple-100 bg-white px-4 py-3 text-sm text-foreground transition-all duration-200","placeholder:text-muted-foreground","hover:border-purple-200","focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-muted","resize-none",e),ref:s,...t}));m.displayName="Textarea";var u=s(9827),x=s(4635),h=s(5181),p=s(6167),f=s(489),g=s(9530),y=s(1642);let j=y.zt,b=y.fC,N=y.xz,v=r.forwardRef(({className:e,sideOffset:t=4,...s},r)=>(0,a.jsx)(y.VY,{ref:r,sideOffset:t,className:(0,d.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));v.displayName=y.VY.displayName;var w=s(2358);let C=w.fC,k=w.wy,P=w.Fw;var I=s(7386),D=s(9635),E=s(3485),T=s(7248),S=s(1482),Z=s(563),z=s(6997),F=s(3751),_=s(9429),$=s(8155),O=s(1946),M=s(1117),q=s(6771),R=s(892),U=s(5012),A=s(3324),L=s(8720),B=s(2815),V=s(651),Q=s(4611),K=s(8714),H=s(1036),J=s(4400),Y=s(5185);function G(e){return`${e.grip}px ${e.number}px minmax(200px, 1fr) ${e.unit}px ${e.unitCost}px ${e.markup}px ${e.unitPrice}px ${e.qty}px ${e.amount}px ${e.actions}px`}function W({item:e,itemNumber:t,categoryId:s,categoryName:r,columnWidths:n,getItemValue:l,handleUpdateItem:i,handleDeleteItem:d,openEditItemDialog:u,handleNoteClick:x,inlineEditingNoteId:h,inlineEditText:f,setInlineEditText:g,inlineTextareaRef:y,handleInlineNoteKeyDown:j,saveInlineEdit:b,cancelInlineEdit:N,sanitizeHtml:v,formatNumber:w,formatCurrency:C}){let{attributes:k,listeners:P,setNodeRef:z,setActivatorNodeRef:F,transform:_,transition:$,isDragging:O}=(0,H.nB)({id:e.id}),M={transform:J.ux.Transform.toString(_),transition:$,display:"grid",gridTemplateColumns:G(n)};if(e?.isNote)return(0,a.jsxs)("div",{ref:z,style:M,...k,className:`items-center border-b border-gray-100 bg-amber-50 ${O?"opacity-50 bg-amber-100 shadow-lg z-50":""}`,role:"row",children:[(0,a.jsx)("div",{className:"py-2 px-1 flex items-center justify-center",role:"cell",children:(0,a.jsx)("div",{ref:F,...P,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},children:(0,a.jsx)(I.Z,{className:"w-4 h-4 text-gray-400 pointer-events-none"})})}),(0,a.jsx)("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:(0,a.jsx)(D.Z,{className:"w-4 h-4 text-amber-500"})}),(0,a.jsx)("div",{className:"py-2 px-2",role:"cell",style:{gridColumn:"3 / 10"},children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[h===e.id?(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)(m,{ref:y,value:f,onChange:e=>g(e.target.value),onBlur:()=>b(e.id),onKeyDown:t=>j(t,e.id),className:"min-h-[60px] text-sm resize-none",placeholder:"Enter note text..."}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Basic edit (Ctrl+Enter to save, Esc to cancel). Use expand for formatting."}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsxs)(o.z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-gray-500 hover:text-gray-700",onClick:e=>{e.preventDefault(),N()},children:[(0,a.jsx)(E.Z,{className:"w-3 h-3 mr-1"}),"Cancel"]}),(0,a.jsxs)(o.z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-cyan-600 hover:text-cyan-700",onClick:t=>{t.preventDefault(),b(e.id)},children:[(0,a.jsx)(T.Z,{className:"w-3 h-3 mr-1"}),"Save"]})]})]})]}):(0,a.jsx)("div",{className:"flex-1 min-h-[32px] px-3 py-1.5 bg-white border rounded-lg text-sm cursor-text hover:border-cyan-400 transition-colors",onClick:()=>x(e,s,r,l(e.id,"noteContent",e?.noteContent)??""),title:"Click to edit",children:l(e.id,"noteContent",e?.noteContent)?(0,a.jsx)("div",{className:"prose prose-sm max-w-none [&_strong]:font-bold [&_b]:font-bold [&_em]:italic [&_i]:italic [&_u]:underline",dangerouslySetInnerHTML:{__html:v(l(e.id,"noteContent",e?.noteContent)??"")}}):(0,a.jsx)("span",{className:"text-gray-400",children:"Click to add note..."})}),(0,a.jsx)(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-cyan-600 flex-shrink-0",onClick:()=>u(e,s,r,null),title:"Edit note with formatting (B/I/U)",children:(0,a.jsx)(S.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(p.X,{id:`pdf-${e.id}`,checked:l(e.id,"includeInPdf",e?.includeInPdf)??!0,onCheckedChange:t=>i(e?.id,{includeInPdf:t},!0)}),(0,a.jsx)("label",{htmlFor:`pdf-${e.id}`,className:"text-xs text-gray-500",children:"Include in PDF"})]})})]})}),(0,a.jsx)("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:(0,a.jsx)(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-500",onClick:()=>d(e?.id),children:(0,a.jsx)(Z.Z,{className:"w-4 h-4"})})})]});let q=l(e.id,"unitCost",e?.unitCost)??0,R=l(e.id,"markupPct",e?.markupPct)??0,U=l(e.id,"quantity",e?.quantity)??0,A=q*(1+R/100);return(0,a.jsxs)("div",{ref:z,style:M,...k,className:`items-center border-b border-gray-100 hover:bg-gray-50 ${O?"opacity-50 bg-gray-100 shadow-lg z-50":""}`,role:"row",children:[(0,a.jsx)("div",{className:"py-2 px-1 flex items-center justify-center",role:"cell",children:(0,a.jsx)("div",{ref:F,...P,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},children:(0,a.jsx)(I.Z,{className:"w-4 h-4 text-gray-400 pointer-events-none"})})}),(0,a.jsx)("div",{className:"py-2 px-2 text-gray-500 text-sm",role:"cell",children:t}),(0,a.jsx)("div",{className:"py-2 px-2 min-w-0",role:"cell",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c.I,{value:l(e.id,"description",e?.description)??"",onChange:t=>i(e?.id,{description:t.target.value}),className:"h-8 text-sm w-full",placeholder:"Description"}),(0,a.jsx)(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-cyan-600 flex-shrink-0",onClick:()=>u(e,s,r,t),title:"Expand to edit",children:(0,a.jsx)(S.Z,{className:"w-4 h-4"})})]})}),(0,a.jsx)("div",{className:"py-2 px-2",role:"cell",children:(0,a.jsx)(c.I,{value:l(e.id,"unit",e?.unit)??"",onChange:t=>i(e?.id,{unit:t.target.value}),className:"h-8 text-sm w-full",placeholder:"Unit"})}),(0,a.jsx)("div",{className:"py-2 px-2",role:"cell",children:(0,a.jsx)(c.I,{type:"number",step:"0.01",value:q,onChange:t=>i(e?.id,{unitCost:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),(0,a.jsx)("div",{className:"py-2 px-2",role:"cell",children:(0,a.jsx)(c.I,{type:"number",step:"0.01",value:R,onChange:t=>i(e?.id,{markupPct:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),(0,a.jsx)("div",{className:"py-2 px-2 text-right font-medium text-gray-700 text-sm whitespace-nowrap",role:"cell",children:w(A)}),(0,a.jsx)("div",{className:"py-2 px-2",role:"cell",children:(0,a.jsx)(c.I,{type:"number",step:"0.01",value:U,onChange:t=>i(e?.id,{quantity:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),(0,a.jsx)("div",{className:"py-2 px-2 text-right font-semibold text-cyan-600 text-sm whitespace-nowrap",role:"cell",children:C(A*U)}),(0,a.jsx)("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:(0,a.jsx)(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-500",onClick:()=>d(e?.id),children:(0,a.jsx)(Z.Z,{className:"w-4 h-4"})})})]})}function X({category:e,categoryIndex:t,isExpanded:s,toggleCategory:n,getCategoryName:l,handleUpdateCategory:i,handleDeleteCategory:d,handleAddItem:m,formatCurrency:x,getCategorySubtotal:h,columnWidths:p,handleResizeStart:f,sensors:g,getItemNumber:y,handleItemDragStart:j,handleItemDragEnd:b,getItemValue:N,handleUpdateItem:v,handleDeleteItem:w,openEditItemDialog:E,handleNoteClick:T,inlineEditingNoteId:S,inlineEditText:$,setInlineEditText:O,inlineTextareaRef:M,handleInlineNoteKeyDown:q,saveInlineEdit:R,cancelInlineEdit:U,sanitizeHtml:A,formatNumber:L,itemLimit:B,currentItemCount:V,isAtItemLimit:Q,planKey:X}){let{attributes:ee,listeners:et,setNodeRef:es,setActivatorNodeRef:ea,transform:er,transition:en,isDragging:el}=(0,H.nB)({id:e.id}),ei={transform:J.ux.Transform.toString(er),transition:en},eo=(0,r.useMemo)(()=>(e?.items??[]).map(e=>e?.id),[e?.items]);return(0,a.jsx)("div",{ref:es,style:ei,...ee,className:el?"opacity-50":"",children:(0,a.jsx)(u.Zb,{className:`shadow-md border-0 overflow-hidden transition-shadow ${el?"shadow-xl ring-2 ring-cyan-400":""}`,children:(0,a.jsxs)(C,{open:s,onOpenChange:()=>n(e?.id),children:[(0,a.jsx)(k,{asChild:!0,children:(0,a.jsx)(u.Ol,{className:"cursor-pointer hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[(0,a.jsx)("div",{ref:ea,...et,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},onClick:e=>e.stopPropagation(),children:(0,a.jsx)(I.Z,{className:"w-5 h-5 text-gray-400 flex-shrink-0 pointer-events-none"})}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-500 flex-shrink-0",children:[t+1,"."]}),(0,a.jsx)(c.I,{value:l(e),onChange:t=>{t.stopPropagation(),i(e?.id,t.target.value)},onClick:e=>e.stopPropagation(),className:"text-lg font-semibold border-0 p-0 h-auto focus-visible:ring-0 bg-transparent flex-1 min-w-0"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 flex-shrink-0",children:["(",(e?.items??[]).filter(e=>!e?.isNote).length," items)"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[(0,a.jsx)("span",{className:"text-lg font-semibold text-cyan-600",children:x(h(e))}),(0,a.jsx)(o.z,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-red-500",onClick:t=>{t.stopPropagation(),d(e?.id)},children:(0,a.jsx)(Z.Z,{className:"w-4 h-4"})}),s?(0,a.jsx)(z.Z,{className:"w-5 h-5 text-gray-400"}):(0,a.jsx)(F.Z,{className:"w-5 h-5 text-gray-400"})]})]})})}),(0,a.jsx)(P,{children:(0,a.jsxs)(u.aY,{className:"pt-0",children:[(0,a.jsx)(K.LB,{sensors:g,collisionDetection:K.pE,onDragStart:j,onDragEnd:t=>b(t,e.id),modifiers:[Y.DL],children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("div",{className:"text-sm flex flex-col",role:"table",style:{minWidth:"900px"},children:[(0,a.jsxs)("div",{role:"row",style:{display:"grid",gridTemplateColumns:G(p)},children:[(0,a.jsx)("div",{className:"py-2 px-1 font-medium text-gray-500 border-b border-gray-200",role:"columnheader"}),(0,a.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["#",(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"number")})]}),(0,a.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Description",(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"description")})]}),(0,a.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit",(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unit")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit Cost",(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unitCost")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Markup %",(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"markup")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit Price",(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unitPrice")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Qty",(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"qty")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Amount",(0,a.jsx)("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"amount")})]}),(0,a.jsx)("div",{className:"border-b border-gray-200",role:"columnheader"})]}),(0,a.jsx)(H.Fo,{items:eo,strategy:H.qw,children:(e?.items??[]).map((s,r)=>(0,a.jsx)(W,{item:s,itemNumber:y(t,e?.items??[],r),categoryId:e.id,categoryName:e.name??"",columnWidths:p,getItemValue:N,handleUpdateItem:v,handleDeleteItem:w,openEditItemDialog:E,handleNoteClick:T,inlineEditingNoteId:S,inlineEditText:$,setInlineEditText:O,inlineTextareaRef:M,handleInlineNoteKeyDown:q,saveInlineEdit:R,cancelInlineEdit:U,sanitizeHtml:A,formatNumber:L,formatCurrency:x},s?.id))})]})})}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2 mt-3",children:[Q&&(0,a.jsxs)("div",{className:"text-xs text-amber-600 bg-amber-50 px-3 py-2 rounded-md border border-amber-200",children:["Item limit reached (",V,"/",B,").",(0,a.jsx)("a",{href:"/pricing",className:"ml-1 underline hover:text-amber-700",children:"Upgrade"})," to add more items."]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(o.z,{variant:"ghost",className:`flex-1 ${Q?"text-gray-400 cursor-not-allowed":"text-cyan-600 hover:text-cyan-700 hover:bg-cyan-50"}`,onClick:()=>m(e?.id,!1),disabled:Q,children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),"Add Item ",null!==B&&`(${V}/${B})`]}),(0,a.jsxs)(o.z,{variant:"ghost",className:"text-amber-600 hover:text-amber-700 hover:bg-amber-50",onClick:()=>m(e?.id,!0),children:[(0,a.jsx)(D.Z,{className:"w-4 h-4 mr-2"}),"Add Note"]})]})]})]})})]})})})}function ee({boq:e,customers:t,company:s,coverTemplates:d,pdfThemes:y}){let w=(0,n.useRouter)(),[C,k]=(0,r.useState)(e),[P,I]=(0,r.useState)(t??[]),[D,E]=(0,r.useState)(d??[]),[S,Z]=(0,r.useState)(y??[]),[z,F]=(0,r.useState)(new Set((e?.categories??[]).map(e=>e?.id))),[J,G]=(0,r.useState)(!1),[W,ee]=(0,r.useState)(null),[et,es]=(0,r.useState)(!1),[ea,er]=(0,r.useState)(""),[en,el]=(0,r.useState)(""),[ei,eo]=(0,r.useState)(""),[ec,ed]=(0,r.useState)(!1),[em,eu]=(0,r.useState)(null),[ex,eh]=(0,r.useState)(null),[ep,ef]=(0,r.useState)(null),[eg,ey]=(0,r.useState)({}),ej=(0,r.useRef)(null),eb=(0,r.useRef)(null),[eN,ev]=(0,r.useState)(null),[ew,eC]=(0,r.useState)(""),ek=(0,r.useRef)(null),[eP,eI]=(0,r.useState)(e?.projectName??""),[eD,eE]=(0,r.useState)({}),[eT,eS]=(0,r.useState)({}),eZ={grip:32,number:52,description:280,unit:80,unitCost:100,markup:80,unitPrice:100,qty:70,amount:130,actions:44},[ez,eF]=(0,r.useState)(eZ),[e_,e$]=(0,r.useState)(null),eO=(0,r.useRef)(0),eM=(0,r.useRef)(0),eq=(0,r.useRef)(null),eR=(0,r.useRef)({}),eU=s?.currencySymbol??"Rs.",eA=s?.currencyPosition??"left",eL=(0,r.useCallback)(e=>{if(!e)return"";let t=document.createElement("div");t.innerHTML=e;let s=["strong","b","em","i","u","p","br","ul","ol","li","span"];return t.querySelectorAll("script").forEach(e=>e.remove()),t.querySelectorAll("*").forEach(e=>{let t=e.tagName.toLowerCase();if(!s.includes(t)){let t=e.parentNode;for(;e.firstChild;)t?.insertBefore(e.firstChild,e);e.remove();return}Array.from(e.attributes).forEach(t=>{e.removeAttribute(t.name)})}),t.innerHTML},[]),eB=(0,r.useCallback)(e=>!!e&&!!(RegExp("<(strong|b|em|i|u|ul|ol|li|h1|h2|h3|h4|h5|h6|blockquote|code|pre)(\\s[^>]*)?>","i").test(e)||/<span\s+[^>]*style\s*=/i.test(e)||/<[^>]+\s+style\s*=/i.test(e)),[]),eV=(0,r.useCallback)(e=>{if(!e)return"";let t=document.createElement("div");return t.innerHTML=e,t.innerHTML=t.innerHTML.replace(/<br\s*\/?>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<p>/gi,""),t.textContent||t.innerText||""},[]),eQ=(0,r.useCallback)(e=>e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>"):"",[]),eK=(0,r.useCallback)((e,t=2)=>e.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t}),[]),eH=(0,r.useCallback)(e=>{let t=eK(e??0,2);return"left"===eA?`${eU} ${t}`:`${t} ${eU}`},[eU,eA,eK]),eJ=(0,r.useCallback)(()=>{let e=0,t=0;(C?.categories??[]).forEach(s=>{(s?.items??[]).forEach(s=>{if(s?.isNote)return;let a=s?.quantity??0;if(a>0){let r=(s?.unitCost??0)*(1+(s?.markupPct??0)/100);e+=r*a,t+=(s?.unitCost??0)*a}})});let s=0;C?.discountEnabled&&(s=C?.discountType==="percent"?(C?.discountValue??0)/100*e:C?.discountValue??0);let a=e-s,r=C?.vatEnabled?(C?.vatPercent??0)/100*a:0,n=a-t;return{subtotal:Math.round(100*e)/100,discount:Math.round(100*s)/100,vatAmount:Math.round(100*r)/100,finalTotal:Math.round(100*(a+r))/100,totalCost:Math.round(100*t)/100,priceAfterDiscount:Math.round(100*a)/100,profit:Math.round(100*n)/100,grossProfitPct:Math.round(100*(a>0?n/a*100:0))/100}},[C])(),eY=(0,r.useRef)(null),eG=(0,r.useCallback)(async()=>{G(!0);try{await fetch(`/api/boqs/${C?.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectName:C?.projectName,customerId:C?.customerId,coverTemplateId:C?.coverTemplateId,pdfThemeId:C?.pdfThemeId,dateMode:C?.dateMode,preparationDate:C?.preparationDate,discountEnabled:C?.discountEnabled,discountType:C?.discountType,discountValue:C?.discountValue,vatEnabled:C?.vatEnabled,vatPercent:C?.vatPercent,status:C?.status})}),ee(new Date)}catch(e){console.error("Autosave failed:",e)}finally{G(!1)}},[C]),eW=(0,r.useCallback)(()=>{eq.current&&clearTimeout(eq.current),eq.current=setTimeout(()=>{eY.current=eG()},1500)},[eG]),eX=(0,r.useCallback)(async()=>{eq.current&&(clearTimeout(eq.current),eq.current=null),eY.current&&await eY.current,await eG()},[eG]);(0,r.useEffect)(()=>()=>{eq.current&&clearTimeout(eq.current),Object.values(eR.current).forEach(clearTimeout)},[]),(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/billing/status");if(e.ok){let t=await e.json();eu(t.boqItemsLimit??null),eh(t.planKey??null)}}catch(e){console.error("Failed to fetch billing status:",e)}})()},[]);let e0=(0,r.useMemo)(()=>C?.categories?C.categories.reduce((e,t)=>t?.items?e+t.items.filter(e=>!e?.isNote).length:e,0):0,[C?.categories]),e2=null!==em&&e0>=em;(0,r.useEffect)(()=>{eI(C?.projectName??"")},[C?.projectName]),(0,r.useEffect)(()=>{try{let e=localStorage.getItem("boq_column_widths");if(e){let t=JSON.parse(e);eF(e=>({...e,...t}))}}catch(e){}},[]);let e1=(0,r.useCallback)(e=>{try{localStorage.setItem("boq_column_widths",JSON.stringify(e))}catch(e){}},[]),e4=(0,r.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),e$(t),eO.current=e.clientX,eM.current=ez[t]},[ez]),e5=(0,r.useCallback)(e=>{if(!e_)return;let t=e.clientX-eO.current,s=Math.max(40,eM.current+t);eF(e=>({...e,[e_]:s}))},[e_]),e3=(0,r.useCallback)(()=>{e_&&e1(ez),e$(null)},[e_,ez,e1]);(0,r.useEffect)(()=>(e_?(document.addEventListener("mousemove",e5),document.addEventListener("mouseup",e3),document.body.style.cursor="col-resize",document.body.style.userSelect="none"):(document.body.style.cursor="",document.body.style.userSelect=""),()=>{document.removeEventListener("mousemove",e5),document.removeEventListener("mouseup",e3),document.body.style.cursor="",document.body.style.userSelect=""}),[e_,e5,e3]);let e8=(0,r.useCallback)(()=>{eF(eZ);try{localStorage.removeItem("boq_column_widths")}catch(e){}Q.ZP.success("Column widths reset to default")},[]),e6=e=>{k(t=>({...t??{},...e})),eW()},e7=e=>{eI(e),eR.current.projectName&&clearTimeout(eR.current.projectName),eR.current.projectName=setTimeout(()=>{e6({projectName:e})},500)},e9=async()=>{try{let e=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({boqId:C?.id,name:"New Category",sortOrder:C?.categories?.length??0})}),t=await e.json();k(e=>({...e??{},categories:[...e?.categories??[],{...t,items:[]}]})),F(e=>new Set([...e,t?.id]))}catch(e){Q.ZP.error("Failed to add category")}},te=async(e,t)=>{eE(s=>({...s,[e]:t})),eR.current[`cat_${e}`]&&clearTimeout(eR.current[`cat_${e}`]),eR.current[`cat_${e}`]=setTimeout(async()=>{try{await fetch(`/api/categories/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})}),k(s=>({...s??{},categories:(s?.categories??[]).map(s=>s?.id===e?{...s??{},name:t}:s)}))}catch(e){Q.ZP.error("Failed to update category")}},500)},tt=(0,r.useCallback)(e=>eD[e.id]??e.name??"",[eD]),ts=async e=>{if(confirm("Delete this category and all its items?"))try{await fetch(`/api/categories/${e}`,{method:"DELETE"}),k(t=>({...t??{},categories:(t?.categories??[]).filter(t=>t?.id!==e)}))}catch(e){Q.ZP.error("Failed to delete category")}},ta=async(e,t=!1)=>{let s=(C?.categories??[]).find(t=>t?.id===e);try{let a=await fetch("/api/items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoryId:e,description:"",unit:"",unitCost:0,markupPct:0,quantity:0,sortOrder:s?.items?.length??0,isNote:t,noteContent:t?"":null,includeInPdf:!0})}),r=await a.json();if(403===a.status&&"Item limit reached"===r.error){Q.ZP.error(r.message||"Item limit reached. Upgrade to add more items.",{duration:5e3});return}if(!a.ok)throw Error(r.error||"Failed to add item");k(t=>({...t??{},categories:(t?.categories??[]).map(t=>t?.id===e?{...t??{},items:[...t?.items??[],r]}:t)}))}catch(e){Q.ZP.error("Failed to add item")}},tr=(0,r.useCallback)((e,t,s)=>eT[e]?.[t]??s,[eT]),tn=(0,r.useCallback)(async(e,t,s=!1)=>{eS(s=>({...s,[e]:{...s[e]??{},...t}})),k(s=>({...s??{},categories:(s?.categories??[]).map(s=>({...s??{},items:(s?.items??[]).map(s=>s?.id===e?{...s??{},...t}:s)}))}));let a=`item_${e}`;eR.current[a]&&clearTimeout(eR.current[a]);let r=async()=>{try{await fetch(`/api/items/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),ee(new Date)}catch(e){console.error("Failed to update item:",e)}};s?r():eR.current[a]=setTimeout(r,500)},[]),tl=(0,r.useCallback)(async e=>{try{await fetch(`/api/items/${e}`,{method:"DELETE"}),k(t=>({...t??{},categories:(t?.categories??[]).map(t=>({...t??{},items:(t?.items??[]).filter(t=>t?.id!==e)}))}))}catch(e){Q.ZP.error("Failed to delete item")}},[]),ti=(0,r.useCallback)(()=>{ev(null),eC("")},[]),to=(0,r.useCallback)(async e=>{let t=eQ(ew);await tn(e,{noteContent:t},!0),ev(null),eC("")},[ew,eQ,tn]),tc=(0,r.useCallback)((e,t)=>{if("Escape"===e.key){e.preventDefault(),ti();return}(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),to(t))},[ti,to]),td=(0,K.Dy)((0,K.VT)(K.we,{activationConstraint:{distance:3}}),(0,K.VT)(K.Lg,{coordinateGetter:H.is})),tm=(0,r.useCallback)(e=>{console.log("Item drag started:",e.active.id)},[]),tu=(0,r.useCallback)(async(e,t)=>{let{active:s,over:a}=e;if(console.log("Item drag ended:",s.id,"over:",a?.id),!a||s.id===a.id)return;let r=(C?.categories??[]).find(e=>e?.id===t);if(!r)return;let n=[...r.items??[]],l=n.findIndex(e=>e.id===s.id),i=n.findIndex(e=>e.id===a.id);if(-1===l||-1===i||l===i)return;let o=(0,H.Rp)(n,l,i).map((e,t)=>({...e,sortOrder:t}));k(e=>({...e??{},categories:(e?.categories??[]).map(e=>e?.id===t?{...e,items:o}:e)}));try{await Promise.all(o.map(e=>fetch(`/api/items/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:e.sortOrder})}))),ee(new Date)}catch(e){Q.ZP.error("Failed to reorder items")}},[C?.categories]),tx=(0,r.useCallback)(e=>{},[]),th=(0,r.useCallback)(async e=>{let{active:t,over:s}=e;if(!s||t.id===s.id)return;let a=[...C?.categories??[]],r=a.findIndex(e=>e.id===t.id),n=a.findIndex(e=>e.id===s.id);if(-1===r||-1===n||r===n)return;let l=(0,H.Rp)(a,r,n).map((e,t)=>({...e,sortOrder:t}));k(e=>({...e??{},categories:l}));try{await Promise.all(l.map(e=>fetch(`/api/categories/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:e.sortOrder})}))),ee(new Date)}catch(e){Q.ZP.error("Failed to reorder categories")}},[C?.categories]),tp=(0,r.useCallback)((e,t,s,a)=>{let r=e.noteContent,n=eT[e.id]?.noteContent;void 0!==n&&(r=n),eb.current=null,ef({item:{...e,noteContent:r},categoryId:t,categoryName:s,itemNumber:a}),ey({description:e.description,unit:e.unit,unitCost:e.unitCost,markupPct:e.markupPct,quantity:e.quantity,noteContent:r,includeInPdf:e.includeInPdf})},[eT]),tf=(0,r.useCallback)((e,t,s,a)=>{if(eB(a)){tp(e,t,s,null);return}eC(eV(a)),ev(e.id),setTimeout(()=>{ek.current?.focus()},50)},[eB,tp,eV]);(0,r.useEffect)(()=>{if(ep?.item.isNote&&ep.item.id!==eb.current){let e=setTimeout(()=>{if(ej.current){let e=eg.noteContent??"";ej.current.innerHTML=eL(e),eb.current=ep.item.id}},50);return()=>clearTimeout(e)}},[ep?.item.id,ep?.item.isNote,eg.noteContent,eL]);let tg=async()=>{ep&&(await tn(ep.item.id,eg,!0),ef(null),ey({}))},ty=(0,r.useCallback)(e=>{if(ej.current&&ej.current.focus(),document.execCommand(e,!1),ej.current){let e=ej.current.innerHTML;ey(t=>({...t,noteContent:e}))}},[]),tj=(0,r.useCallback)(e=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&("b"===e.key||"B"===e.key?(e.preventDefault(),ty("bold")):"i"===e.key||"I"===e.key?(e.preventDefault(),ty("italic")):("u"===e.key||"U"===e.key)&&(e.preventDefault(),ty("underline")))},[ty]),tb=async()=>{if(!ea?.trim?.()){Q.ZP.error("Please enter a customer name");return}try{let e=await fetch("/api/customers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ea,email:en||null,phone:ei||null})}),t=await e.json();if(!e.ok){Q.ZP.error(t?.error||"Failed to create customer");return}I([...P??[],t]),e6({customerId:t?.id}),es(!1),er(""),el(""),eo(""),Q.ZP.success("Customer created")}catch(e){Q.ZP.error("An error occurred")}},tN=async()=>{let e;ed(!0);try{await eX(),e=Q.ZP.loading("Starting PDF export...");let t=await fetch(`/api/boqs/${C?.id}/pdf/async`,{method:"POST"});if(!t.ok)throw Error("Failed to start PDF export");let{jobId:s,status:a,message:r}=await t.json();if(!s)throw Error("No job ID returned");Q.ZP.loading("Generating PDF...",{id:e});let n=0;for(;n<300;){await new Promise(e=>setTimeout(e,1e3));let t=await fetch(`/api/pdf-jobs/${s}`);if(!t.ok)throw Error("Failed to check job status");let{status:a,pdfUrl:r,errorMessage:l,elapsedMs:i}=await t.json();if("processing"===a&&i>0&&Q.ZP.loading(`Generating PDF... (${Math.round(i/1e3)}s)`,{id:e}),"completed"===a&&r){if(Q.ZP.loading("Downloading PDF...",{id:e}),r.startsWith("data:")){let e=r.split(",")[1],t=atob(e),s=Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);let a=new Uint8Array(s),n=new Blob([a],{type:"application/pdf"}),l=window.URL.createObjectURL(n),i=document.createElement("a");i.href=l,i.download=`${C?.projectName??"BOQ"}.pdf`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(l),document.body.removeChild(i)}else{let e=document.createElement("a");e.href=r,e.download=`${C?.projectName??"BOQ"}.pdf`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}Q.ZP.success("PDF downloaded",{id:e});return}if("failed"===a)throw Error(l||"PDF generation failed");n++}throw Error("PDF generation timed out")}catch(s){let t=s instanceof Error?s.message:"Failed to export PDF";e?Q.ZP.error(t,{id:e}):Q.ZP.error(t)}finally{ed(!1)}},tv=(0,r.useCallback)(e=>{F(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),tw=(0,r.useCallback)(e=>(e?.items??[]).reduce((e,t)=>{if(t?.isNote)return e;let s=t?.quantity??0;return s>0?e+(t?.unitCost??0)*(1+(t?.markupPct??0)/100)*s:e},0),[]),tC=(0,r.useCallback)((e,t,s)=>{let a=t[s];if(a?.isNote)return null;let r=0;for(let e=0;e<=s;e++)!t[e]?.isNote&&r++;return`${e+1}.${r}`},[]),tk=(0,r.useMemo)(()=>(C?.categories??[]).map(e=>e?.id),[C?.categories]);return(0,a.jsx)(i.AppLayout,{children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[(0,a.jsx)(l.default,{href:"/dashboard",children:(0,a.jsx)(o.z,{variant:"ghost",size:"icon",className:"flex-shrink-0",children:(0,a.jsx)($.Z,{className:"w-5 h-5"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 max-w-2xl",children:[(0,a.jsx)(c.I,{value:eP,onChange:e=>e7(e.target.value),className:"text-xl font-semibold border-0 p-0 h-auto focus-visible:ring-0 bg-transparent w-full",placeholder:"Project Name"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsxs)(f.Ph,{value:C?.customerId??"none",onValueChange:e=>e6({customerId:"none"===e?null:e}),children:[(0,a.jsx)(f.i4,{className:"h-8 text-sm w-[200px]",children:(0,a.jsx)(f.ki,{placeholder:"Select customer"})}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"none",children:"No customer"}),(P??[]).map(e=>(0,a.jsx)(f.Ql,{value:e?.id??"",children:e?.name},e?.id))]})]}),(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>es(!0),children:(0,a.jsx)(_.Z,{className:"w-4 h-4"})})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[(0,a.jsx)("div",{className:"flex items-center text-sm text-gray-500",children:J?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 animate-spin mr-1"}),"Saving..."]}):W?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.Z,{className:"w-4 h-4 text-green-500 mr-1"}),"Saved"]}):null}),(0,a.jsx)(j,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 border-l pl-3",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 font-medium",children:"Cover Page"}),(0,a.jsxs)(b,{children:[(0,a.jsx)(N,{asChild:!0,children:(0,a.jsx)(M.Z,{className:"w-3 h-3 text-gray-400 cursor-help"})}),(0,a.jsx)(v,{children:(0,a.jsx)("p",{className:"text-xs max-w-48",children:"Controls the cover page elements, layout, and styling"})})]})]}),(0,a.jsxs)(f.Ph,{value:C?.coverTemplateId||"default",onValueChange:e=>{if("create_new"===e){w.push("/app/settings?tab=pdf");return}e6({coverTemplateId:"default"===e?null:e})},children:[(0,a.jsxs)(f.i4,{className:"w-40 h-8 text-xs",children:[(0,a.jsx)(q.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),(0,a.jsx)(f.ki,{placeholder:"Cover Template"})]}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"default",children:"Company Default"}),D.map(e=>(0,a.jsxs)(f.Ql,{value:e.id,children:[e.name," ",e.isDefault&&"★"]},e.id)),(0,a.jsx)("div",{className:"border-t my-1"}),(0,a.jsxs)(f.Ql,{value:"create_new",className:"text-cyan-600",children:[(0,a.jsx)(_.Z,{className:"w-3 h-3 mr-1 inline"}),"Create new template..."]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 font-medium",children:"PDF Theme"}),(0,a.jsxs)(b,{children:[(0,a.jsx)(N,{asChild:!0,children:(0,a.jsx)(M.Z,{className:"w-3 h-3 text-gray-400 cursor-help"})}),(0,a.jsx)(v,{children:(0,a.jsx)("p",{className:"text-xs max-w-48",children:"Controls colors/shading for BOQ pages (layout unchanged)"})})]})]}),(0,a.jsxs)(f.Ph,{value:C?.pdfThemeId||"default",onValueChange:e=>{if("create_new"===e){w.push("/app/settings?tab=pdf");return}e6({pdfThemeId:"default"===e?null:e})},children:[(0,a.jsxs)(f.i4,{className:"w-36 h-8 text-xs",children:[(0,a.jsx)(R.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),(0,a.jsx)(f.ki,{placeholder:"Color Theme"})]}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"default",children:"Default Theme"}),S.map(e=>(0,a.jsxs)(f.Ql,{value:e.id,children:[e.name," ",e.isDefault&&"★"]},e.id)),(0,a.jsx)("div",{className:"border-t my-1"}),(0,a.jsxs)(f.Ql,{value:"create_new",className:"text-cyan-600",children:[(0,a.jsx)(_.Z,{className:"w-3 h-3 mr-1 inline"}),"Create new theme..."]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 font-medium",children:"Date"}),(0,a.jsxs)(b,{children:[(0,a.jsx)(N,{asChild:!0,children:(0,a.jsx)(M.Z,{className:"w-3 h-3 text-gray-400 cursor-help"})}),(0,a.jsx)(v,{children:(0,a.jsx)("p",{className:"text-xs max-w-48",children:"Date shown on PDF cover page"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)(f.Ph,{value:C?.dateMode||"export_date",onValueChange:e=>{e6({dateMode:e})},children:[(0,a.jsxs)(f.i4,{className:"w-32 h-8 text-xs",children:[(0,a.jsx)(U.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),(0,a.jsx)(f.ki,{})]}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"export_date",children:"Export Date"}),(0,a.jsx)(f.Ql,{value:"preparation_date",children:"Custom Date"})]})]}),C?.dateMode==="preparation_date"&&(0,a.jsx)("input",{type:"date",value:C?.preparationDate?new Date(C.preparationDate).toISOString().split("T")[0]:"",onChange:e=>e6({preparationDate:e.target.value?new Date(e.target.value).toISOString():null}),className:"h-8 px-2 text-xs border rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]})]})}),(0,a.jsxs)(o.z,{variant:"outline",onClick:tN,disabled:ec,children:[ec?(0,a.jsx)(O.Z,{className:"w-4 h-4 animate-spin mr-2"}):(0,a.jsx)(A.Z,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(u.Zb,{className:"shadow-md border-0 bg-gradient-to-br from-cyan-50 to-teal-50",children:[(0,a.jsx)(u.Ol,{className:"pb-2",children:(0,a.jsx)(u.ll,{className:"text-lg",children:"Totals"})}),(0,a.jsxs)(u.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-1",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Subtotal"}),(0,a.jsx)("span",{className:"font-semibold",children:eH(eJ.subtotal)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(x._,{className:"text-gray-600",children:"Discount"}),(0,a.jsx)(h.r,{checked:C?.discountEnabled??!1,onCheckedChange:e=>e6({discountEnabled:e})})]}),C?.discountEnabled&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(f.Ph,{value:C?.discountType??"percent",onValueChange:e=>e6({discountType:e}),children:[(0,a.jsx)(f.i4,{className:"w-20 h-8",children:(0,a.jsx)(f.ki,{})}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"percent",children:"%"}),(0,a.jsx)(f.Ql,{value:"fixed",children:"Fixed"})]})]}),(0,a.jsx)(c.I,{type:"number",step:"0.01",value:C?.discountValue??0,onChange:e=>e6({discountValue:parseFloat(e.target.value)||0}),className:"w-24 h-8"}),eJ.discount>0&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["-",eH(eJ.discount)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(x._,{className:"text-gray-600",children:"VAT"}),(0,a.jsx)(h.r,{checked:C?.vatEnabled??!1,onCheckedChange:e=>e6({vatEnabled:e})})]}),C?.vatEnabled&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.I,{type:"number",step:"0.01",value:C?.vatPercent??0,onChange:e=>e6({vatPercent:parseFloat(e.target.value)||0}),className:"w-20 h-8"}),(0,a.jsx)("span",{className:"text-gray-500",children:"%"}),(0,a.jsxs)("span",{className:"text-gray-500",children:["+",eH(eJ.vatAmount)]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-t-2 border-cyan-200",children:[(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"Final Total"}),(0,a.jsx)("span",{className:"text-2xl font-bold text-cyan-600",children:eH(eJ.finalTotal)})]})]})]}),(0,a.jsxs)(u.Zb,{className:"shadow-md border-0",children:[(0,a.jsx)(u.Ol,{className:"pb-2",children:(0,a.jsx)(u.ll,{className:"text-lg",children:"Profit Analysis"})}),(0,a.jsxs)(u.aY,{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Cost"}),(0,a.jsx)("span",{className:"font-medium",children:eH(eJ.totalCost)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Price (after discount)"}),(0,a.jsx)("span",{className:"font-medium",children:eH(eJ.priceAfterDiscount)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Profit"}),(0,a.jsx)("span",{className:`font-semibold ${eJ.profit>=0?"text-emerald-600":"text-red-600"}`,children:eH(eJ.profit)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Gross Profit %"}),(0,a.jsxs)("span",{className:`font-semibold ${eJ.grossProfitPct>=0?"text-emerald-600":"text-red-600"}`,children:[eK(eJ.grossProfitPct),"%"]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:e8,className:"text-xs text-gray-500 hover:text-cyan-600 transition-colors",title:"Reset column widths to default",children:"Reset column widths"})}),(0,a.jsx)(K.LB,{sensors:td,collisionDetection:K.pE,onDragStart:tx,onDragEnd:th,modifiers:[Y.DL],children:(0,a.jsx)(H.Fo,{items:tk,strategy:H.qw,children:(C?.categories??[]).map((e,t)=>(0,a.jsx)(X,{category:e,categoryIndex:t,isExpanded:z.has(e?.id),toggleCategory:tv,getCategoryName:tt,handleUpdateCategory:te,handleDeleteCategory:ts,handleAddItem:ta,formatCurrency:eH,getCategorySubtotal:tw,columnWidths:ez,handleResizeStart:e4,sensors:td,getItemNumber:tC,handleItemDragStart:tm,handleItemDragEnd:tu,getItemValue:tr,handleUpdateItem:tn,handleDeleteItem:tl,openEditItemDialog:tp,handleNoteClick:tf,inlineEditingNoteId:eN,inlineEditText:ew,setInlineEditText:eC,inlineTextareaRef:ek,handleInlineNoteKeyDown:tc,saveInlineEdit:to,cancelInlineEdit:ti,sanitizeHtml:eL,formatNumber:eK,itemLimit:em,currentItemCount:e0,isAtItemLimit:e2,planKey:ex},e?.id))})}),(0,a.jsxs)(o.z,{variant:"outline",className:"w-full border-dashed border-2",onClick:e9,children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),"Add Category"]})]})]})}),(0,a.jsx)(g.Vq,{open:et,onOpenChange:es,children:(0,a.jsxs)(g.cZ,{children:[(0,a.jsx)(g.fK,{children:(0,a.jsx)(g.$N,{children:"Add New Customer"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"customerName",children:"Name"}),(0,a.jsx)(c.I,{id:"customerName",placeholder:"Customer name",value:ea,onChange:e=>er(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"customerEmail",children:"Email (Optional)"}),(0,a.jsx)(c.I,{id:"customerEmail",type:"email",placeholder:"customer@email.com",value:en,onChange:e=>el(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"customerPhone",children:"Phone (Optional)"}),(0,a.jsx)(c.I,{id:"customerPhone",placeholder:"Phone number",value:ei,onChange:e=>eo(e.target.value)})]})]}),(0,a.jsxs)(g.cN,{children:[(0,a.jsx)(o.z,{variant:"outline",onClick:()=>es(!1),children:"Cancel"}),(0,a.jsx)(o.z,{onClick:tb,children:"Add Customer"})]})]})}),(0,a.jsx)(g.Vq,{open:!!ep,onOpenChange:e=>!e&&ef(null),children:(0,a.jsxs)(g.cZ,{className:"max-w-2xl",children:[(0,a.jsxs)(g.fK,{children:[(0,a.jsx)(g.$N,{children:ep?.item.isNote?"Edit Note":`Edit Item ${ep?.itemNumber??""}`}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Category: ",ep?.categoryName]})]}),(0,a.jsx)("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto",children:ep?.item.isNote?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{children:"Note Content"}),(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1 p-2 border-b bg-gray-50",children:[(0,a.jsx)(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0 font-bold",onMouseDown:e=>{e.preventDefault(),ty("bold")},title:"Bold (Ctrl+B)",children:(0,a.jsx)(L.Z,{className:"w-4 h-4"})}),(0,a.jsx)(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onMouseDown:e=>{e.preventDefault(),ty("italic")},title:"Italic (Ctrl+I)",children:(0,a.jsx)(B.Z,{className:"w-4 h-4"})}),(0,a.jsx)(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onMouseDown:e=>{e.preventDefault(),ty("underline")},title:"Underline (Ctrl+U)",children:(0,a.jsx)(V.Z,{className:"w-4 h-4"})}),(0,a.jsx)("span",{className:"text-xs text-gray-400 ml-2",children:"Select text and click to format (or use Ctrl+B/I/U)"})]}),(0,a.jsx)("div",{ref:ej,contentEditable:!0,suppressContentEditableWarning:!0,className:"min-h-[150px] p-3 focus:outline-none text-sm prose prose-sm max-w-none [&_strong]:font-bold [&_b]:font-bold [&_em]:italic [&_i]:italic [&_u]:underline",onInput:e=>{let t=e.currentTarget;ey(e=>({...e,noteContent:t.innerHTML}))},onKeyDown:tj})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(p.X,{id:"edit-includeInPdf",checked:eg.includeInPdf??!0,onCheckedChange:e=>ey(t=>({...t,includeInPdf:e}))}),(0,a.jsx)("label",{htmlFor:"edit-includeInPdf",className:"text-sm text-gray-600",children:"Include in PDF"})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"edit-description",children:"Description"}),(0,a.jsx)(m,{id:"edit-description",placeholder:"Enter item description...",value:eg.description??"",onChange:e=>ey(t=>({...t,description:e.target.value})),className:"min-h-[100px]"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"edit-unit",children:"Unit"}),(0,a.jsx)(c.I,{id:"edit-unit",placeholder:"e.g., Sqm, Cub, Nos",value:eg.unit??"",onChange:e=>ey(t=>({...t,unit:e.target.value}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"edit-unitCost",children:"Unit Cost"}),(0,a.jsx)(c.I,{id:"edit-unitCost",type:"number",step:"0.01",value:eg.unitCost??0,onChange:e=>ey(t=>({...t,unitCost:parseFloat(e.target.value)||0}))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"edit-markupPct",children:"Markup %"}),(0,a.jsx)(c.I,{id:"edit-markupPct",type:"number",step:"0.01",value:eg.markupPct??0,onChange:e=>ey(t=>({...t,markupPct:parseFloat(e.target.value)||0}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x._,{htmlFor:"edit-quantity",children:"Quantity"}),(0,a.jsx)(c.I,{id:"edit-quantity",type:"number",step:"0.01",value:eg.quantity??0,onChange:e=>ey(t=>({...t,quantity:parseFloat(e.target.value)||0}))})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Unit Price:"}),(0,a.jsx)("span",{className:"font-medium",children:eH((eg.unitCost??0)*(1+(eg.markupPct??0)/100))})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Amount:"}),(0,a.jsx)("span",{className:"font-semibold text-cyan-600",children:eH((eg.unitCost??0)*(1+(eg.markupPct??0)/100)*(eg.quantity??0))})]})]})]})}),(0,a.jsxs)(g.cN,{children:[(0,a.jsx)(o.z,{variant:"outline",onClick:()=>ef(null),children:"Cancel"}),(0,a.jsx)(o.z,{onClick:tg,children:"Save Changes"})]})]})})]})})}},6167:function(e,t,s){"use strict";s.d(t,{X:function(){return o}});var a=s(5444),r=s(9300),n=s(1831),l=s(7248),i=s(5522);let o=r.forwardRef(({className:e,...t},s)=>(0,a.jsx)(n.fC,{ref:s,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:(0,a.jsx)(n.z$,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})}));o.displayName=n.fC.displayName},489:function(e,t,s){"use strict";s.d(t,{Bw:function(){return p},Ph:function(){return d},Ql:function(){return f},i4:function(){return u},ki:function(){return m}});var a=s(5444),r=s(9300),n=s(3280),l=s(3751),i=s(6997),o=s(7248),c=s(5522);let d=n.fC;n.ZA;let m=n.B4,u=r.forwardRef(({className:e,children:t,...s},r)=>(0,a.jsxs)(n.xz,{ref:r,className:(0,c.cn)("flex h-11 w-full items-center justify-between gap-2 rounded-xl border-2 border-purple-100 bg-white px-4 py-2 text-sm","transition-all duration-200","placeholder:text-muted-foreground","hover:border-purple-200","focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-100","disabled:cursor-not-allowed disabled:opacity-50","[&>span]:line-clamp-1",e),...s,children:[t,(0,a.jsx)(n.JO,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"h-4 w-4 text-purple-400 transition-transform duration-200"})})]}));u.displayName=n.xz.displayName;let x=r.forwardRef(({className:e,...t},s)=>(0,a.jsx)(n.u_,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1 text-purple-400",e),...t,children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})}));x.displayName=n.u_.displayName;let h=r.forwardRef(({className:e,...t},s)=>(0,a.jsx)(n.$G,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1 text-purple-400",e),...t,children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})}));h.displayName=n.$G.displayName;let p=r.forwardRef(({className:e,children:t,position:s="popper",...r},l)=>(0,a.jsx)(n.h_,{children:(0,a.jsxs)(n.VY,{ref:l,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-xl border border-purple-100 bg-white shadow-lg","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2","data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[(0,a.jsx)(x,{}),(0,a.jsx)(n.l_,{className:(0,c.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,a.jsx)(h,{})]})}));p.displayName=n.VY.displayName,r.forwardRef(({className:e,...t},s)=>(0,a.jsx)(n.__,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold text-purple-700",e),...t})).displayName=n.__.displayName;let f=r.forwardRef(({className:e,children:t,...s},r)=>(0,a.jsxs)(n.ck,{ref:r,className:(0,c.cn)("relative flex w-full cursor-pointer select-none items-center rounded-lg py-2 pl-8 pr-2 text-sm outline-none","transition-colors duration-150","hover:bg-purple-50 hover:text-purple-700","focus:bg-purple-50 focus:text-purple-700","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.wU,{children:(0,a.jsx)(o.Z,{className:"h-4 w-4 text-purple-500"})})}),(0,a.jsx)(n.eT,{children:t})]}));f.displayName=n.ck.displayName,r.forwardRef(({className:e,...t},s)=>(0,a.jsx)(n.Z0,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-purple-100",e),...t})).displayName=n.Z0.displayName},5181:function(e,t,s){"use strict";s.d(t,{r:function(){return i}});var a=s(5444),r=s(9300),n=s(2312),l=s(5522);let i=r.forwardRef(({className:e,...t},s)=>(0,a.jsx)(n.fC,{className:(0,l.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-all duration-200","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-gradient-to-r data-[state=checked]:from-purple-500 data-[state=checked]:to-lavender-500","data-[state=unchecked]:bg-purple-200",e),...t,ref:s,children:(0,a.jsx)(n.bU,{className:(0,l.cn)("pointer-events-none block h-5 w-5 rounded-full bg-white shadow-md ring-0 transition-transform duration-200","data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));i.displayName=n.fC.displayName}},function(e){e.O(0,[762,162,853,512,984,233,538,589,629,386,156,744],function(){return e(e.s=9402)}),_N_E=e.O()}]);