"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[629],{7367:function(e,a,t){t.d(a,{AppLayout:function(){return Z}});var r=t(5444),n=t(5762),s=t(9047),i=t(9300),o=t(1084),l=t(5522),c=t(1384),d=t(4624),f=t(5038),u=t(6488),m=t(6378),p=t(2019),x=t(5077),g=t(9484),h=t(6771),b=t(3572),y=t(1137),N=t(7480),j=t(2422);let v=[{name:"Dashboard",href:"/app/dashboard",icon:c.Z},{name:"Customers",href:"/app/customers",icon:d.Z},{name:"Team",href:"/app/team",icon:f.Z},{name:"Settings",href:"/app/settings",icon:u.Z}],w=[{name:"Overview",href:"/app/glorand",icon:m.Z},{name:"Users",href:"/app/glorand?tab=users",icon:d.Z},{name:"Companies",href:"/app/glorand?tab=companies",icon:p.Z},{name:"Coupons",href:"/app/glorand?tab=coupons",icon:x.Z}];function k(){let e=(0,s.usePathname)(),{data:a}=(0,n.useSession)()||{},[t,c]=(0,i.useState)(!1),[d,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{fetch("/api/admin/check").then(e=>e.json()).then(e=>f(e.isAdmin)).catch(()=>f(!1))},[a?.user?.email]);let u=e?.startsWith("/app/glorand"),m=d&&u?w:v;return(0,r.jsxs)("div",{className:(0,l.cn)("h-screen bg-white border-r border-gray-200 flex flex-col transition-all duration-300 shadow-sm",t?"w-20":"w-64"),children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(o.default,{href:d&&u?"/app/glorand":"/app/dashboard",className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:(0,l.cn)("w-10 h-10 rounded-xl flex items-center justify-center shadow-md",d&&u?"bg-gradient-to-br from-amber-500 to-orange-500":"bg-gradient-to-br from-cyan-500 to-teal-500"),children:d&&u?(0,r.jsx)(g.Z,{className:"w-5 h-5 text-white"}):(0,r.jsx)(h.Z,{className:"w-5 h-5 text-white"})}),!t&&(0,r.jsx)("span",{className:(0,l.cn)("text-lg font-bold bg-clip-text text-transparent",d&&u?"bg-gradient-to-r from-amber-600 to-orange-600":"bg-gradient-to-r from-cyan-600 to-teal-600"),children:d&&u?"Admin Panel":"MakeEstimate"})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>c(!t),children:t?(0,r.jsx)(b.Z,{className:"h-4 w-4"}):(0,r.jsx)(y.Z,{className:"h-4 w-4"})})]})}),(0,r.jsxs)("nav",{className:"flex-1 p-4 space-y-2",children:[m.map(a=>{let n=a.href.includes("?tab="),s=n?a.href.split("?tab=")[1]:null,i=new URLSearchParams(window.location.search).get("tab"),c=!1;c=n?"/app/glorand"===e&&i===s:"/app/glorand"===a.href?"/app/glorand"===e&&(!i||"users"===i):e===a.href||e?.startsWith?.(a.href+"/");let f=d&&u;return(0,r.jsxs)(o.default,{href:a.href,className:(0,l.cn)("flex items-center space-x-3 px-3 py-2.5 rounded-lg transition-all",c?f?"bg-gradient-to-r from-amber-50 to-orange-50 text-amber-700 font-medium":"bg-gradient-to-r from-cyan-50 to-teal-50 text-cyan-700 font-medium":f?"text-gray-600 hover:bg-amber-50":"text-gray-600 hover:bg-gray-100"),children:[(0,r.jsx)(a.icon,{className:(0,l.cn)("h-5 w-5",c?f?"text-amber-600":"text-cyan-600":"")}),!t&&(0,r.jsx)("span",{children:a.name})]},a.name)}),d&&!u&&(0,r.jsxs)(o.default,{href:"/app/glorand",className:(0,l.cn)("flex items-center space-x-3 px-3 py-2.5 rounded-lg transition-all","text-amber-600 hover:bg-amber-50"),children:[(0,r.jsx)(g.Z,{className:"h-5 w-5"}),!t&&(0,r.jsx)("span",{children:"Admin Panel"})]})]}),(0,r.jsxs)("div",{className:"p-4 border-t border-gray-200",children:[!t&&a?.user&&(0,r.jsxs)("div",{className:"mb-3 px-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.user?.companyName||"Company"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 truncate",children:a.user?.email})]}),(0,r.jsxs)(j.z,{variant:"ghost",className:(0,l.cn)("w-full text-gray-600 hover:text-red-600 hover:bg-red-50",t?"justify-center":"justify-start"),onClick:()=>(0,n.signOut)({callbackUrl:"/login"}),children:[(0,r.jsx)(N.Z,{className:"h-5 w-5"}),!t&&(0,r.jsx)("span",{className:"ml-3",children:"Sign Out"})]})]})]})}var C=t(1946);function Z({children:e}){let{data:a,status:t}=(0,n.useSession)()||{},o=(0,s.useRouter)(),l=(0,s.usePathname)(),[c,d]=(0,i.useState)(!1),[f,u]=(0,i.useState)(null),m=["/app/dashboard","/app/customers","/app/settings","/app/boq"].some(e=>l?.startsWith(e));l?.startsWith("/app/glorand");let p=(0,i.useCallback)(async()=>{try{let e=await fetch("/api/admin/check");if(e.ok){let a=await e.json();return u(a.isAdmin),a.isAdmin}}catch(e){console.error("Failed to check admin status:",e)}return u(!1),!1},[]),x=(0,i.useCallback)(async()=>{if(a?.user){try{let e=await fetch("/api/billing/status");if(e.ok){let a=await e.json();if(a.isBlocked){o.replace(`/blocked${a.blockReason?`?reason=${encodeURIComponent(a.blockReason)}`:""}`);return}if(a.hasTrialGrant&&a.trialEndsAt&&new Date(a.trialEndsAt)<new Date){o.replace("/pricing?trial=ended");return}if(!a.hasActiveSubscription&&!a.hasAdminGrant&&!a.hasTrialGrant){o.replace("/pricing?subscription=required");return}}}catch(e){console.error("Failed to check blocked status:",e)}d(!0)}},[a?.user,o]);return((0,i.useEffect)(()=>{"unauthenticated"===t&&o.replace("/login")},[t,o]),(0,i.useEffect)(()=>{"authenticated"===t&&a?.user&&null===f&&p().then(e=>{e?d(!0):x()})},[t,a?.user,f,p,x]),(0,i.useEffect)(()=>{!0===f&&m&&o.replace("/app/glorand")},[f,m,o]),"loading"!==t&&null!==f&&("authenticated"!==t||c))?a?f&&m?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)(C.Z,{className:"h-8 w-8 animate-spin text-primary"})}):(0,r.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,r.jsx)(k,{}),(0,r.jsx)("main",{className:"flex-1 overflow-auto",children:e})]}):null:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)(C.Z,{className:"h-8 w-8 animate-spin text-primary"})})}},2422:function(e,a,t){t.d(a,{d:function(){return l},z:function(){return c}});var r=t(5444),n=t(9300),s=t(223),i=t(2371),o=t(5522);let l=(0,i.j)("inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-emerald-500 text-white hover:bg-emerald-600"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-lg px-3",lg:"h-11 rounded-lg px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef(({className:e,variant:a,size:t,asChild:n=!1,...i},c)=>{let d=n?s.g7:"button";return(0,r.jsx)(d,{className:(0,o.cn)(l({variant:a,size:t,className:e})),ref:c,...i})});c.displayName="Button"},9827:function(e,a,t){t.d(a,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},ll:function(){return l}});var r=t(5444),n=t(9300),s=t(5522);let i=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",e),...a}));i.displayName="Card";let o=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...a}));o.displayName="CardHeader";let l=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",e),...a}));l.displayName="CardTitle";let c=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",e),...a}));c.displayName="CardDescription";let d=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",e),...a}));d.displayName="CardContent",n.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter"},9530:function(e,a,t){t.d(a,{$N:function(){return x},Be:function(){return g},Vq:function(){return l},cN:function(){return p},cZ:function(){return u},fK:function(){return m},hg:function(){return c}});var r=t(5444),n=t(9300),s=t(9095),i=t(3485),o=t(5522);let l=s.fC,c=s.xz,d=s.h_;s.x8;let f=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)(s.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));f.displayName=s.aV.displayName;let u=n.forwardRef(({className:e,children:a,...t},n)=>(0,r.jsxs)(d,{children:[(0,r.jsx)(f,{}),(0,r.jsxs)(s.VY,{ref:n,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-xl",e),...t,children:[a,(0,r.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));u.displayName=s.VY.displayName;let m=({className:e,...a})=>(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});m.displayName="DialogHeader";let p=({className:e,...a})=>(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});p.displayName="DialogFooter";let x=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)(s.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",e),...a}));x.displayName=s.Dx.displayName;let g=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)(s.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",e),...a}));g.displayName=s.dk.displayName},4678:function(e,a,t){t.d(a,{I:function(){return i}});var r=t(5444),n=t(9300),s=t(5522);let i=n.forwardRef(({className:e,type:a,...t},n)=>(0,r.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...t}));i.displayName="Input"},4635:function(e,a,t){t.d(a,{_:function(){return c}});var r=t(5444),n=t(9300),s=t(4100),i=t(2371),o=t(5522);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef(({className:e,...a},t)=>(0,r.jsx)(s.f,{ref:t,className:(0,o.cn)(l(),e),...a}));c.displayName=s.f.displayName},5522:function(e,a,t){t.d(a,{cn:function(){return s}});var r=t(2191),n=t(3607);function s(...e){return(0,n.m6)((0,r.W)(e))}}}]);