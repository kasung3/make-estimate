"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[629],{7367:function(e,t,a){a.d(t,{AppLayout:function(){return Z}});var r=a(5444),s=a(5762),n=a(9047),o=a(9300),l=a(1084),i=a(5522),d=a(1384),c=a(4624),u=a(5038),p=a(6488),f=a(6378),m=a(2019),x=a(5077),h=a(9484),g=a(6771),b=a(3572),v=a(1137),N=a(7480),w=a(2422);let j=[{name:"Dashboard",href:"/app/dashboard",icon:d.Z},{name:"Customers",href:"/app/customers",icon:c.Z},{name:"Team",href:"/app/team",icon:u.Z},{name:"Settings",href:"/app/settings",icon:p.Z}],y=[{name:"Overview",href:"/app/glorand",icon:f.Z},{name:"Users",href:"/app/glorand?tab=users",icon:c.Z},{name:"Companies",href:"/app/glorand?tab=companies",icon:m.Z},{name:"Coupons",href:"/app/glorand?tab=coupons",icon:x.Z}];function k(){let e=(0,n.usePathname)(),{data:t}=(0,s.useSession)()||{},[a,d]=(0,o.useState)(!1),[c,u]=(0,o.useState)(!1);(0,o.useEffect)(()=>{fetch("/api/admin/check").then(e=>e.json()).then(e=>u(e.isAdmin)).catch(()=>u(!1))},[t?.user?.email]);let p=e?.startsWith("/app/glorand"),f=c&&p?y:j;return(0,r.jsxs)("div",{className:(0,i.cn)("h-screen bg-white border-r border-purple-100/50 flex flex-col transition-all duration-300",a?"w-20":"w-64"),children:[(0,r.jsx)("div",{className:"p-4 border-b border-purple-100/50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(l.default,{href:c&&p?"/app/glorand":"/app/dashboard",className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:(0,i.cn)("w-10 h-10 rounded-xl flex items-center justify-center shadow-md transition-all duration-200",c&&p?"bg-gradient-to-br from-amber-500 to-orange-500":"bg-gradient-to-br from-purple-500 to-lavender-500"),children:c&&p?(0,r.jsx)(h.Z,{className:"w-5 h-5 text-white"}):(0,r.jsx)(g.Z,{className:"w-5 h-5 text-white"})}),!a&&(0,r.jsx)("span",{className:(0,i.cn)("text-lg font-bold bg-clip-text text-transparent",c&&p?"bg-gradient-to-r from-amber-600 to-orange-600":"bg-gradient-to-r from-purple-600 to-lavender-600"),children:c&&p?"Admin Panel":"MakeEstimate"})]}),(0,r.jsx)(w.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-purple-400 hover:text-purple-600 hover:bg-purple-50",onClick:()=>d(!a),children:a?(0,r.jsx)(b.Z,{className:"h-4 w-4"}):(0,r.jsx)(v.Z,{className:"h-4 w-4"})})]})}),(0,r.jsxs)("nav",{className:"flex-1 p-4 space-y-1",children:[f.map(t=>{let s=t.href.includes("?tab="),n=s?t.href.split("?tab=")[1]:null,o=new URLSearchParams(window.location.search).get("tab"),d=!1;d=s?"/app/glorand"===e&&o===n:"/app/glorand"===t.href?"/app/glorand"===e&&(!o||"users"===o):e===t.href||e?.startsWith?.(t.href+"/");let u=c&&p;return(0,r.jsxs)(l.default,{href:t.href,className:(0,i.cn)("flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200",d?u?"bg-gradient-to-r from-amber-50 to-orange-50 text-amber-700 font-medium shadow-sm":"bg-gradient-to-r from-purple-50 to-lavender-50 text-purple-700 font-medium shadow-sm":u?"text-gray-600 hover:bg-amber-50 hover:text-amber-600":"text-gray-600 hover:bg-purple-50 hover:text-purple-600"),children:[(0,r.jsx)(t.icon,{className:(0,i.cn)("h-5 w-5 transition-colors",d?u?"text-amber-600":"text-purple-500":"")}),!a&&(0,r.jsx)("span",{children:t.name})]},t.name)}),c&&!p&&(0,r.jsxs)(l.default,{href:"/app/glorand",className:(0,i.cn)("flex items-center space-x-3 px-3 py-2.5 rounded-xl transition-all duration-200","text-amber-600 hover:bg-amber-50"),children:[(0,r.jsx)(h.Z,{className:"h-5 w-5"}),!a&&(0,r.jsx)("span",{children:"Admin Panel"})]})]}),(0,r.jsxs)("div",{className:"p-4 border-t border-purple-100/50",children:[!a&&t?.user&&(0,r.jsxs)("div",{className:"mb-3 px-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-foreground truncate",children:t.user?.companyName||"Company"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:t.user?.email})]}),(0,r.jsxs)(w.z,{variant:"ghost",className:(0,i.cn)("w-full text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-xl",a?"justify-center":"justify-start"),onClick:()=>(0,s.signOut)({callbackUrl:"/login"}),children:[(0,r.jsx)(N.Z,{className:"h-5 w-5"}),!a&&(0,r.jsx)("span",{className:"ml-3",children:"Sign Out"})]})]})]})}var C=a(1946);function Z({children:e}){let{data:t,status:a}=(0,s.useSession)()||{},l=(0,n.useRouter)(),i=(0,n.usePathname)(),[d,c]=(0,o.useState)(!1),[u,p]=(0,o.useState)(null),f=["/app/dashboard","/app/customers","/app/settings","/app/boq"].some(e=>i?.startsWith(e));i?.startsWith("/app/glorand");let m=(0,o.useCallback)(async()=>{try{let e=await fetch("/api/admin/check");if(e.ok){let t=await e.json();return p(t.isAdmin),t.isAdmin}}catch(e){console.error("Failed to check admin status:",e)}return p(!1),!1},[]),x=(0,o.useCallback)(async()=>{if(t?.user){try{let e=await fetch("/api/billing/status");if(e.ok){let t=await e.json();if(t.isBlocked){l.replace(`/blocked${t.blockReason?`?reason=${encodeURIComponent(t.blockReason)}`:""}`);return}if(t.hasTrialGrant&&t.trialEndsAt&&new Date(t.trialEndsAt)<new Date){l.replace("/pricing?trial=ended");return}if(!t.hasActiveSubscription&&!t.hasAdminGrant&&!t.hasTrialGrant){l.replace("/pricing?subscription=required");return}}}catch(e){console.error("Failed to check blocked status:",e)}c(!0)}},[t?.user,l]);return((0,o.useEffect)(()=>{"unauthenticated"===a&&l.replace("/login")},[a,l]),(0,o.useEffect)(()=>{"authenticated"===a&&t?.user&&null===u&&m().then(e=>{e?c(!0):x()})},[a,t?.user,u,m,x]),(0,o.useEffect)(()=>{!0===u&&f&&l.replace("/app/glorand")},[u,f,l]),"loading"!==a&&null!==u&&("authenticated"!==a||d))?t?u&&f?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)(C.Z,{className:"h-8 w-8 animate-spin text-primary"})}):(0,r.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,r.jsx)(k,{}),(0,r.jsx)("main",{className:"flex-1 overflow-auto",children:e})]}):null:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)(C.Z,{className:"h-8 w-8 animate-spin text-primary"})})}},2422:function(e,t,a){a.d(t,{d:function(){return i},z:function(){return d}});var r=a(5444),s=a(9300),n=a(223),o=a(2371),l=a(5522);let i=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-gradient-to-r from-purple-500 to-lavender-500 text-white shadow-md hover:shadow-lg hover:from-purple-600 hover:to-lavender-600 active:scale-[0.98]",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90 active:scale-[0.98]",outline:"border-2 border-purple-200 bg-white text-purple-700 hover:bg-purple-50 hover:border-purple-300 active:scale-[0.98]",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80 active:scale-[0.98]",ghost:"text-foreground hover:bg-purple-100/50 hover:text-purple-700 active:scale-[0.98]",link:"text-purple-600 underline-offset-4 hover:underline hover:text-purple-700",success:"bg-gradient-to-r from-emerald-500 to-green-500 text-white shadow-sm hover:from-emerald-600 hover:to-green-600 active:scale-[0.98]"},size:{default:"h-10 px-5 py-2",sm:"h-9 rounded-lg px-4 text-xs",lg:"h-12 rounded-xl px-8 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef(({className:e,variant:t,size:a,asChild:s=!1,...o},d)=>{let c=s?n.g7:"button";return(0,r.jsx)(c,{className:(0,l.cn)(i({variant:t,size:a,className:e})),ref:d,...o})});d.displayName="Button"},9827:function(e,t,a){a.d(t,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return o},aY:function(){return c},ll:function(){return i}});var r=a(5444),s=a(9300),n=a(5522);let o=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("rounded-2xl border border-purple-100/50 bg-white shadow-card transition-all duration-200","hover:shadow-card-hover",e),...t}));o.displayName="Card";let l=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let i=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("h3",{ref:a,className:(0,n.cn)("text-xl font-semibold leading-none tracking-tight text-foreground",e),...t}));i.displayName="CardTitle";let d=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("p",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",e),...t}));d.displayName="CardDescription";let c=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",e),...t}));c.displayName="CardContent",s.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},9530:function(e,t,a){a.d(t,{$N:function(){return x},Be:function(){return h},Vq:function(){return i},cN:function(){return m},cZ:function(){return p},fK:function(){return f},hg:function(){return d}});var r=a(5444),s=a(9300),n=a(9095),o=a(3485),l=a(5522);let i=n.fC,d=n.xz,c=n.h_;n.x8;let u=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)(n.aV,{ref:a,className:(0,l.cn)("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));u.displayName=n.aV.displayName;let p=s.forwardRef(({className:e,children:t,...a},s)=>(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(n.VY,{ref:s,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-purple-100 bg-white p-6 shadow-xl duration-200","rounded-2xl","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...a,children:[t,(0,r.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-lg p-1.5 text-muted-foreground transition-colors hover:bg-purple-100 hover:text-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-200 disabled:pointer-events-none",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));p.displayName=n.VY.displayName;let f=({className:e,...t})=>(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});f.displayName="DialogHeader";let m=({className:e,...t})=>(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});m.displayName="DialogFooter";let x=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)(n.Dx,{ref:a,className:(0,l.cn)("text-xl font-semibold leading-none tracking-tight text-foreground",e),...t}));x.displayName=n.Dx.displayName;let h=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)(n.dk,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",e),...t}));h.displayName=n.dk.displayName},4678:function(e,t,a){a.d(t,{I:function(){return o}});var r=a(5444),s=a(9300),n=a(5522);let o=s.forwardRef(({className:e,type:t,...a},s)=>(0,r.jsx)("input",{type:t,className:(0,n.cn)("flex h-11 w-full rounded-xl border-2 border-purple-100 bg-white px-4 py-2 text-sm text-foreground transition-all duration-200","placeholder:text-muted-foreground","hover:border-purple-200","focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-muted","file:border-0 file:bg-transparent file:text-sm file:font-medium",e),ref:s,...a}));o.displayName="Input"},4635:function(e,t,a){a.d(t,{_:function(){return d}});var r=a(5444),s=a(9300),n=a(4100),o=a(2371),l=a(5522);let i=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef(({className:e,...t},a)=>(0,r.jsx)(n.f,{ref:a,className:(0,l.cn)(i(),e),...t}));d.displayName=n.f.displayName},5522:function(e,t,a){a.d(t,{cn:function(){return n}});var r=a(2191),s=a(3607);function n(...e){return(0,s.m6)((0,r.W)(e))}}}]);