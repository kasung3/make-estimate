(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[171],{9219:function(e,t,r){Promise.resolve().then(r.bind(r,468))},468:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var s=r(5444),n=r(9300),a=r(9047),i=r(5762),c=r(1084),l=r(1946),o=r(2690),u=r(458),d=r(6772),f=r(9032),m=r(2422),p=r(9827),x=r(4611),h=r(2038);function g(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),{data:r,status:g}=(0,i.useSession)()||{},v=t.get("session_id"),[y,b]=(0,n.useState)("verifying"),[j,w]=(0,n.useState)(null),[N,k]=(0,n.useState)(null),[C,S]=(0,n.useState)(0),_=(0,n.useRef)(null),P=(0,n.useCallback)(async()=>{if(!v){k("No checkout session ID provided. Please return to pricing and try again."),b("error");return}try{let e=await fetch(`/api/stripe/checkout-session?session_id=${encodeURIComponent(v)}`),t=await e.json();if(!e.ok){k(t.error||"Failed to verify checkout session"),b("error");return}w(t),b("activating");let r=`me_meta_checkout_fired_${t.sessionId}`;!localStorage.getItem(r)&&(localStorage.setItem(r,"true"),(0,h.OD)("Subscribe",{content_name:t.planKey||"unknown",content_category:t.interval||"monthly"}),t.amount>0&&(0,h.OD)("Purchase",{value:t.amount/100,currency:(t.currency||"usd").toUpperCase(),content_name:t.planKey||"subscription"}))}catch(e){console.error("Session verification error:",e),k("Failed to verify your payment. Please check your billing status."),b("error")}},[v]),Z=(0,n.useCallback)(async()=>{try{let e=await fetch("/api/billing/status"),t=await e.json();if(!e.ok)return!1;if("active"===t.status||"trialing"===t.status||t.hasActiveSubscription)return!0;return!1}catch(e){return console.error("Billing status poll error:",e),!1}},[]);return(0,n.useEffect)(()=>{if("activating"!==y)return;let t=async()=>{if(await Z()){_.current&&clearInterval(_.current),b("success"),x.ZP.success("Subscription activated successfully!"),setTimeout(()=>{e.push("/app/dashboard")},1500);return}S(t=>{let r=t+1;return r>=15&&(_.current&&clearInterval(_.current),b("success"),x.ZP.success("Payment received! Your subscription will be active shortly."),setTimeout(()=>{e.push("/app/dashboard")},2e3)),r})};return t(),_.current=setInterval(t,2e3),()=>{_.current&&clearInterval(_.current)}},[y,Z,e]),(0,n.useEffect)(()=>{if("loading"!==g){if("unauthenticated"===g){e.push("/login?callbackUrl=/billing/success");return}P()}},[g,P,e]),(0,s.jsx)("div",{className:"min-h-screen gradient-hero flex items-center justify-center p-4",children:(0,s.jsxs)(p.Zb,{className:"w-full max-w-md shadow-xl border border-purple-100/50",children:[(0,s.jsxs)(p.Ol,{className:"text-center",children:[(0,s.jsx)(p.ll,{className:"text-2xl font-bold gradient-text",children:"Payment Status"}),(0,s.jsx)(p.SZ,{children:"error"===y?"There was an issue with your payment":"Processing your subscription"})]}),(0,s.jsx)(p.aY,{children:(()=>{if("loading"===g)return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[(0,s.jsx)(l.Z,{className:"w-12 h-12 animate-spin text-purple-500"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]});switch(y){case"verifying":return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[(0,s.jsx)(l.Z,{className:"w-12 h-12 animate-spin text-purple-500"}),(0,s.jsx)("p",{className:"text-lg font-medium",children:"Verifying your payment..."}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Please wait while we confirm your transaction."})]});case"activating":return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(o.Z,{className:"w-16 h-16 text-green-500"}),(0,s.jsx)(l.Z,{className:"w-6 h-6 animate-spin text-purple-500 absolute -bottom-1 -right-1"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-lg font-medium text-green-600",children:"Payment received!"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:"Activating your subscription..."})]}),j?.planKey&&(0,s.jsx)("div",{className:"mt-4 p-4 bg-purple-50 rounded-xl border border-purple-100",children:(0,s.jsxs)("p",{className:"text-sm text-purple-700",children:[(0,s.jsx)("span",{className:"font-medium",children:"Plan:"})," ",j.planKey.charAt(0).toUpperCase()+j.planKey.slice(1),j.interval&&` (${"year"===j.interval?"Annual":"Monthly"})`]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,s.jsx)(u.Z,{className:"w-3 h-3 animate-spin"}),(0,s.jsxs)("span",{children:["Checking status... (",C,"/",15,")"]})]})]});case"success":return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:(0,s.jsx)(o.Z,{className:"w-10 h-10 text-green-600"})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xl font-semibold text-green-600",children:"Subscription Active!"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:"Redirecting to dashboard..."})]}),(0,s.jsx)(l.Z,{className:"w-5 h-5 animate-spin text-purple-500"})]});case"error":return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 py-12",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:(0,s.jsx)(d.Z,{className:"w-10 h-10 text-red-600"})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-lg font-medium text-red-600",children:"Something went wrong"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1 max-w-md",children:N})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,s.jsx)(c.default,{href:"/pricing",children:(0,s.jsx)(m.z,{variant:"outline",children:"View Pricing"})}),(0,s.jsx)(c.default,{href:"/app/settings",children:(0,s.jsxs)(m.z,{children:["Check Billing Status",(0,s.jsx)(f.Z,{className:"w-4 h-4 ml-2"})]})})]})]})}})()})]})})}},2422:function(e,t,r){"use strict";r.d(t,{d:function(){return l},z:function(){return o}});var s=r(5444),n=r(9300),a=r(223),i=r(2371),c=r(5522);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-gradient-to-r from-purple-500 to-lavender-500 text-white shadow-md hover:shadow-lg hover:from-purple-600 hover:to-lavender-600 active:scale-[0.98]",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90 active:scale-[0.98]",outline:"border-2 border-purple-200 bg-white text-purple-700 hover:bg-purple-50 hover:border-purple-300 active:scale-[0.98]",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80 active:scale-[0.98]",ghost:"text-foreground hover:bg-purple-100/50 hover:text-purple-700 active:scale-[0.98]",link:"text-purple-600 underline-offset-4 hover:underline hover:text-purple-700",success:"bg-gradient-to-r from-emerald-500 to-green-500 text-white shadow-sm hover:from-emerald-600 hover:to-green-600 active:scale-[0.98]"},size:{default:"h-10 px-5 py-2",sm:"h-9 rounded-lg px-4 text-xs",lg:"h-12 rounded-xl px-8 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...i},o)=>{let u=n?a.g7:"button";return(0,s.jsx)(u,{className:(0,c.cn)(l({variant:t,size:r,className:e})),ref:o,...i})});o.displayName="Button"},9827:function(e,t,r){"use strict";r.d(t,{Ol:function(){return c},SZ:function(){return o},Zb:function(){return i},aY:function(){return u},ll:function(){return l}});var s=r(5444),n=r(9300),a=r(5522);let i=n.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("rounded-2xl border border-purple-100/50 bg-white shadow-card transition-all duration-200","hover:shadow-card-hover",e),...t}));i.displayName="Card";let c=n.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...t}));c.displayName="CardHeader";let l=n.forwardRef(({className:e,...t},r)=>(0,s.jsx)("h3",{ref:r,className:(0,a.cn)("text-xl font-semibold leading-none tracking-tight text-foreground",e),...t}));l.displayName="CardTitle";let o=n.forwardRef(({className:e,...t},r)=>(0,s.jsx)("p",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",e),...t}));o.displayName="CardDescription";let u=n.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",e),...t}));u.displayName="CardContent",n.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},2038:function(e,t,r){"use strict";function s(){return!0}function n(){return"2738592306503525"}function a(...e){if("function"==typeof window.fbq)try{window.fbq(...e)}catch(e){console.error("[Meta Pixel] Error calling fbq:",e)}}function i(e,t){t?a("track",e,t):a("track",e)}function c(e,t){t?a("trackCustom",e,t):a("trackCustom",e)}function l(){a("track","PageView")}r.d(t,{OD:function(){return i},PR:function(){return c},kR:function(){return n},kl:function(){return l},mO:function(){return s}})},5522:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(2191),n=r(3607);function a(...e){return(0,n.m6)((0,s.W)(e))}}},function(e){e.O(0,[762,162,84,703,386,156,744],function(){return e(e.s=9219)}),_N_E=e.O()}]);