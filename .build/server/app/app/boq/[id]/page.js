(()=>{var e={};e.id=8563,e.ids=[8563],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},24006:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),a(28405),a(83336),a(71363);var s=a(36576),r=a(72007),n=a(21818),i=a.n(n),l=a(88897),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let c=["",{children:["app",{children:["boq",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,28405)),"/home/ubuntu/make_estimate/nextjs_space/app/app/boq/[id]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,83336)),"/home/ubuntu/make_estimate/nextjs_space/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,71363,23)),"next/dist/client/components/not-found-error"]}],d=["/home/ubuntu/make_estimate/nextjs_space/app/app/boq/[id]/page.tsx"],u="/app/boq/[id]/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/app/boq/[id]/page",pathname:"/app/boq/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},96774:(e,t,a)=>{Promise.resolve().then(a.bind(a,11123))},11123:(e,t,a)=>{"use strict";a.d(t,{BoqEditorClient:()=>e$});var s=a(62901),r=a(24383),n=a(84374),i=a(62392),l=a(22270),o=a(27878),c=a(250),d=a(68637);let u=r.forwardRef(({className:e,...t},a)=>s.jsx("textarea",{className:(0,d.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...t}));u.displayName="Textarea";var m=a(23803),p=a(82657),x=a(84377),h=a(16098),f=a(72388),g=a(65923),y=a(1940),b=a(56163),j=a(89291),v=a(8378),N=a(50430),w=a(65138),C=(a(4764),a(52490)),k=a(74132),P=a(42049),T=a(98106),D=a(18221),[E,I]=(0,j.b)("Tooltip",[w.D7]),_=(0,w.D7)(),S="TooltipProvider",M="tooltip.open",[R,q]=E(S),z=e=>{let{__scopeTooltip:t,delayDuration:a=700,skipDelayDuration:n=300,disableHoverableContent:i=!1,children:l}=e,[o,c]=r.useState(!0),d=r.useRef(!1),u=r.useRef(0);return r.useEffect(()=>{let e=u.current;return()=>window.clearTimeout(e)},[]),(0,s.jsx)(R,{scope:t,isOpenDelayed:o,delayDuration:a,onOpen:r.useCallback(()=>{window.clearTimeout(u.current),c(!1)},[]),onClose:r.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>c(!0),n)},[n]),isPointerInTransitRef:d,onPointerInTransitChange:r.useCallback(e=>{d.current=e},[]),disableHoverableContent:i,children:l})};z.displayName=S;var Z="Tooltip",[O,F]=E(Z),$=e=>{let{__scopeTooltip:t,children:a,open:n,defaultOpen:i=!1,onOpenChange:l,disableHoverableContent:o,delayDuration:c}=e,d=q(Z,e.__scopeTooltip),u=_(t),[m,p]=r.useState(null),x=(0,N.M)(),h=r.useRef(0),f=o??d.disableHoverableContent,g=c??d.delayDuration,y=r.useRef(!1),[b=!1,j]=(0,T.T)({prop:n,defaultProp:i,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(M))):d.onClose(),l?.(e)}}),v=r.useMemo(()=>b?y.current?"delayed-open":"instant-open":"closed",[b]),C=r.useCallback(()=>{window.clearTimeout(h.current),y.current=!1,j(!0)},[j]),k=r.useCallback(()=>{window.clearTimeout(h.current),j(!1)},[j]),P=r.useCallback(()=>{window.clearTimeout(h.current),h.current=window.setTimeout(()=>{y.current=!0,j(!0)},g)},[g,j]);return r.useEffect(()=>()=>window.clearTimeout(h.current),[]),(0,s.jsx)(w.fC,{...u,children:(0,s.jsx)(O,{scope:t,contentId:x,open:b,stateAttribute:v,trigger:m,onTriggerChange:p,onTriggerEnter:r.useCallback(()=>{d.isOpenDelayed?P():C()},[d.isOpenDelayed,P,C]),onTriggerLeave:r.useCallback(()=>{f?k():window.clearTimeout(h.current)},[k,f]),onOpen:C,onClose:k,disableHoverableContent:f,children:a})})};$.displayName=Z;var A="TooltipTrigger",L=r.forwardRef((e,t)=>{let{__scopeTooltip:a,...n}=e,i=F(A,a),l=q(A,a),o=_(a),c=r.useRef(null),d=(0,b.e)(t,c,i.onTriggerChange),u=r.useRef(!1),m=r.useRef(!1),p=r.useCallback(()=>u.current=!1,[]);return r.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),(0,s.jsx)(w.ee,{asChild:!0,...o,children:(0,s.jsx)(k.WV.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...n,ref:d,onPointerMove:(0,y.M)(e.onPointerMove,e=>{"touch"===e.pointerType||m.current||l.isPointerInTransitRef.current||(i.onTriggerEnter(),m.current=!0)}),onPointerLeave:(0,y.M)(e.onPointerLeave,()=>{i.onTriggerLeave(),m.current=!1}),onPointerDown:(0,y.M)(e.onPointerDown,()=>{u.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:(0,y.M)(e.onFocus,()=>{u.current||i.onOpen()}),onBlur:(0,y.M)(e.onBlur,i.onClose),onClick:(0,y.M)(e.onClick,i.onClose)})})});L.displayName=A;var[B,V]=E("TooltipPortal",{forceMount:void 0}),U="TooltipContent",J=r.forwardRef((e,t)=>{let a=V(U,e.__scopeTooltip),{forceMount:r=a.forceMount,side:n="top",...i}=e,l=F(U,e.__scopeTooltip);return(0,s.jsx)(C.z,{present:r||l.open,children:l.disableHoverableContent?(0,s.jsx)(W,{side:n,...i,ref:t}):(0,s.jsx)(Q,{side:n,...i,ref:t})})}),Q=r.forwardRef((e,t)=>{let a=F(U,e.__scopeTooltip),n=q(U,e.__scopeTooltip),i=r.useRef(null),l=(0,b.e)(t,i),[o,c]=r.useState(null),{trigger:d,onClose:u}=a,m=i.current,{onPointerInTransitChange:p}=n,x=r.useCallback(()=>{c(null),p(!1)},[p]),h=r.useCallback((e,t)=>{let a=e.currentTarget,s={x:e.clientX,y:e.clientY},r=function(e,t){let a=Math.abs(t.top-e.y),s=Math.abs(t.bottom-e.y),r=Math.abs(t.right-e.x),n=Math.abs(t.left-e.x);switch(Math.min(a,s,r,n)){case n:return"left";case r:return"right";case a:return"top";case s:return"bottom";default:throw Error("unreachable")}}(s,a.getBoundingClientRect());c(function(e){let t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();let t=[];for(let a=0;a<e.length;a++){let s=e[a];for(;t.length>=2;){let e=t[t.length-1],a=t[t.length-2];if((e.x-a.x)*(s.y-a.y)>=(e.y-a.y)*(s.x-a.x))t.pop();else break}t.push(s)}t.pop();let a=[];for(let t=e.length-1;t>=0;t--){let s=e[t];for(;a.length>=2;){let e=a[a.length-1],t=a[a.length-2];if((e.x-t.x)*(s.y-t.y)>=(e.y-t.y)*(s.x-t.x))a.pop();else break}a.push(s)}return(a.pop(),1===t.length&&1===a.length&&t[0].x===a[0].x&&t[0].y===a[0].y)?t:t.concat(a)}(t)}([...function(e,t,a=5){let s=[];switch(t){case"top":s.push({x:e.x-a,y:e.y+a},{x:e.x+a,y:e.y+a});break;case"bottom":s.push({x:e.x-a,y:e.y-a},{x:e.x+a,y:e.y-a});break;case"left":s.push({x:e.x+a,y:e.y-a},{x:e.x+a,y:e.y+a});break;case"right":s.push({x:e.x-a,y:e.y-a},{x:e.x-a,y:e.y+a})}return s}(s,r),...function(e){let{top:t,right:a,bottom:s,left:r}=e;return[{x:r,y:t},{x:a,y:t},{x:a,y:s},{x:r,y:s}]}(t.getBoundingClientRect())])),p(!0)},[p]);return r.useEffect(()=>()=>x(),[x]),r.useEffect(()=>{if(d&&m){let e=e=>h(e,m),t=e=>h(e,d);return d.addEventListener("pointerleave",e),m.addEventListener("pointerleave",t),()=>{d.removeEventListener("pointerleave",e),m.removeEventListener("pointerleave",t)}}},[d,m,h,x]),r.useEffect(()=>{if(o){let e=e=>{let t=e.target,a={x:e.clientX,y:e.clientY},s=d?.contains(t)||m?.contains(t),r=!function(e,t){let{x:a,y:s}=e,r=!1;for(let e=0,n=t.length-1;e<t.length;n=e++){let i=t[e].x,l=t[e].y,o=t[n].x,c=t[n].y;l>s!=c>s&&a<(o-i)*(s-l)/(c-l)+i&&(r=!r)}return r}(a,o);s?x():r&&(x(),u())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[d,m,o,u,x]),(0,s.jsx)(W,{...e,ref:l})}),[H,K]=E(Z,{isInside:!1}),W=r.forwardRef((e,t)=>{let{__scopeTooltip:a,children:n,"aria-label":i,onEscapeKeyDown:l,onPointerDownOutside:o,...c}=e,d=F(U,a),u=_(a),{onClose:m}=d;return r.useEffect(()=>(document.addEventListener(M,m),()=>document.removeEventListener(M,m)),[m]),r.useEffect(()=>{if(d.trigger){let e=e=>{let t=e.target;t?.contains(d.trigger)&&m()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[d.trigger,m]),(0,s.jsx)(v.XB,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:m,children:(0,s.jsxs)(w.VY,{"data-state":d.stateAttribute,...u,...c,ref:t,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,s.jsx)(P.A4,{children:n}),(0,s.jsx)(H,{scope:a,isInside:!0,children:(0,s.jsx)(D.f,{id:d.contentId,role:"tooltip",children:i||n})})]})})});J.displayName=U;var X="TooltipArrow";r.forwardRef((e,t)=>{let{__scopeTooltip:a,...r}=e,n=_(a);return K(X,a).isInside?null:(0,s.jsx)(w.Eh,{...n,...r,ref:t})}).displayName=X;let G=r.forwardRef(({className:e,sideOffset:t=4,...a},r)=>s.jsx(J,{ref:r,sideOffset:t,className:(0,d.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));G.displayName=J.displayName;var Y=a(41790),ee="Collapsible",[et,ea]=(0,j.b)(ee),[es,er]=et(ee),en=r.forwardRef((e,t)=>{let{__scopeCollapsible:a,open:n,defaultOpen:i,disabled:l,onOpenChange:o,...c}=e,[d=!1,u]=(0,T.T)({prop:n,defaultProp:i,onChange:o});return(0,s.jsx)(es,{scope:a,disabled:l,contentId:(0,N.M)(),open:d,onOpenToggle:r.useCallback(()=>u(e=>!e),[u]),children:(0,s.jsx)(k.WV.div,{"data-state":eu(d),"data-disabled":l?"":void 0,...c,ref:t})})});en.displayName=ee;var ei="CollapsibleTrigger",el=r.forwardRef((e,t)=>{let{__scopeCollapsible:a,...r}=e,n=er(ei,a);return(0,s.jsx)(k.WV.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":eu(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...r,ref:t,onClick:(0,y.M)(e.onClick,n.onOpenToggle)})});el.displayName=ei;var eo="CollapsibleContent",ec=r.forwardRef((e,t)=>{let{forceMount:a,...r}=e,n=er(eo,e.__scopeCollapsible);return(0,s.jsx)(C.z,{present:a||n.open,children:({present:e})=>(0,s.jsx)(ed,{...r,ref:t,present:e})})});ec.displayName=eo;var ed=r.forwardRef((e,t)=>{let{__scopeCollapsible:a,present:n,children:i,...l}=e,o=er(eo,a),[c,d]=r.useState(n),u=r.useRef(null),m=(0,b.e)(t,u),p=r.useRef(0),x=p.current,h=r.useRef(0),f=h.current,g=o.open||c,y=r.useRef(g),j=r.useRef();return r.useEffect(()=>{let e=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,Y.b)(()=>{let e=u.current;if(e){j.current=j.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";let t=e.getBoundingClientRect();p.current=t.height,h.current=t.width,y.current||(e.style.transitionDuration=j.current.transitionDuration,e.style.animationName=j.current.animationName),d(n)}},[o.open,n]),(0,s.jsx)(k.WV.div,{"data-state":eu(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!g,...l,ref:m,style:{"--radix-collapsible-content-height":x?`${x}px`:void 0,"--radix-collapsible-content-width":f?`${f}px`:void 0,...e.style},children:g&&i})});function eu(e){return e?"open":"closed"}var em=a(6e4),ep=a(71945);let ex=(0,ep.Z)("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);var eh=a(42594),ef=a(85453);let eg=(0,ep.Z)("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);var ey=a(71028),eb=a(26026),ej=a(7259),ev=a(97718);let eN=(0,ep.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var ew=a(10333);let eC=(0,ep.Z)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var ek=a(32317),eP=a(35797),eT=a(76021);let eD=(0,ep.Z)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var eE=a(40422),eI=a(52256),e_=a(14726),eS=a(39350),eM=a(88846),eR=a(7409),eq=a(12174),ez=a(89280);function eZ(e){return`${e.grip}px ${e.number}px minmax(200px, 1fr) ${e.unit}px ${e.unitCost}px ${e.markup}px ${e.unitPrice}px ${e.qty}px ${e.amount}px ${e.actions}px`}function eO({item:e,itemNumber:t,categoryId:a,categoryName:r,columnWidths:n,getItemValue:i,handleUpdateItem:l,handleDeleteItem:d,openEditItemDialog:m,handleNoteClick:p,inlineEditingNoteId:x,inlineEditText:f,setInlineEditText:g,inlineTextareaRef:y,handleInlineNoteKeyDown:b,saveInlineEdit:j,cancelInlineEdit:v,sanitizeHtml:N,formatNumber:w,formatCurrency:C}){let{attributes:k,listeners:P,setNodeRef:T,setActivatorNodeRef:D,transform:E,transition:I,isDragging:_}=(0,eR.nB)({id:e.id}),S={transform:eq.ux.Transform.toString(E),transition:I,display:"grid",gridTemplateColumns:eZ(n)};if(e?.isNote)return(0,s.jsxs)("div",{ref:T,style:S,...k,className:`items-center border-b border-gray-100 bg-amber-50 ${_?"opacity-50 bg-amber-100 shadow-lg z-50":""}`,role:"row",children:[s.jsx("div",{className:"py-2 px-1 flex items-center justify-center",role:"cell",children:s.jsx("div",{ref:D,...P,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},children:s.jsx(em.Z,{className:"w-4 h-4 text-gray-400 pointer-events-none"})})}),s.jsx("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:s.jsx(ex,{className:"w-4 h-4 text-amber-500"})}),s.jsx("div",{className:"py-2 px-2",role:"cell",style:{gridColumn:"3 / 10"},children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[x===e.id?(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[s.jsx(u,{ref:y,value:f,onChange:e=>g(e.target.value),onBlur:()=>j(e.id),onKeyDown:t=>b(t,e.id),className:"min-h-[60px] text-sm resize-none",placeholder:"Enter note text..."}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs text-gray-400",children:"Basic edit (Ctrl+Enter to save, Esc to cancel). Use expand for formatting."}),(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsxs)(o.z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-gray-500 hover:text-gray-700",onClick:e=>{e.preventDefault(),v()},children:[s.jsx(eh.Z,{className:"w-3 h-3 mr-1"}),"Cancel"]}),(0,s.jsxs)(o.z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-cyan-600 hover:text-cyan-700",onClick:t=>{t.preventDefault(),j(e.id)},children:[s.jsx(ef.Z,{className:"w-3 h-3 mr-1"}),"Save"]})]})]})]}):s.jsx("div",{className:"flex-1 min-h-[32px] px-3 py-1.5 bg-white border rounded-lg text-sm cursor-text hover:border-cyan-400 transition-colors",onClick:()=>p(e,a,r,i(e.id,"noteContent",e?.noteContent)??""),title:"Click to edit",children:i(e.id,"noteContent",e?.noteContent)?s.jsx("div",{className:"prose prose-sm max-w-none [&_strong]:font-bold [&_b]:font-bold [&_em]:italic [&_i]:italic [&_u]:underline",dangerouslySetInnerHTML:{__html:N(i(e.id,"noteContent",e?.noteContent)??"")}}):s.jsx("span",{className:"text-gray-400",children:"Click to add note..."})}),s.jsx(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-cyan-600 flex-shrink-0",onClick:()=>m(e,a,r,null),title:"Edit note with formatting (B/I/U)",children:s.jsx(eg,{className:"w-4 h-4"})})]}),s.jsx("div",{className:"flex items-center space-x-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx(h.X,{id:`pdf-${e.id}`,checked:i(e.id,"includeInPdf",e?.includeInPdf)??!0,onCheckedChange:t=>l(e?.id,{includeInPdf:t},!0)}),s.jsx("label",{htmlFor:`pdf-${e.id}`,className:"text-xs text-gray-500",children:"Include in PDF"})]})})]})}),s.jsx("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:s.jsx(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-500",onClick:()=>d(e?.id),children:s.jsx(ey.Z,{className:"w-4 h-4"})})})]});let M=i(e.id,"unitCost",e?.unitCost)??0,R=i(e.id,"markupPct",e?.markupPct)??0,q=i(e.id,"quantity",e?.quantity)??0,z=M*(1+R/100);return(0,s.jsxs)("div",{ref:T,style:S,...k,className:`items-center border-b border-gray-100 hover:bg-gray-50 ${_?"opacity-50 bg-gray-100 shadow-lg z-50":""}`,role:"row",children:[s.jsx("div",{className:"py-2 px-1 flex items-center justify-center",role:"cell",children:s.jsx("div",{ref:D,...P,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},children:s.jsx(em.Z,{className:"w-4 h-4 text-gray-400 pointer-events-none"})})}),s.jsx("div",{className:"py-2 px-2 text-gray-500 text-sm",role:"cell",children:t}),s.jsx("div",{className:"py-2 px-2 min-w-0",role:"cell",children:(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[s.jsx(c.I,{value:i(e.id,"description",e?.description)??"",onChange:t=>l(e?.id,{description:t.target.value}),className:"h-8 text-sm w-full",placeholder:"Description"}),s.jsx(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-cyan-600 flex-shrink-0",onClick:()=>m(e,a,r,t),title:"Expand to edit",children:s.jsx(eg,{className:"w-4 h-4"})})]})}),s.jsx("div",{className:"py-2 px-2",role:"cell",children:s.jsx(c.I,{value:i(e.id,"unit",e?.unit)??"",onChange:t=>l(e?.id,{unit:t.target.value}),className:"h-8 text-sm w-full",placeholder:"Unit"})}),s.jsx("div",{className:"py-2 px-2",role:"cell",children:s.jsx(c.I,{type:"number",step:"0.01",value:M,onChange:t=>l(e?.id,{unitCost:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),s.jsx("div",{className:"py-2 px-2",role:"cell",children:s.jsx(c.I,{type:"number",step:"0.01",value:R,onChange:t=>l(e?.id,{markupPct:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),s.jsx("div",{className:"py-2 px-2 text-right font-medium text-gray-700 text-sm whitespace-nowrap",role:"cell",children:w(z)}),s.jsx("div",{className:"py-2 px-2",role:"cell",children:s.jsx(c.I,{type:"number",step:"0.01",value:q,onChange:t=>l(e?.id,{quantity:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),s.jsx("div",{className:"py-2 px-2 text-right font-semibold text-cyan-600 text-sm whitespace-nowrap",role:"cell",children:C(z*q)}),s.jsx("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:s.jsx(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-500",onClick:()=>d(e?.id),children:s.jsx(ey.Z,{className:"w-4 h-4"})})})]})}function eF({category:e,categoryIndex:t,isExpanded:a,toggleCategory:n,getCategoryName:i,handleUpdateCategory:l,handleDeleteCategory:d,handleAddItem:u,formatCurrency:p,getCategorySubtotal:x,columnWidths:h,handleResizeStart:f,sensors:g,getItemNumber:y,handleItemDragStart:b,handleItemDragEnd:j,getItemValue:v,handleUpdateItem:N,handleDeleteItem:w,openEditItemDialog:C,handleNoteClick:k,inlineEditingNoteId:P,inlineEditText:T,setInlineEditText:D,inlineTextareaRef:E,handleInlineNoteKeyDown:I,saveInlineEdit:_,cancelInlineEdit:S,sanitizeHtml:M,formatNumber:R,itemLimit:q,currentItemCount:z,isAtItemLimit:Z,planKey:O}){let{attributes:F,listeners:$,setNodeRef:A,setActivatorNodeRef:L,transform:B,transition:V,isDragging:U}=(0,eR.nB)({id:e.id}),J={transform:eq.ux.Transform.toString(B),transition:V},Q=(0,r.useMemo)(()=>(e?.items??[]).map(e=>e?.id),[e?.items]);return s.jsx("div",{ref:A,style:J,...F,className:U?"opacity-50":"",children:s.jsx(m.Zb,{className:`shadow-md border-0 overflow-hidden transition-shadow ${U?"shadow-xl ring-2 ring-cyan-400":""}`,children:(0,s.jsxs)(en,{open:a,onOpenChange:()=>n(e?.id),children:[s.jsx(el,{asChild:!0,children:s.jsx(m.Ol,{className:"cursor-pointer hover:bg-gray-50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[s.jsx("div",{ref:L,...$,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},onClick:e=>e.stopPropagation(),children:s.jsx(em.Z,{className:"w-5 h-5 text-gray-400 flex-shrink-0 pointer-events-none"})}),(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-500 flex-shrink-0",children:[t+1,"."]}),s.jsx(c.I,{value:i(e),onChange:t=>{t.stopPropagation(),l(e?.id,t.target.value)},onClick:e=>e.stopPropagation(),className:"text-lg font-semibold border-0 p-0 h-auto focus-visible:ring-0 bg-transparent flex-1 min-w-0"}),(0,s.jsxs)("span",{className:"text-sm text-gray-500 flex-shrink-0",children:["(",(e?.items??[]).filter(e=>!e?.isNote).length," items)"]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[s.jsx("span",{className:"text-lg font-semibold text-cyan-600",children:p(x(e))}),s.jsx(o.z,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-red-500",onClick:t=>{t.stopPropagation(),d(e?.id)},children:s.jsx(ey.Z,{className:"w-4 h-4"})}),a?s.jsx(eb.Z,{className:"w-5 h-5 text-gray-400"}):s.jsx(ej.Z,{className:"w-5 h-5 text-gray-400"})]})]})})}),s.jsx(ec,{children:(0,s.jsxs)(m.aY,{className:"pt-0",children:[s.jsx(eM.LB,{sensors:g,collisionDetection:eM.pE,onDragStart:b,onDragEnd:t=>j(t,e.id),modifiers:[ez.DL],children:s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("div",{className:"text-sm flex flex-col",role:"table",style:{minWidth:"900px"},children:[(0,s.jsxs)("div",{role:"row",style:{display:"grid",gridTemplateColumns:eZ(h)},children:[s.jsx("div",{className:"py-2 px-1 font-medium text-gray-500 border-b border-gray-200",role:"columnheader"}),(0,s.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["#",s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"number")})]}),(0,s.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Description",s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"description")})]}),(0,s.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit",s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unit")})]}),(0,s.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit Cost",s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unitCost")})]}),(0,s.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Markup %",s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"markup")})]}),(0,s.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit Price",s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unitPrice")})]}),(0,s.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Qty",s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"qty")})]}),(0,s.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Amount",s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"amount")})]}),s.jsx("div",{className:"border-b border-gray-200",role:"columnheader"})]}),s.jsx(eR.Fo,{items:Q,strategy:eR.qw,children:(e?.items??[]).map((a,r)=>s.jsx(eO,{item:a,itemNumber:y(t,e?.items??[],r),categoryId:e.id,categoryName:e.name??"",columnWidths:h,getItemValue:v,handleUpdateItem:N,handleDeleteItem:w,openEditItemDialog:C,handleNoteClick:k,inlineEditingNoteId:P,inlineEditText:T,setInlineEditText:D,inlineTextareaRef:E,handleInlineNoteKeyDown:I,saveInlineEdit:_,cancelInlineEdit:S,sanitizeHtml:M,formatNumber:R,formatCurrency:p},a?.id))})]})})}),(0,s.jsxs)("div",{className:"flex flex-col space-y-2 mt-3",children:[Z&&(0,s.jsxs)("div",{className:"text-xs text-amber-600 bg-amber-50 px-3 py-2 rounded-md border border-amber-200",children:["Item limit reached (",z,"/",q,").",s.jsx("a",{href:"/pricing",className:"ml-1 underline hover:text-amber-700",children:"Upgrade"})," to add more items."]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)(o.z,{variant:"ghost",className:`flex-1 ${Z?"text-gray-400 cursor-not-allowed":"text-cyan-600 hover:text-cyan-700 hover:bg-cyan-50"}`,onClick:()=>u(e?.id,!1),disabled:Z,children:[s.jsx(ev.Z,{className:"w-4 h-4 mr-2"}),"Add Item ",null!==q&&`(${z}/${q})`]}),(0,s.jsxs)(o.z,{variant:"ghost",className:"text-amber-600 hover:text-amber-700 hover:bg-amber-50",onClick:()=>u(e?.id,!0),children:[s.jsx(ex,{className:"w-4 h-4 mr-2"}),"Add Note"]})]})]})]})})]})})})}function e$({boq:e,customers:t,company:a,coverTemplates:d,pdfThemes:y}){let b=(0,n.useRouter)(),[j,v]=(0,r.useState)(e),[N,w]=(0,r.useState)(t??[]),[C,k]=(0,r.useState)(d??[]),[P,T]=(0,r.useState)(y??[]),[D,E]=(0,r.useState)(new Set((e?.categories??[]).map(e=>e?.id))),[I,_]=(0,r.useState)(!1),[S,M]=(0,r.useState)(null),[R,q]=(0,r.useState)(!1),[Z,O]=(0,r.useState)(""),[F,A]=(0,r.useState)(""),[B,V]=(0,r.useState)(""),[U,J]=(0,r.useState)(!1),[Q,H]=(0,r.useState)(null),[K,W]=(0,r.useState)(null),[X,Y]=(0,r.useState)(null),[ee,et]=(0,r.useState)({}),ea=(0,r.useRef)(null),es=(0,r.useRef)(null),[er,en]=(0,r.useState)(null),[ei,el]=(0,r.useState)(""),eo=(0,r.useRef)(null),[ec,ed]=(0,r.useState)(e?.projectName??""),[eu,em]=(0,r.useState)({}),[ep,ex]=(0,r.useState)({}),eh={grip:32,number:52,description:280,unit:80,unitCost:100,markup:80,unitPrice:100,qty:70,amount:130,actions:44},[eg,ey]=(0,r.useState)(eh),[eb,ej]=(0,r.useState)(null),eq=(0,r.useRef)(0),eZ=(0,r.useRef)(0),eO=(0,r.useRef)(null),e$=(0,r.useRef)({}),eA=a?.currencySymbol??"Rs.",eL=a?.currencyPosition??"left",eB=(0,r.useCallback)(e=>e||"",[]),eV=(0,r.useCallback)(e=>!!e&&!!(RegExp("<(strong|b|em|i|u|ul|ol|li|h1|h2|h3|h4|h5|h6|blockquote|code|pre)(\\s[^>]*)?>","i").test(e)||/<span\s+[^>]*style\s*=/i.test(e)||/<[^>]+\s+style\s*=/i.test(e)),[]),eU=(0,r.useCallback)(e=>e||"",[]),eJ=(0,r.useCallback)(e=>e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>"):"",[]),eQ=(0,r.useCallback)((e,t=2)=>e.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t}),[]),eH=(0,r.useCallback)(e=>{let t=eQ(e??0,2);return"left"===eL?`${eA} ${t}`:`${t} ${eA}`},[eA,eL,eQ]),eK=(0,r.useCallback)(()=>{let e=0,t=0;(j?.categories??[]).forEach(a=>{(a?.items??[]).forEach(a=>{if(a?.isNote)return;let s=a?.quantity??0;if(s>0){let r=(a?.unitCost??0)*(1+(a?.markupPct??0)/100);e+=r*s,t+=(a?.unitCost??0)*s}})});let a=0;j?.discountEnabled&&(a=j?.discountType==="percent"?(j?.discountValue??0)/100*e:j?.discountValue??0);let s=e-a,r=j?.vatEnabled?(j?.vatPercent??0)/100*s:0,n=s-t;return{subtotal:Math.round(100*e)/100,discount:Math.round(100*a)/100,vatAmount:Math.round(100*r)/100,finalTotal:Math.round(100*(s+r))/100,totalCost:Math.round(100*t)/100,priceAfterDiscount:Math.round(100*s)/100,profit:Math.round(100*n)/100,grossProfitPct:Math.round(100*(s>0?n/s*100:0))/100}},[j])(),eW=(0,r.useRef)(null),eX=(0,r.useCallback)(async()=>{_(!0);try{await fetch(`/api/boqs/${j?.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectName:j?.projectName,customerId:j?.customerId,coverTemplateId:j?.coverTemplateId,pdfThemeId:j?.pdfThemeId,dateMode:j?.dateMode,preparationDate:j?.preparationDate,discountEnabled:j?.discountEnabled,discountType:j?.discountType,discountValue:j?.discountValue,vatEnabled:j?.vatEnabled,vatPercent:j?.vatPercent,status:j?.status})}),M(new Date)}catch(e){console.error("Autosave failed:",e)}finally{_(!1)}},[j]),eG=(0,r.useCallback)(()=>{eO.current&&clearTimeout(eO.current),eO.current=setTimeout(()=>{eW.current=eX()},1500)},[eX]),eY=(0,r.useCallback)(async()=>{eO.current&&(clearTimeout(eO.current),eO.current=null),eW.current&&await eW.current,await eX()},[eX]),e0=(0,r.useMemo)(()=>j?.categories?j.categories.reduce((e,t)=>t?.items?e+t.items.filter(e=>!e?.isNote).length:e,0):0,[j?.categories]),e2=null!==Q&&e0>=Q,e1=(0,r.useCallback)(e=>{try{localStorage.setItem("boq_column_widths",JSON.stringify(e))}catch(e){}},[]),e4=(0,r.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),ej(t),eq.current=e.clientX,eZ.current=eg[t]},[eg]);(0,r.useCallback)(e=>{if(!eb)return;let t=e.clientX-eq.current,a=Math.max(40,eZ.current+t);ey(e=>({...e,[eb]:a}))},[eb]),(0,r.useCallback)(()=>{eb&&e1(eg),ej(null)},[eb,eg,e1]);let e3=(0,r.useCallback)(()=>{ey(eh);try{localStorage.removeItem("boq_column_widths")}catch(e){}eS.ZP.success("Column widths reset to default")},[]),e5=e=>{v(t=>({...t??{},...e})),eG()},e8=e=>{ed(e),e$.current.projectName&&clearTimeout(e$.current.projectName),e$.current.projectName=setTimeout(()=>{e5({projectName:e})},500)},e6=async()=>{try{let e=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({boqId:j?.id,name:"New Category",sortOrder:j?.categories?.length??0})}),t=await e.json();v(e=>({...e??{},categories:[...e?.categories??[],{...t,items:[]}]})),E(e=>new Set([...e,t?.id]))}catch(e){eS.ZP.error("Failed to add category")}},e7=async(e,t)=>{em(a=>({...a,[e]:t})),e$.current[`cat_${e}`]&&clearTimeout(e$.current[`cat_${e}`]),e$.current[`cat_${e}`]=setTimeout(async()=>{try{await fetch(`/api/categories/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})}),v(a=>({...a??{},categories:(a?.categories??[]).map(a=>a?.id===e?{...a??{},name:t}:a)}))}catch(e){eS.ZP.error("Failed to update category")}},500)},e9=(0,r.useCallback)(e=>eu[e.id]??e.name??"",[eu]),te=async e=>{if(confirm("Delete this category and all its items?"))try{await fetch(`/api/categories/${e}`,{method:"DELETE"}),v(t=>({...t??{},categories:(t?.categories??[]).filter(t=>t?.id!==e)}))}catch(e){eS.ZP.error("Failed to delete category")}},tt=async(e,t=!1)=>{let a=(j?.categories??[]).find(t=>t?.id===e);try{let s=await fetch("/api/items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoryId:e,description:"",unit:"",unitCost:0,markupPct:0,quantity:0,sortOrder:a?.items?.length??0,isNote:t,noteContent:t?"":null,includeInPdf:!0})}),r=await s.json();if(403===s.status&&"Item limit reached"===r.error){eS.ZP.error(r.message||"Item limit reached. Upgrade to add more items.",{duration:5e3});return}if(!s.ok)throw Error(r.error||"Failed to add item");v(t=>({...t??{},categories:(t?.categories??[]).map(t=>t?.id===e?{...t??{},items:[...t?.items??[],r]}:t)}))}catch(e){eS.ZP.error("Failed to add item")}},ta=(0,r.useCallback)((e,t,a)=>ep[e]?.[t]??a,[ep]),ts=(0,r.useCallback)(async(e,t,a=!1)=>{ex(a=>({...a,[e]:{...a[e]??{},...t}})),v(a=>({...a??{},categories:(a?.categories??[]).map(a=>({...a??{},items:(a?.items??[]).map(a=>a?.id===e?{...a??{},...t}:a)}))}));let s=`item_${e}`;e$.current[s]&&clearTimeout(e$.current[s]);let r=async()=>{try{await fetch(`/api/items/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),M(new Date)}catch(e){console.error("Failed to update item:",e)}};a?r():e$.current[s]=setTimeout(r,500)},[]),tr=(0,r.useCallback)(async e=>{try{await fetch(`/api/items/${e}`,{method:"DELETE"}),v(t=>({...t??{},categories:(t?.categories??[]).map(t=>({...t??{},items:(t?.items??[]).filter(t=>t?.id!==e)}))}))}catch(e){eS.ZP.error("Failed to delete item")}},[]),tn=(0,r.useCallback)(()=>{en(null),el("")},[]),ti=(0,r.useCallback)(async e=>{let t=eJ(ei);await ts(e,{noteContent:t},!0),en(null),el("")},[ei,eJ,ts]),tl=(0,r.useCallback)((e,t)=>{if("Escape"===e.key){e.preventDefault(),tn();return}(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),ti(t))},[tn,ti]),to=(0,eM.Dy)((0,eM.VT)(eM.we,{activationConstraint:{distance:3}}),(0,eM.VT)(eM.Lg,{coordinateGetter:eR.is})),tc=(0,r.useCallback)(e=>{console.log("Item drag started:",e.active.id)},[]),td=(0,r.useCallback)(async(e,t)=>{let{active:a,over:s}=e;if(console.log("Item drag ended:",a.id,"over:",s?.id),!s||a.id===s.id)return;let r=(j?.categories??[]).find(e=>e?.id===t);if(!r)return;let n=[...r.items??[]],i=n.findIndex(e=>e.id===a.id),l=n.findIndex(e=>e.id===s.id);if(-1===i||-1===l||i===l)return;let o=(0,eR.Rp)(n,i,l).map((e,t)=>({...e,sortOrder:t}));v(e=>({...e??{},categories:(e?.categories??[]).map(e=>e?.id===t?{...e,items:o}:e)}));try{await Promise.all(o.map(e=>fetch(`/api/items/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:e.sortOrder})}))),M(new Date)}catch(e){eS.ZP.error("Failed to reorder items")}},[j?.categories]),tu=(0,r.useCallback)(e=>{},[]),tm=(0,r.useCallback)(async e=>{let{active:t,over:a}=e;if(!a||t.id===a.id)return;let s=[...j?.categories??[]],r=s.findIndex(e=>e.id===t.id),n=s.findIndex(e=>e.id===a.id);if(-1===r||-1===n||r===n)return;let i=(0,eR.Rp)(s,r,n).map((e,t)=>({...e,sortOrder:t}));v(e=>({...e??{},categories:i}));try{await Promise.all(i.map(e=>fetch(`/api/categories/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:e.sortOrder})}))),M(new Date)}catch(e){eS.ZP.error("Failed to reorder categories")}},[j?.categories]),tp=(0,r.useCallback)((e,t,a,s)=>{let r=e.noteContent,n=ep[e.id]?.noteContent;void 0!==n&&(r=n),es.current=null,Y({item:{...e,noteContent:r},categoryId:t,categoryName:a,itemNumber:s}),et({description:e.description,unit:e.unit,unitCost:e.unitCost,markupPct:e.markupPct,quantity:e.quantity,noteContent:r,includeInPdf:e.includeInPdf})},[ep]),tx=(0,r.useCallback)((e,t,a,s)=>{if(eV(s)){tp(e,t,a,null);return}el(eU(s)),en(e.id),setTimeout(()=>{eo.current?.focus()},50)},[eV,tp,eU]),th=async()=>{X&&(await ts(X.item.id,ee,!0),Y(null),et({}))},tf=(0,r.useCallback)(e=>{if(ea.current&&ea.current.focus(),document.execCommand(e,!1),ea.current){let e=ea.current.innerHTML;et(t=>({...t,noteContent:e}))}},[]),tg=(0,r.useCallback)(e=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&("b"===e.key||"B"===e.key?(e.preventDefault(),tf("bold")):"i"===e.key||"I"===e.key?(e.preventDefault(),tf("italic")):("u"===e.key||"U"===e.key)&&(e.preventDefault(),tf("underline")))},[tf]),ty=async()=>{if(!Z?.trim?.()){eS.ZP.error("Please enter a customer name");return}try{let e=await fetch("/api/customers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:Z,email:F||null,phone:B||null})}),t=await e.json();if(!e.ok){eS.ZP.error(t?.error||"Failed to create customer");return}w([...N??[],t]),e5({customerId:t?.id}),q(!1),O(""),A(""),V(""),eS.ZP.success("Customer created")}catch(e){eS.ZP.error("An error occurred")}},tb=async()=>{let e;J(!0);try{await eY(),e=eS.ZP.loading("Starting PDF export...");let t=await fetch(`/api/boqs/${j?.id}/pdf/async`,{method:"POST"});if(!t.ok)throw Error("Failed to start PDF export");let{jobId:a,status:s,message:r}=await t.json();if(!a)throw Error("No job ID returned");eS.ZP.loading("Generating PDF...",{id:e});let n=0;for(;n<300;){await new Promise(e=>setTimeout(e,1e3));let t=await fetch(`/api/pdf-jobs/${a}`);if(!t.ok)throw Error("Failed to check job status");let{status:s,pdfUrl:r,errorMessage:i,elapsedMs:l}=await t.json();if("processing"===s&&l>0&&eS.ZP.loading(`Generating PDF... (${Math.round(l/1e3)}s)`,{id:e}),"completed"===s&&r){if(eS.ZP.loading("Downloading PDF...",{id:e}),r.startsWith("data:")){let e=r.split(",")[1],t=atob(e),a=Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);let s=new Uint8Array(a),n=new Blob([s],{type:"application/pdf"}),i=window.URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.download=`${j?.projectName??"BOQ"}.pdf`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(i),document.body.removeChild(l)}else{let e=document.createElement("a");e.href=r,e.download=`${j?.projectName??"BOQ"}.pdf`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}eS.ZP.success("PDF downloaded",{id:e});return}if("failed"===s)throw Error(i||"PDF generation failed");n++}throw Error("PDF generation timed out")}catch(a){let t=a instanceof Error?a.message:"Failed to export PDF";e?eS.ZP.error(t,{id:e}):eS.ZP.error(t)}finally{J(!1)}},tj=(0,r.useCallback)(e=>{E(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),tv=(0,r.useCallback)(e=>(e?.items??[]).reduce((e,t)=>{if(t?.isNote)return e;let a=t?.quantity??0;return a>0?e+(t?.unitCost??0)*(1+(t?.markupPct??0)/100)*a:e},0),[]),tN=(0,r.useCallback)((e,t,a)=>{let s=t[a];if(s?.isNote)return null;let r=0;for(let e=0;e<=a;e++)!t[e]?.isNote&&r++;return`${e+1}.${r}`},[]),tw=(0,r.useMemo)(()=>(j?.categories??[]).map(e=>e?.id),[j?.categories]);return s.jsx(l.AppLayout,{children:(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[s.jsx(i.default,{href:"/dashboard",children:s.jsx(o.z,{variant:"ghost",size:"icon",className:"flex-shrink-0",children:s.jsx(eN,{className:"w-5 h-5"})})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 max-w-2xl",children:[s.jsx(c.I,{value:ec,onChange:e=>e8(e.target.value),className:"text-xl font-semibold border-0 p-0 h-auto focus-visible:ring-0 bg-transparent w-full",placeholder:"Project Name"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,s.jsxs)(f.Ph,{value:j?.customerId??"none",onValueChange:e=>e5({customerId:"none"===e?null:e}),children:[s.jsx(f.i4,{className:"h-8 text-sm w-[200px]",children:s.jsx(f.ki,{placeholder:"Select customer"})}),(0,s.jsxs)(f.Bw,{children:[s.jsx(f.Ql,{value:"none",children:"No customer"}),(N??[]).map(e=>s.jsx(f.Ql,{value:e?.id??"",children:e?.name},e?.id))]})]}),s.jsx(o.z,{variant:"outline",size:"sm",onClick:()=>q(!0),children:s.jsx(ev.Z,{className:"w-4 h-4"})})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[s.jsx("div",{className:"flex items-center text-sm text-gray-500",children:I?(0,s.jsxs)(s.Fragment,{children:[s.jsx(ew.Z,{className:"w-4 h-4 animate-spin mr-1"}),"Saving..."]}):S?(0,s.jsxs)(s.Fragment,{children:[s.jsx(ef.Z,{className:"w-4 h-4 text-green-500 mr-1"}),"Saved"]}):null}),s.jsx(z,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2 border-l pl-3",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[s.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Cover Page"}),(0,s.jsxs)($,{children:[s.jsx(L,{asChild:!0,children:s.jsx(eC,{className:"w-3 h-3 text-gray-400 cursor-help"})}),s.jsx(G,{children:s.jsx("p",{className:"text-xs max-w-48",children:"Controls the cover page elements, layout, and styling"})})]})]}),(0,s.jsxs)(f.Ph,{value:j?.coverTemplateId||"default",onValueChange:e=>{if("create_new"===e){b.push("/app/settings?tab=pdf");return}e5({coverTemplateId:"default"===e?null:e})},children:[(0,s.jsxs)(f.i4,{className:"w-40 h-8 text-xs",children:[s.jsx(ek.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),s.jsx(f.ki,{placeholder:"Cover Template"})]}),(0,s.jsxs)(f.Bw,{children:[s.jsx(f.Ql,{value:"default",children:"Company Default"}),C.map(e=>(0,s.jsxs)(f.Ql,{value:e.id,children:[e.name," ",e.isDefault&&"★"]},e.id)),s.jsx("div",{className:"border-t my-1"}),(0,s.jsxs)(f.Ql,{value:"create_new",className:"text-cyan-600",children:[s.jsx(ev.Z,{className:"w-3 h-3 mr-1 inline"}),"Create new template..."]})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[s.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"PDF Theme"}),(0,s.jsxs)($,{children:[s.jsx(L,{asChild:!0,children:s.jsx(eC,{className:"w-3 h-3 text-gray-400 cursor-help"})}),s.jsx(G,{children:s.jsx("p",{className:"text-xs max-w-48",children:"Controls colors/shading for BOQ pages (layout unchanged)"})})]})]}),(0,s.jsxs)(f.Ph,{value:j?.pdfThemeId||"default",onValueChange:e=>{if("create_new"===e){b.push("/app/settings?tab=pdf");return}e5({pdfThemeId:"default"===e?null:e})},children:[(0,s.jsxs)(f.i4,{className:"w-36 h-8 text-xs",children:[s.jsx(eP.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),s.jsx(f.ki,{placeholder:"Color Theme"})]}),(0,s.jsxs)(f.Bw,{children:[s.jsx(f.Ql,{value:"default",children:"Default Theme"}),P.map(e=>(0,s.jsxs)(f.Ql,{value:e.id,children:[e.name," ",e.isDefault&&"★"]},e.id)),s.jsx("div",{className:"border-t my-1"}),(0,s.jsxs)(f.Ql,{value:"create_new",className:"text-cyan-600",children:[s.jsx(ev.Z,{className:"w-3 h-3 mr-1 inline"}),"Create new theme..."]})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[s.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Date"}),(0,s.jsxs)($,{children:[s.jsx(L,{asChild:!0,children:s.jsx(eC,{className:"w-3 h-3 text-gray-400 cursor-help"})}),s.jsx(G,{children:s.jsx("p",{className:"text-xs max-w-48",children:"Date shown on PDF cover page"})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsxs)(f.Ph,{value:j?.dateMode||"export_date",onValueChange:e=>{e5({dateMode:e})},children:[(0,s.jsxs)(f.i4,{className:"w-32 h-8 text-xs",children:[s.jsx(eT.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),s.jsx(f.ki,{})]}),(0,s.jsxs)(f.Bw,{children:[s.jsx(f.Ql,{value:"export_date",children:"Export Date"}),s.jsx(f.Ql,{value:"preparation_date",children:"Custom Date"})]})]}),j?.dateMode==="preparation_date"&&s.jsx("input",{type:"date",value:j?.preparationDate?new Date(j.preparationDate).toISOString().split("T")[0]:"",onChange:e=>e5({preparationDate:e.target.value?new Date(e.target.value).toISOString():null}),className:"h-8 px-2 text-xs border rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]})]})}),(0,s.jsxs)(o.z,{variant:"outline",onClick:tb,disabled:U,children:[U?s.jsx(ew.Z,{className:"w-4 h-4 animate-spin mr-2"}):s.jsx(eD,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]})]}),s.jsx("div",{className:"flex-1 overflow-auto p-6",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)(m.Zb,{className:"shadow-md border-0 bg-gradient-to-br from-cyan-50 to-teal-50",children:[s.jsx(m.Ol,{className:"pb-2",children:s.jsx(m.ll,{className:"text-lg",children:"Totals"})}),(0,s.jsxs)(m.aY,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center py-1",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotal"}),s.jsx("span",{className:"font-semibold",children:eH(eK.subtotal)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx(p._,{className:"text-gray-600",children:"Discount"}),s.jsx(x.r,{checked:j?.discountEnabled??!1,onCheckedChange:e=>e5({discountEnabled:e})})]}),j?.discountEnabled&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)(f.Ph,{value:j?.discountType??"percent",onValueChange:e=>e5({discountType:e}),children:[s.jsx(f.i4,{className:"w-20 h-8",children:s.jsx(f.ki,{})}),(0,s.jsxs)(f.Bw,{children:[s.jsx(f.Ql,{value:"percent",children:"%"}),s.jsx(f.Ql,{value:"fixed",children:"Fixed"})]})]}),s.jsx(c.I,{type:"number",step:"0.01",value:j?.discountValue??0,onChange:e=>e5({discountValue:parseFloat(e.target.value)||0}),className:"w-24 h-8"}),eK.discount>0&&(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["-",eH(eK.discount)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx(p._,{className:"text-gray-600",children:"VAT"}),s.jsx(x.r,{checked:j?.vatEnabled??!1,onCheckedChange:e=>e5({vatEnabled:e})})]}),j?.vatEnabled&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx(c.I,{type:"number",step:"0.01",value:j?.vatPercent??0,onChange:e=>e5({vatPercent:parseFloat(e.target.value)||0}),className:"w-20 h-8"}),s.jsx("span",{className:"text-gray-500",children:"%"}),(0,s.jsxs)("span",{className:"text-gray-500",children:["+",eH(eK.vatAmount)]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-t-2 border-cyan-200",children:[s.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Final Total"}),s.jsx("span",{className:"text-2xl font-bold text-cyan-600",children:eH(eK.finalTotal)})]})]})]}),(0,s.jsxs)(m.Zb,{className:"shadow-md border-0",children:[s.jsx(m.Ol,{className:"pb-2",children:s.jsx(m.ll,{className:"text-lg",children:"Profit Analysis"})}),(0,s.jsxs)(m.aY,{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Total Cost"}),s.jsx("span",{className:"font-medium",children:eH(eK.totalCost)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Price (after discount)"}),s.jsx("span",{className:"font-medium",children:eH(eK.priceAfterDiscount)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[s.jsx("span",{className:"text-gray-600",children:"Profit"}),s.jsx("span",{className:`font-semibold ${eK.profit>=0?"text-emerald-600":"text-red-600"}`,children:eH(eK.profit)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Gross Profit %"}),(0,s.jsxs)("span",{className:`font-semibold ${eK.grossProfitPct>=0?"text-emerald-600":"text-red-600"}`,children:[eQ(eK.grossProfitPct),"%"]})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{onClick:e3,className:"text-xs text-gray-500 hover:text-cyan-600 transition-colors",title:"Reset column widths to default",children:"Reset column widths"})}),s.jsx(eM.LB,{sensors:to,collisionDetection:eM.pE,onDragStart:tu,onDragEnd:tm,modifiers:[ez.DL],children:s.jsx(eR.Fo,{items:tw,strategy:eR.qw,children:(j?.categories??[]).map((e,t)=>s.jsx(eF,{category:e,categoryIndex:t,isExpanded:D.has(e?.id),toggleCategory:tj,getCategoryName:e9,handleUpdateCategory:e7,handleDeleteCategory:te,handleAddItem:tt,formatCurrency:eH,getCategorySubtotal:tv,columnWidths:eg,handleResizeStart:e4,sensors:to,getItemNumber:tN,handleItemDragStart:tc,handleItemDragEnd:td,getItemValue:ta,handleUpdateItem:ts,handleDeleteItem:tr,openEditItemDialog:tp,handleNoteClick:tx,inlineEditingNoteId:er,inlineEditText:ei,setInlineEditText:el,inlineTextareaRef:eo,handleInlineNoteKeyDown:tl,saveInlineEdit:ti,cancelInlineEdit:tn,sanitizeHtml:eB,formatNumber:eQ,itemLimit:Q,currentItemCount:e0,isAtItemLimit:e2,planKey:K},e?.id))})}),(0,s.jsxs)(o.z,{variant:"outline",className:"w-full border-dashed border-2",onClick:e6,children:[s.jsx(ev.Z,{className:"w-4 h-4 mr-2"}),"Add Category"]})]})]})}),s.jsx(g.Vq,{open:R,onOpenChange:q,children:(0,s.jsxs)(g.cZ,{children:[s.jsx(g.fK,{children:s.jsx(g.$N,{children:"Add New Customer"})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{htmlFor:"customerName",children:"Name"}),s.jsx(c.I,{id:"customerName",placeholder:"Customer name",value:Z,onChange:e=>O(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{htmlFor:"customerEmail",children:"Email (Optional)"}),s.jsx(c.I,{id:"customerEmail",type:"email",placeholder:"customer@email.com",value:F,onChange:e=>A(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{htmlFor:"customerPhone",children:"Phone (Optional)"}),s.jsx(c.I,{id:"customerPhone",placeholder:"Phone number",value:B,onChange:e=>V(e.target.value)})]})]}),(0,s.jsxs)(g.cN,{children:[s.jsx(o.z,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),s.jsx(o.z,{onClick:ty,children:"Add Customer"})]})]})}),s.jsx(g.Vq,{open:!!X,onOpenChange:e=>!e&&Y(null),children:(0,s.jsxs)(g.cZ,{className:"max-w-2xl",children:[(0,s.jsxs)(g.fK,{children:[s.jsx(g.$N,{children:X?.item.isNote?"Edit Note":`Edit Item ${X?.itemNumber??""}`}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Category: ",X?.categoryName]})]}),s.jsx("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto",children:X?.item.isNote?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{children:"Note Content"}),(0,s.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1 p-2 border-b bg-gray-50",children:[s.jsx(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0 font-bold",onMouseDown:e=>{e.preventDefault(),tf("bold")},title:"Bold (Ctrl+B)",children:s.jsx(eE.Z,{className:"w-4 h-4"})}),s.jsx(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onMouseDown:e=>{e.preventDefault(),tf("italic")},title:"Italic (Ctrl+I)",children:s.jsx(eI.Z,{className:"w-4 h-4"})}),s.jsx(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onMouseDown:e=>{e.preventDefault(),tf("underline")},title:"Underline (Ctrl+U)",children:s.jsx(e_.Z,{className:"w-4 h-4"})}),s.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"Select text and click to format (or use Ctrl+B/I/U)"})]}),s.jsx("div",{ref:ea,contentEditable:!0,suppressContentEditableWarning:!0,className:"min-h-[150px] p-3 focus:outline-none text-sm prose prose-sm max-w-none [&_strong]:font-bold [&_b]:font-bold [&_em]:italic [&_i]:italic [&_u]:underline",onInput:e=>{let t=e.currentTarget;et(e=>({...e,noteContent:t.innerHTML}))},onKeyDown:tg})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx(h.X,{id:"edit-includeInPdf",checked:ee.includeInPdf??!0,onCheckedChange:e=>et(t=>({...t,includeInPdf:e}))}),s.jsx("label",{htmlFor:"edit-includeInPdf",className:"text-sm text-gray-600",children:"Include in PDF"})]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{htmlFor:"edit-description",children:"Description"}),s.jsx(u,{id:"edit-description",placeholder:"Enter item description...",value:ee.description??"",onChange:e=>et(t=>({...t,description:e.target.value})),className:"min-h-[100px]"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{htmlFor:"edit-unit",children:"Unit"}),s.jsx(c.I,{id:"edit-unit",placeholder:"e.g., Sqm, Cub, Nos",value:ee.unit??"",onChange:e=>et(t=>({...t,unit:e.target.value}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{htmlFor:"edit-unitCost",children:"Unit Cost"}),s.jsx(c.I,{id:"edit-unitCost",type:"number",step:"0.01",value:ee.unitCost??0,onChange:e=>et(t=>({...t,unitCost:parseFloat(e.target.value)||0}))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{htmlFor:"edit-markupPct",children:"Markup %"}),s.jsx(c.I,{id:"edit-markupPct",type:"number",step:"0.01",value:ee.markupPct??0,onChange:e=>et(t=>({...t,markupPct:parseFloat(e.target.value)||0}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(p._,{htmlFor:"edit-quantity",children:"Quantity"}),s.jsx(c.I,{id:"edit-quantity",type:"number",step:"0.01",value:ee.quantity??0,onChange:e=>et(t=>({...t,quantity:parseFloat(e.target.value)||0}))})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Unit Price:"}),s.jsx("span",{className:"font-medium",children:eH((ee.unitCost??0)*(1+(ee.markupPct??0)/100))})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Amount:"}),s.jsx("span",{className:"font-semibold text-cyan-600",children:eH((ee.unitCost??0)*(1+(ee.markupPct??0)/100)*(ee.quantity??0))})]})]})]})}),(0,s.jsxs)(g.cN,{children:[s.jsx(o.z,{variant:"outline",onClick:()=>Y(null),children:"Cancel"}),s.jsx(o.z,{onClick:th,children:"Save Changes"})]})]})})]})})}},16098:(e,t,a)=>{"use strict";a.d(t,{X:()=>P});var s=a(62901),r=a(24383),n=a(56163),i=a(89291),l=a(1940),o=a(98106),c=a(45666),d=a(49209),u=a(52490),m=a(74132),p="Checkbox",[x,h]=(0,i.b)(p),[f,g]=x(p),y=r.forwardRef((e,t)=>{let{__scopeCheckbox:a,name:i,checked:c,defaultChecked:d,required:u,disabled:p,value:x="on",onCheckedChange:h,...g}=e,[y,b]=r.useState(null),j=(0,n.e)(t,e=>b(e)),C=r.useRef(!1),k=!y||!!y.closest("form"),[P=!1,T]=(0,o.T)({prop:c,defaultProp:d,onChange:h}),D=r.useRef(P);return r.useEffect(()=>{let e=y?.form;if(e){let t=()=>T(D.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[y,T]),(0,s.jsxs)(f,{scope:a,state:P,disabled:p,children:[(0,s.jsx)(m.WV.button,{type:"button",role:"checkbox","aria-checked":N(P)?"mixed":P,"aria-required":u,"data-state":w(P),"data-disabled":p?"":void 0,disabled:p,value:x,...g,ref:j,onKeyDown:(0,l.M)(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,l.M)(e.onClick,e=>{T(e=>!!N(e)||!e),k&&(C.current=e.isPropagationStopped(),C.current||e.stopPropagation())})}),k&&(0,s.jsx)(v,{control:y,bubbles:!C.current,name:i,value:x,checked:P,required:u,disabled:p,style:{transform:"translateX(-100%)"}})]})});y.displayName=p;var b="CheckboxIndicator",j=r.forwardRef((e,t)=>{let{__scopeCheckbox:a,forceMount:r,...n}=e,i=g(b,a);return(0,s.jsx)(u.z,{present:r||N(i.state)||!0===i.state,children:(0,s.jsx)(m.WV.span,{"data-state":w(i.state),"data-disabled":i.disabled?"":void 0,...n,ref:t,style:{pointerEvents:"none",...e.style}})})});j.displayName=b;var v=e=>{let{control:t,checked:a,bubbles:n=!0,...i}=e,l=r.useRef(null),o=(0,c.D)(a),u=(0,d.t)(t);return r.useEffect(()=>{let e=l.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(o!==a&&t){let s=new Event("click",{bubbles:n});e.indeterminate=N(a),t.call(e,!N(a)&&a),e.dispatchEvent(s)}},[o,a,n]),(0,s.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:!N(a)&&a,...i,tabIndex:-1,ref:l,style:{...e.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function N(e){return"indeterminate"===e}function w(e){return N(e)?"indeterminate":e?"checked":"unchecked"}var C=a(85453),k=a(68637);let P=r.forwardRef(({className:e,...t},a)=>s.jsx(y,{ref:a,className:(0,k.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:s.jsx(j,{className:(0,k.cn)("flex items-center justify-center text-current"),children:s.jsx(C.Z,{className:"h-4 w-4"})})}));P.displayName=y.displayName},65923:(e,t,a)=>{"use strict";a.d(t,{$N:()=>h,Be:()=>f,Vq:()=>o,cN:()=>x,cZ:()=>m,fK:()=>p,hg:()=>c});var s=a(62901),r=a(24383),n=a(18832),i=a(42594),l=a(68637);let o=n.fC,c=n.xz,d=n.h_;n.x8;let u=r.forwardRef(({className:e,...t},a)=>s.jsx(n.aV,{ref:a,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));u.displayName=n.aV.displayName;let m=r.forwardRef(({className:e,children:t,...a},r)=>(0,s.jsxs)(d,{children:[s.jsx(u,{}),(0,s.jsxs)(n.VY,{ref:r,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-xl",e),...a,children:[t,(0,s.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(i.Z,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));m.displayName=n.VY.displayName;let p=({className:e,...t})=>s.jsx("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});p.displayName="DialogHeader";let x=({className:e,...t})=>s.jsx("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});x.displayName="DialogFooter";let h=r.forwardRef(({className:e,...t},a)=>s.jsx(n.Dx,{ref:a,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));h.displayName=n.Dx.displayName;let f=r.forwardRef(({className:e,...t},a)=>s.jsx(n.dk,{ref:a,className:(0,l.cn)("text-sm text-muted-foreground",e),...t}));f.displayName=n.dk.displayName},250:(e,t,a)=>{"use strict";a.d(t,{I:()=>i});var s=a(62901),r=a(24383),n=a(68637);let i=r.forwardRef(({className:e,type:t,...a},r)=>s.jsx("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));i.displayName="Input"},82657:(e,t,a)=>{"use strict";a.d(t,{_:()=>c});var s=a(62901),r=a(24383),n=a(8388),i=a(47279),l=a(68637);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef(({className:e,...t},a)=>s.jsx(n.f,{ref:a,className:(0,l.cn)(o(),e),...t}));c.displayName=n.f.displayName},72388:(e,t,a)=>{"use strict";a.d(t,{Bw:()=>h,Ph:()=>d,Ql:()=>f,i4:()=>m,ki:()=>u});var s=a(62901),r=a(24383),n=a(76960),i=a(7259),l=a(26026),o=a(85453),c=a(68637);let d=n.fC;n.ZA;let u=n.B4,m=r.forwardRef(({className:e,children:t,...a},r)=>(0,s.jsxs)(n.xz,{ref:r,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...a,children:[t,s.jsx(n.JO,{asChild:!0,children:s.jsx(i.Z,{className:"h-4 w-4 opacity-50"})})]}));m.displayName=n.xz.displayName;let p=r.forwardRef(({className:e,...t},a)=>s.jsx(n.u_,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:s.jsx(l.Z,{className:"h-4 w-4"})}));p.displayName=n.u_.displayName;let x=r.forwardRef(({className:e,...t},a)=>s.jsx(n.$G,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:s.jsx(i.Z,{className:"h-4 w-4"})}));x.displayName=n.$G.displayName;let h=r.forwardRef(({className:e,children:t,position:a="popper",...r},i)=>s.jsx(n.h_,{children:(0,s.jsxs)(n.VY,{ref:i,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-lg border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...r,children:[s.jsx(p,{}),s.jsx(n.l_,{className:(0,c.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),s.jsx(x,{})]})}));h.displayName=n.VY.displayName,r.forwardRef(({className:e,...t},a)=>s.jsx(n.__,{ref:a,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=n.__.displayName;let f=r.forwardRef(({className:e,children:t,...a},r)=>(0,s.jsxs)(n.ck,{ref:r,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-md py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(n.wU,{children:s.jsx(o.Z,{className:"h-4 w-4"})})}),s.jsx(n.eT,{children:t})]}));f.displayName=n.ck.displayName,r.forwardRef(({className:e,...t},a)=>s.jsx(n.Z0,{ref:a,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=n.Z0.displayName},84377:(e,t,a)=>{"use strict";a.d(t,{r:()=>l});var s=a(62901),r=a(24383),n=a(59094),i=a(68637);let l=r.forwardRef(({className:e,...t},a)=>s.jsx(n.fC,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:a,children:s.jsx(n.bU,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));l.displayName=n.fC.displayName},76021:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(71945).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},28405:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u,dynamic:()=>d});var s=a(83537),r=a(57978),n=a(86023),i=a(15438),l=a(83178);let o=(0,a(88895).createProxy)(String.raw`/home/ubuntu/make_estimate/nextjs_space/app/app/boq/[id]/_components/boq-editor-client.tsx#BoqEditorClient`);var c=a(90391);let d="force-dynamic";async function u({params:e}){let t=await (0,r.getServerSession)(n.L);t?.user||(0,i.redirect)("/login");let a=t.user?.companyId;a||(0,i.redirect)("/login"),(await (0,c.qf)(a)).hasActiveSubscription||(0,i.redirect)("/pricing?subscription=required");let[d,u,m,p,x]=await Promise.all([l._.boq.findFirst({where:{id:e?.id,companyId:a},include:{customer:!0,coverTemplate:!0,pdfTheme:!0,categories:{include:{items:{orderBy:{sortOrder:"asc"}}},orderBy:{sortOrder:"asc"}}}}),l._.customer.findMany({where:{companyId:a},orderBy:{name:"asc"}}),l._.company.findUnique({where:{id:a}}),l._.pdfCoverTemplate.findMany({where:{companyId:a},orderBy:[{isDefault:"desc"},{name:"asc"}]}),l._.pdfTheme.findMany({where:{companyId:a},orderBy:[{isDefault:"desc"},{name:"asc"}]})]);return d||(0,i.redirect)("/app/dashboard"),s.jsx(o,{boq:JSON.parse(JSON.stringify(d)),customers:JSON.parse(JSON.stringify(u??[])),company:JSON.parse(JSON.stringify(m??{})),coverTemplates:JSON.parse(JSON.stringify(p??[])),pdfThemes:JSON.parse(JSON.stringify(x??[]))})}},86023:(e,t,a)=>{"use strict";a.d(t,{L:()=>l});var s=a(66291),r=a(3390),n=a.n(r),i=a(83178);let l={providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await i._.user.findUnique({where:{email:e.email},include:{memberships:{include:{company:!0}}}});if(!t||!await n().compare(e.password,t.password))return null;await i._.user.update({where:{id:t.id},data:{lastLoginAt:new Date}}).catch(e=>console.error("Failed to update lastLoginAt:",e));let a=t?.memberships?.[0];return{id:t.id,email:t.email,name:t.name,companyId:a?.companyId??null,companyName:a?.company?.name??null,role:a?.role??"MEMBER"}}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.companyId=t.companyId,e.companyName=t.companyName,e.role=t.role),e),session:async({session:e,token:t})=>(e?.user&&(e.user.id=t.id,e.user.companyId=t.companyId,e.user.companyName=t.companyName,e.user.role=t.role),e)},pages:{signIn:"/login"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[4372,7329,5990,1303,1263,2116,5882,3159,9995,391,8241],()=>a(24006));module.exports=s})();