(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[253],{4158:function(e,t,r){Promise.resolve().then(r.bind(r,6490))},6490:function(e,t,r){"use strict";r.d(t,{BoqsClient:function(){return C}});var s=r(5444),a=r(9300),l=r(9047),n=r(179),i=r(7367),c=r(2422),o=r(4678),d=r(9827),u=r(1335),m=r(9530),p=r(4635),x=r(489),h=r(9429),f=r(362),j=r(5076),y=r(6771);let N=(0,r(2154).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var b=r(5012),g=r(563),v=r(1946),w=r(4611),k=r(1084);function C({initialBoqs:e,billingStatus:t,company:r}){let C=(0,l.useRouter)(),[Z,B]=(0,a.useState)(e??[]),[O,P]=(0,a.useState)(""),[Q,E]=(0,a.useState)(!1),[S,q]=(0,a.useState)(!1),[_,z]=(0,a.useState)(null),[M,T]=(0,a.useState)(""),[R,$]=(0,a.useState)(""),[V,A]=(0,a.useState)([]),[L,D]=(0,a.useState)(!1),[I,F]=(0,a.useState)(!1),U=r?.currencySymbol??"Rs.",Y=r?.currencyPosition??"left",G=function(e,t){let[r,s]=(0,a.useState)(e);return(0,a.useEffect)(()=>{let t=setTimeout(()=>s(e),300);return()=>clearTimeout(t)},[e,300]),r}(O,0);(0,a.useEffect)(()=>{fetch("/api/customers").then(e=>e.json()).then(e=>A(e??[])).catch(()=>{})},[]),(0,a.useEffect)(()=>{Z.slice(0,5).forEach(e=>{C.prefetch(`/app/boq/${e.id}`)})},[Z,C]);let K=(0,a.useMemo)(()=>{if(!G.trim())return Z;let e=G.toLowerCase();return Z.filter(t=>{let r=t.projectName?.toLowerCase()??"",s=t.customer?.name?.toLowerCase()??"",a=t.id?.toLowerCase()??"";return r.includes(e)||s.includes(e)||a.includes(e)})},[Z,G]),H=e=>{let t=e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return"left"===Y?`${U} ${t}`:`${t} ${U}`},J=async()=>{if(!M?.trim?.()){w.ZP.error("Please enter a project name");return}if(!t.canCreateBoq){w.ZP.error("BOQ limit reached. Please upgrade your plan.");return}D(!0);try{let e=await fetch("/api/boqs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectName:M,customerId:R||null})}),t=await e.json();if(!e.ok){403===e.status&&"LIMIT_EXCEEDED"===t.code?w.ZP.error((0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"font-medium",children:"BOQ limit reached"}),(0,s.jsx)("span",{className:"text-sm",children:t.message})]})):w.ZP.error(t?.error||"Failed to create BOQ");return}w.ZP.success("BOQ created!"),E(!1),T(""),$(""),C.push(`/app/boq/${t.id}`)}catch(e){w.ZP.error("An error occurred")}finally{D(!1)}},W=e=>{z(e),q(!0)},X=async()=>{if(_){F(!0);try{if(!(await fetch(`/api/boqs/${_.id}`,{method:"DELETE"})).ok){w.ZP.error("Failed to delete BOQ");return}B(e=>e.filter(e=>e.id!==_.id)),w.ZP.success("BOQ deleted"),q(!1),z(null)}catch(e){w.ZP.error("An error occurred")}finally{F(!1)}}},ee=(0,a.useCallback)(e=>{C.prefetch(`/app/boq/${e}`)},[C]);return(0,s.jsx)(i.AppLayout,{children:(0,s.jsxs)("div",{className:"p-6 max-w-5xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"BOQs"}),(0,s.jsx)("p",{className:"text-gray-500 mt-1",children:"Manage your Bills of Quantities"})]}),(0,s.jsxs)(c.z,{onClick:()=>E(!0),className:"shadow-md",disabled:!t.canCreateBoq,children:[(0,s.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"New BOQ"]})]}),!t.canCreateBoq&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3",children:[(0,s.jsx)(f.Z,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-amber-800 font-medium",children:"BOQ limit reached"}),(0,s.jsxs)("p",{className:"text-amber-700 text-sm mt-1",children:["You've used ",t.boqsUsedThisPeriod," of ",t.boqLimit," BOQs this period."]}),(0,s.jsx)(k.default,{href:"/pricing",children:(0,s.jsx)(c.z,{variant:"outline",size:"sm",className:"mt-2 border-amber-300 text-amber-700 hover:bg-amber-100",children:"Upgrade Plan"})})]})]}),(0,s.jsxs)("div",{className:"relative mb-6",children:[(0,s.jsx)(j.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)(o.I,{placeholder:"Search BOQs by project, customer, reference...",value:O,onChange:e=>P(e.target.value),className:"pl-10"})]}),(0,s.jsxs)(d.Zb,{className:"shadow-md border-0",children:[(0,s.jsx)(d.Ol,{children:(0,s.jsxs)(d.ll,{className:"text-lg",children:["All BOQs (",K.length,")"]})}),(0,s.jsx)(d.aY,{children:0===K.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(y.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-500",children:O?"No BOQs match your search":"No BOQs yet"}),!O&&t.canCreateBoq&&(0,s.jsx)(c.z,{variant:"outline",className:"mt-4",onClick:()=>E(!0),children:"Create your first BOQ"})]}):(0,s.jsx)("div",{className:"space-y-3",children:K.map(e=>{let t;return(0,s.jsxs)("div",{onMouseEnter:()=>ee(e.id),className:"flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer group",onClick:()=>C.push(`/app/boq/${e.id}`),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 min-w-0 flex-1",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-400 to-lavender-400 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,s.jsx)(y.Z,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900 truncate",title:e.projectName,children:e.projectName}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm text-gray-500 flex-wrap",children:[e.customer&&(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(N,{className:"w-3 h-3 mr-1"}),e.customer.name]}),(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(b.Z,{className:"w-3 h-3 mr-1"}),(0,n.WU)(new Date(e.createdAt),"MMM d, yyyy")]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-3 sm:mt-0",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900 tabular-nums",children:H((t=0,(e.categories||[]).forEach(e=>{(e.items||[]).forEach(e=>{if(e.isNote)return;let r=e.markupPct??0,s=e.quantity??1,a=(e.unitCost??0)*(1+r/100);t+=a*s})}),e.discountEnabled&&e.discountValue>0&&("PERCENTAGE"===e.discountType?t*=1-e.discountValue/100:t-=e.discountValue),e.vatEnabled&&e.vatPercent>0&&(t*=1+e.vatPercent/100),t))}),(0,s.jsx)(u.C,{variant:"draft"===e.status?"secondary":"default",className:"text-xs",children:e.status})]}),(0,s.jsx)(c.z,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 flex-shrink-0",onClick:t=>{t.stopPropagation(),W(e)},children:(0,s.jsx)(g.Z,{className:"w-4 h-4"})})]})]},e.id)})})})]}),(0,s.jsx)(m.Vq,{open:Q,onOpenChange:E,children:(0,s.jsxs)(m.cZ,{children:[(0,s.jsxs)(m.fK,{children:[(0,s.jsx)(m.$N,{children:"Create New BOQ"}),(0,s.jsx)(m.Be,{children:"Start a new Bill of Quantities for your project."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(p._,{htmlFor:"projectName",children:"Project Name *"}),(0,s.jsx)(o.I,{id:"projectName",placeholder:"e.g., Kitchen Renovation",value:M,onChange:e=>T(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(p._,{htmlFor:"customer",children:"Customer (Optional)"}),(0,s.jsxs)(x.Ph,{value:R,onValueChange:$,children:[(0,s.jsx)(x.i4,{children:(0,s.jsx)(x.ki,{placeholder:"Select a customer"})}),(0,s.jsxs)(x.Bw,{children:[(0,s.jsx)(x.Ql,{value:"",children:"No customer"}),V.map(e=>(0,s.jsx)(x.Ql,{value:e.id,children:e.name},e.id))]})]})]})]}),(0,s.jsxs)(m.cN,{children:[(0,s.jsx)(c.z,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),(0,s.jsxs)(c.z,{onClick:J,disabled:L,children:[L&&(0,s.jsx)(v.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Create BOQ"]})]})]})}),(0,s.jsx)(m.Vq,{open:S,onOpenChange:q,children:(0,s.jsxs)(m.cZ,{children:[(0,s.jsxs)(m.fK,{children:[(0,s.jsxs)(m.$N,{className:"flex items-center gap-2 text-red-600",children:[(0,s.jsx)(f.Z,{className:"w-5 h-5"}),"Delete BOQ?"]}),(0,s.jsxs)(m.Be,{children:["This will permanently delete ",(0,s.jsxs)("strong",{children:['"',_?.projectName,'"']})," and all its items. This action cannot be undone."]})]}),(0,s.jsxs)(m.cN,{children:[(0,s.jsx)(c.z,{variant:"outline",onClick:()=>q(!1),disabled:I,children:"Cancel"}),(0,s.jsxs)(c.z,{variant:"destructive",onClick:X,disabled:I,children:[I&&(0,s.jsx)(v.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Delete"]})]})]})})]})})}},1335:function(e,t,r){"use strict";r.d(t,{C:function(){return i}});var s=r(5444);r(9300);var a=r(2371),l=r(5522);let n=(0,a.j)("inline-flex items-center rounded-full border px-3 py-1 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-gradient-to-r from-purple-500 to-lavender-500 text-white",secondary:"border-transparent bg-purple-100 text-purple-700 hover:bg-purple-200",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"border-purple-200 text-purple-700 bg-white",success:"border-transparent bg-emerald-100 text-emerald-700",warning:"border-transparent bg-amber-100 text-amber-700"}},defaultVariants:{variant:"default"}});function i({className:e,variant:t,...r}){return(0,s.jsx)("div",{className:(0,l.cn)(n({variant:t}),e),...r})}},4678:function(e,t,r){"use strict";r.d(t,{I:function(){return n}});var s=r(5444),a=r(9300),l=r(5522);let n=a.forwardRef(({className:e,type:t,...r},a)=>(0,s.jsx)("input",{type:t,className:(0,l.cn)("flex h-11 w-full rounded-xl border-2 border-purple-100 bg-white px-4 py-2 text-sm text-foreground transition-all duration-200","placeholder:text-muted-foreground","hover:border-purple-200","focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-muted","file:border-0 file:bg-transparent file:text-sm file:font-medium",e),ref:a,...r}));n.displayName="Input"},4635:function(e,t,r){"use strict";r.d(t,{_:function(){return o}});var s=r(5444),a=r(9300),l=r(4100),n=r(2371),i=r(5522);let c=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(l.f,{ref:r,className:(0,i.cn)(c(),e),...t}));o.displayName=l.f.displayName},489:function(e,t,r){"use strict";r.d(t,{Bw:function(){return h},Ph:function(){return d},Ql:function(){return f},i4:function(){return m},ki:function(){return u}});var s=r(5444),a=r(9300),l=r(3280),n=r(3751),i=r(6997),c=r(7248),o=r(5522);let d=l.fC;l.ZA;let u=l.B4,m=a.forwardRef(({className:e,children:t,...r},a)=>(0,s.jsxs)(l.xz,{ref:a,className:(0,o.cn)("flex h-11 w-full items-center justify-between gap-2 rounded-xl border-2 border-purple-100 bg-white px-4 py-2 text-sm","transition-all duration-200","placeholder:text-muted-foreground","hover:border-purple-200","focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-100","disabled:cursor-not-allowed disabled:opacity-50","[&>span]:line-clamp-1",e),...r,children:[t,(0,s.jsx)(l.JO,{asChild:!0,children:(0,s.jsx)(n.Z,{className:"h-4 w-4 text-purple-400 transition-transform duration-200"})})]}));m.displayName=l.xz.displayName;let p=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(l.u_,{ref:r,className:(0,o.cn)("flex cursor-default items-center justify-center py-1 text-purple-400",e),...t,children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})}));p.displayName=l.u_.displayName;let x=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(l.$G,{ref:r,className:(0,o.cn)("flex cursor-default items-center justify-center py-1 text-purple-400",e),...t,children:(0,s.jsx)(n.Z,{className:"h-4 w-4"})}));x.displayName=l.$G.displayName;let h=a.forwardRef(({className:e,children:t,position:r="popper",...a},n)=>(0,s.jsx)(l.h_,{children:(0,s.jsxs)(l.VY,{ref:n,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-xl border border-purple-100 bg-white shadow-lg","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2","data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...a,children:[(0,s.jsx)(p,{}),(0,s.jsx)(l.l_,{className:(0,o.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,s.jsx)(x,{})]})}));h.displayName=l.VY.displayName,a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(l.__,{ref:r,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold text-purple-700",e),...t})).displayName=l.__.displayName;let f=a.forwardRef(({className:e,children:t,...r},a)=>(0,s.jsxs)(l.ck,{ref:a,className:(0,o.cn)("relative flex w-full cursor-pointer select-none items-center rounded-lg py-2 pl-8 pr-2 text-sm outline-none","transition-colors duration-150","hover:bg-purple-50 hover:text-purple-700","focus:bg-purple-50 focus:text-purple-700","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.wU,{children:(0,s.jsx)(c.Z,{className:"h-4 w-4 text-purple-500"})})}),(0,s.jsx)(l.eT,{children:t})]}));f.displayName=l.ck.displayName,a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(l.Z0,{ref:r,className:(0,o.cn)("-mx-1 my-1 h-px bg-purple-100",e),...t})).displayName=l.Z0.displayName},5012:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(2154).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},5076:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(2154).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},563:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(2154).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},362:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(2154).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])}},function(e){e.O(0,[762,162,84,206,542,75,904,523,408,386,156,744],function(){return e(e.s=4158)}),_N_E=e.O()}]);