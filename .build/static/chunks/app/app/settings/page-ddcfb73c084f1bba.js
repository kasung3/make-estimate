(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[378],{739:function(e,s,a){Promise.resolve().then(a.bind(a,3886))},3886:function(e,s,a){"use strict";a.d(s,{SettingsClient:function(){return ei}});var t=a(5444),l=a(9300),r=a(9047),n=a(7367),i=a(2422),o=a(4678),c=a(9827),d=a(4635),m=a(489),x=a(6765),h=a(2019),p=a(6771),u=a(2235),g=a(3648),f=a(7927),j=a(1946),y=a(8382),b=a(892),N=a(4611),v=a(5181),w=a(9530),C=a(4805),k=a(3485),S=a(7386),P=a(563),Z=a(8720),T=a(2815),z=a(651),B=a(9992),_=a(9687),D=a(7399),F=a(9429),$=a(7248),R=a(3705),U=a(8082),E=a(8714),O=a(1036),I=a(4400),Q=a(5185);let V={project_name:"Project Name",subtitle:"Subtitle",prepared_for:"Prepared For",company_name:"Company Name",logo:"Logo",date:"Date",prepared_by:"Prepared By",custom_text:"Custom Text"},W={fontSize:16,fontWeight:"normal",italic:!1,underline:!1,color:"#333333",align:"center",marginTop:10,marginBottom:10},L=()=>({page:{backgroundColor:"#ffffff",padding:40,defaultFontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"},elements:[{id:"project_name",type:"project_name",enabled:!0,style:{...W,fontSize:36,fontWeight:"bold",color:"#0891b2",marginBottom:20}},{id:"subtitle",type:"subtitle",enabled:!0,text:"Bill of Quantities",style:{...W,fontSize:18,color:"#666666",marginBottom:10}},{id:"prepared_for",type:"prepared_for",enabled:!0,style:{...W,fontSize:18,color:"#666666",marginBottom:40}},{id:"company_name",type:"company_name",enabled:!0,style:{...W,fontSize:16,color:"#333333"}}]});function A({element:e,onUpdate:s,logoUploadAllowed:a=!0}){let r=(0,l.useRef)(null),[n,c]=(0,l.useState)(!1),m=async a=>{let t=a.target.files?.[0];if(t){if(!["image/png","image/jpeg","image/jpg","image/webp","image/svg+xml"].includes(t.type)){N.ZP.error("Invalid file type. Please use PNG, JPG, WEBP or SVG.");return}if(t.size>5242880){N.ZP.error("File too large. Max 5MB allowed.");return}c(!0);try{let a=await fetch("/api/upload/presigned",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:t.name,contentType:t.type,isPublic:!0})});if(!a.ok)throw Error("Failed to get upload URL");let{uploadUrl:l,cloud_storage_path:r}=await a.json(),n=l.match(/X-Amz-SignedHeaders=([^&]+)/),i=(n?decodeURIComponent(n[1]).split(";"):[]).includes("content-disposition"),o={"Content-Type":t.type};if(i&&(o["Content-Disposition"]="attachment"),!(await fetch(l,{method:"PUT",headers:o,body:t})).ok)throw Error("Failed to upload file");let c=new URL(l),d=`${c.protocol}//${c.host}/${r}`;s({logoUrl:d,logoWidth:e.logoWidth||200,logoMaxWidthPercent:e.logoMaxWidthPercent||50}),N.ZP.success("Logo uploaded successfully")}catch(e){console.error("Upload error:",e),N.ZP.error("Failed to upload logo")}finally{c(!1),r.current&&(r.current.value="")}}};return(0,t.jsxs)("div",{className:"space-y-3",children:[!a&&(0,t.jsxs)("div",{className:"text-xs text-amber-600 bg-amber-50 px-3 py-2 rounded-md border border-amber-200",children:["Logo upload is not available on your current plan.",(0,t.jsx)("a",{href:"/pricing",className:"ml-1 underline hover:text-amber-700",children:"Upgrade"})," to upload a custom logo."]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[e.logoUrl?(0,t.jsx)("div",{className:"flex-shrink-0 border rounded-lg p-2 bg-gray-50",children:(0,t.jsx)("img",{src:e.logoUrl,alt:"Logo preview",style:{maxWidth:`${e.logoWidth||200}px`,height:"auto"},className:"max-h-20 object-contain"})}):(0,t.jsx)("div",{className:"flex-shrink-0 w-20 h-20 border-2 border-dashed rounded-lg flex items-center justify-center bg-gray-50",children:(0,t.jsx)(C.Z,{className:"w-6 h-6 text-gray-400"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)("input",{ref:r,type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp,image/svg+xml",onChange:m,className:"hidden",disabled:!a}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>r.current?.click(),disabled:n||!a,title:a?void 0:"Upgrade to upload a custom logo",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 animate-spin mr-1"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.Z,{className:"w-4 h-4 mr-1"}),e.logoUrl?"Change":"Upload"," Logo"]})}),e.logoUrl&&(0,t.jsxs)(i.z,{variant:"ghost",size:"sm",onClick:()=>{s({logoUrl:void 0,logoWidth:void 0,logoMaxWidthPercent:void 0})},className:"text-red-500 hover:text-red-700",children:[(0,t.jsx)(k.Z,{className:"w-4 h-4 mr-1"}),"Remove"]})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG, WEBP or SVG (max 5MB)"})]})]}),e.logoUrl&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d._,{className:"text-xs text-gray-500",children:"Width (px):"}),(0,t.jsx)(o.I,{type:"number",min:"50",max:"600",value:e.logoWidth||200,onChange:e=>s({logoWidth:parseInt(e.target.value)||200}),className:"h-7 w-20 text-xs"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d._,{className:"text-xs text-gray-500",children:"Max width (%):"}),(0,t.jsx)(o.I,{type:"number",min:"10",max:"100",value:e.logoMaxWidthPercent||50,onChange:e=>s({logoMaxWidthPercent:parseInt(e.target.value)||50}),className:"h-7 w-16 text-xs"}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"of page"})]})]})]})}function M({element:e,onUpdate:s,onDelete:a,logoUploadAllowed:l=!0}){let{attributes:r,listeners:n,setNodeRef:c,setActivatorNodeRef:x,transform:h,transition:p,isDragging:u}=(0,O.nB)({id:e.id}),g={transform:I.ux.Transform.toString(h),transition:p},f=a=>{s(e.id,{style:{...e.style,...a}})};return(0,t.jsx)("div",{ref:c,style:g,...r,className:`border rounded-lg p-4 bg-white ${u?"opacity-50 shadow-lg z-50":""}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{ref:x,...n,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-100 rounded mt-1",style:{touchAction:"none"},children:(0,t.jsx)(S.Z,{className:"w-4 h-4 text-gray-400"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:V[e.type]}),(0,t.jsx)(v.r,{checked:e.enabled,onCheckedChange:a=>s(e.id,{enabled:a})})]}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-500",onClick:()=>a(e.id),title:"Delete element",children:(0,t.jsx)(P.Z,{className:"w-4 h-4"})})]}),e.enabled&&(0,t.jsxs)(t.Fragment,{children:[("custom_text"===e.type||"subtitle"===e.type||"prepared_by"===e.type)&&(0,t.jsx)(o.I,{value:e.text||"",onChange:a=>s(e.id,{text:a.target.value}),placeholder:"prepared_by"===e.type?"Prepared by: [Name]":"Enter text...",className:"h-8 text-sm"}),"date"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(m.Ph,{value:e.dateMode||"today",onValueChange:a=>s(e.id,{dateMode:a}),children:[(0,t.jsx)(m.i4,{className:"w-32 h-8",children:(0,t.jsx)(m.ki,{})}),(0,t.jsxs)(m.Bw,{children:[(0,t.jsx)(m.Ql,{value:"today",children:"Current Date"}),(0,t.jsx)(m.Ql,{value:"custom",children:"Custom Date"})]})]}),"custom"===e.dateMode&&(0,t.jsx)(o.I,{type:"date",value:e.customDate||"",onChange:a=>s(e.id,{customDate:a.target.value}),className:"h-8 text-sm w-40"})]}),"logo"===e.type&&(0,t.jsx)(A,{element:e,onUpdate:a=>s(e.id,a),logoUploadAllowed:l}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(d._,{className:"text-xs text-gray-500",children:"Size:"}),(0,t.jsx)(o.I,{type:"number",min:"8",max:"72",value:e.style.fontSize,onChange:e=>f({fontSize:parseInt(e.target.value)||16}),className:"h-7 w-16 text-xs"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(d._,{className:"text-xs text-gray-500",children:"Color:"}),(0,t.jsx)("input",{type:"color",value:e.style.color,onChange:e=>f({color:e.target.value}),className:"w-7 h-7 rounded border cursor-pointer"})]}),(0,t.jsxs)("div",{className:"flex items-center border rounded",children:[(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none ${"bold"===e.style.fontWeight?"bg-gray-200":""}`,onClick:()=>f({fontWeight:"bold"===e.style.fontWeight?"normal":"bold"}),children:(0,t.jsx)(Z.Z,{className:"w-3 h-3"})}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none border-l ${e.style.italic?"bg-gray-200":""}`,onClick:()=>f({italic:!e.style.italic}),children:(0,t.jsx)(T.Z,{className:"w-3 h-3"})}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none border-l ${e.style.underline?"bg-gray-200":""}`,onClick:()=>f({underline:!e.style.underline}),children:(0,t.jsx)(z.Z,{className:"w-3 h-3"})})]}),(0,t.jsxs)("div",{className:"flex items-center border rounded",children:[(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none ${"left"===e.style.align?"bg-gray-200":""}`,onClick:()=>f({align:"left"}),children:(0,t.jsx)(B.Z,{className:"w-3 h-3"})}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none border-l ${"center"===e.style.align?"bg-gray-200":""}`,onClick:()=>f({align:"center"}),children:(0,t.jsx)(_.Z,{className:"w-3 h-3"})}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none border-l ${"right"===e.style.align?"bg-gray-200":""}`,onClick:()=>f({align:"right"}),children:(0,t.jsx)(D.Z,{className:"w-3 h-3"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(d._,{className:"text-xs text-gray-500",children:"Top:"}),(0,t.jsx)(o.I,{type:"number",min:"0",max:"200",value:e.style.marginTop,onChange:e=>f({marginTop:parseInt(e.target.value)||0}),className:"h-7 w-14 text-xs"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(d._,{className:"text-xs text-gray-500",children:"Bottom:"}),(0,t.jsx)(o.I,{type:"number",min:"0",max:"200",value:e.style.marginBottom,onChange:e=>f({marginBottom:parseInt(e.target.value)||0}),className:"h-7 w-14 text-xs"})]})]})]})]})]})})}function J({config:e,projectName:s,customerName:a,companyName:l}){return(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden shadow-sm",style:{backgroundColor:e.page.backgroundColor||"#ffffff",fontFamily:e.page.defaultFontFamily||"'Segoe UI', sans-serif",aspectRatio:"210 / 297",maxHeight:"500px"},children:(0,t.jsx)("div",{style:{padding:`${e.page.padding||40}px`,height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:e.elements.map(e=>{if(!e.enabled)return null;let r={fontSize:`${e.style.fontSize}px`,fontWeight:e.style.fontWeight,fontStyle:e.style.italic?"italic":"normal",textDecoration:e.style.underline?"underline":"none",color:e.style.color,textAlign:e.style.align,marginTop:`${e.style.marginTop}px`,marginBottom:`${e.style.marginBottom}px`},n="";switch(e.type){case"project_name":n=s||"Project Name";break;case"subtitle":n=e.text||"Bill of Quantities";break;case"prepared_for":n=a?`Prepared for: ${a}`:"Prepared for: [Customer Name]";break;case"company_name":n=l||"Company Name";break;case"logo":if(e.logoUrl){let s=e.logoWidth||200,a=e.logoMaxWidthPercent?`${e.logoMaxWidthPercent}%`:`${s}px`;return(0,t.jsx)("div",{style:{...r,display:"flex",justifyContent:e.style.align},children:(0,t.jsx)("img",{src:e.logoUrl,alt:"Logo",style:{width:`${s}px`,maxWidth:a,height:"auto"}})},e.id)}return(0,t.jsx)("div",{style:r,className:"text-gray-400",children:"[Logo]"},e.id);case"date":n="custom"===e.dateMode&&e.customDate?new Date(e.customDate).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"}):new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"});break;case"prepared_by":n=e.text||"Prepared by: [Name]";break;case"custom_text":n=e.text||"[Custom Text]"}return(0,t.jsx)("div",{style:r,children:n},e.id)})})})}function H({companyName:e}){let[s,a]=(0,l.useState)([]),[r,n]=(0,l.useState)(!0),[x,h]=(0,l.useState)(!1),[u,g]=(0,l.useState)(null),[f,y]=(0,l.useState)(null),[b,v]=(0,l.useState)(""),[C,k]=(0,l.useState)(!1),[S,Z]=(0,l.useState)(!0),T=(0,E.Dy)((0,E.VT)(E.we,{activationConstraint:{distance:5}}),(0,E.VT)(E.Lg,{coordinateGetter:O.is})),z=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/cover-templates");if(e.ok){let s=await e.json();a(s)}}catch(e){console.error("Error fetching templates:",e)}finally{n(!1)}},[]),B=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/billing/status");if(e.ok){let s=await e.json();Z(s.logoUploadAllowed??!0)}}catch(e){console.error("Error fetching billing status:",e)}},[]);(0,l.useEffect)(()=>{z(),B()},[z,B]);let _=()=>{g(null),v("New Cover Template"),y(L()),k(!0)},D=e=>{g(e),v(e.name),y(e.configJson),k(!0)},I=async()=>{if(!f||!b.trim()){N.ZP.error("Please enter a template name");return}h(!0);try{let e=u?`/api/cover-templates/${u.id}`:"/api/cover-templates";if(!(await fetch(e,{method:u?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b,configJson:f,isDefault:0===s.length})})).ok)throw Error("Failed to save template");N.ZP.success(u?"Template updated":"Template created"),k(!1),z()}catch(e){N.ZP.error("Failed to save template")}finally{h(!1)}},V=async e=>{if(confirm("Are you sure you want to delete this template?"))try{let s=await fetch(`/api/cover-templates/${e}`,{method:"DELETE"});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to delete")}N.ZP.success("Template deleted"),z()}catch(e){N.ZP.error(e.message||"Failed to delete template")}},A=async e=>{try{if(!(await fetch(`/api/cover-templates/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isDefault:!0})})).ok)throw Error("Failed to set default");N.ZP.success("Default template updated"),z()}catch(e){N.ZP.error("Failed to set default template")}},H=(e,s)=>{f&&y({...f,elements:f.elements.map(a=>a.id===e?{...a,...s}:a)})},G=e=>{f&&y({...f,elements:f.elements.filter(s=>s.id!==e)})},Y=e=>{let s;if(!f)return;let a={...W};switch(e){case"project_name":a={...W,fontSize:36,fontWeight:"bold",color:"#0891b2",marginBottom:20};break;case"subtitle":s="Bill of Quantities",a={...W,fontSize:18,color:"#666666",marginBottom:10};break;case"prepared_for":a={...W,fontSize:18,color:"#666666",marginBottom:40};break;case"company_name":a={...W,fontSize:16,color:"#333333"};break;case"prepared_by":s="Prepared by: [Name]";break;case"custom_text":s="Custom text here"}let t={id:`${e}_${Date.now()}`,type:e,enabled:!0,text:s,dateMode:"date"===e?"today":void 0,style:a};y({...f,elements:[...f.elements,t]})};return r?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(j.Z,{className:"w-6 h-6 animate-spin text-cyan-600"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"PDF Cover Templates"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Customize the cover page for your BOQ PDFs"})]}),(0,t.jsxs)(i.z,{onClick:_,children:[(0,t.jsx)(F.Z,{className:"w-4 h-4 mr-2"}),"New Template"]})]}),0===s.length?(0,t.jsxs)(c.Zb,{className:"p-8 text-center",children:[(0,t.jsx)(p.Z,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"No templates yet"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"Create your first cover template to customize your PDF exports"}),(0,t.jsxs)(i.z,{onClick:_,children:[(0,t.jsx)(F.Z,{className:"w-4 h-4 mr-2"}),"Create Template"]})]}):(0,t.jsx)("div",{className:"grid gap-4",children:s.map(e=>(0,t.jsx)(c.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(p.Z,{className:"w-5 h-5 text-cyan-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[e.isDefault&&(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-cyan-100 text-cyan-800 mr-2",children:[(0,t.jsx)($.Z,{className:"w-3 h-3 mr-1"}),"Default"]}),"Updated ",new Date(e.updatedAt).toLocaleDateString()]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isDefault&&(0,t.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>A(e.id),children:"Set Default"}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",onClick:()=>D(e),children:(0,t.jsx)(R.Z,{className:"w-4 h-4"})}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700",onClick:()=>V(e.id),children:(0,t.jsx)(P.Z,{className:"w-4 h-4"})})]})]})},e.id))}),(0,t.jsx)(w.Vq,{open:C,onOpenChange:k,children:(0,t.jsxs)(w.cZ,{className:"max-w-6xl h-[90vh] flex flex-col p-0",children:[(0,t.jsx)(w.fK,{className:"px-6 py-4 border-b flex-shrink-0",children:(0,t.jsx)(w.$N,{children:u?"Edit Template":"New Template"})}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 flex",children:[(0,t.jsx)("div",{className:"w-1/2 flex flex-col min-h-0",children:(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d._,{children:"Template Name"}),(0,t.jsx)(o.I,{value:b,onChange:e=>v(e.target.value),placeholder:"Enter template name"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d._,{children:"Page Background Color"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"color",value:f?.page.backgroundColor||"#ffffff",onChange:e=>f&&y({...f,page:{...f.page,backgroundColor:e.target.value}}),className:"w-10 h-10 rounded border cursor-pointer"}),(0,t.jsx)(o.I,{value:f?.page.backgroundColor||"#ffffff",onChange:e=>f&&y({...f,page:{...f.page,backgroundColor:e.target.value}}),className:"w-28"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(d._,{children:"Elements"}),(0,t.jsxs)(m.Ph,{onValueChange:e=>Y(e),children:[(0,t.jsxs)(m.i4,{className:"w-40 h-8",children:[(0,t.jsx)(F.Z,{className:"w-3 h-3 mr-1"}),(0,t.jsx)("span",{className:"text-sm",children:"Add Element"})]}),(0,t.jsxs)(m.Bw,{children:[(0,t.jsx)(m.Ql,{value:"project_name",children:"Project Name"}),(0,t.jsx)(m.Ql,{value:"subtitle",children:"Subtitle"}),(0,t.jsx)(m.Ql,{value:"prepared_for",children:"Prepared For"}),(0,t.jsx)(m.Ql,{value:"company_name",children:"Company Name"}),(0,t.jsx)(m.Ql,{value:"logo",children:"Logo"}),(0,t.jsx)(m.Ql,{value:"date",children:"Date"}),(0,t.jsx)(m.Ql,{value:"prepared_by",children:"Prepared By"}),(0,t.jsx)(m.Ql,{value:"custom_text",children:"Custom Text"})]})]})]}),f&&(0,t.jsx)(E.LB,{sensors:T,collisionDetection:E.pE,onDragEnd:e=>{let{active:s,over:a}=e;if(!a||s.id===a.id||!f)return;let t=f.elements.findIndex(e=>e.id===s.id),l=f.elements.findIndex(e=>e.id===a.id);y({...f,elements:(0,O.Rp)(f.elements,t,l)})},modifiers:[Q.DL],children:(0,t.jsx)(O.Fo,{items:f.elements.map(e=>e.id),strategy:O.qw,children:(0,t.jsx)("div",{className:"space-y-2",children:f.elements.map(e=>(0,t.jsx)(M,{element:e,onUpdate:H,onDelete:G,logoUploadAllowed:S},e.id))})})})]})]})}),(0,t.jsxs)("div",{className:"w-1/2 border-l flex flex-col min-h-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-3 border-b flex-shrink-0",children:[(0,t.jsx)(d._,{children:"Live Preview"}),(0,t.jsx)(U.Z,{className:"w-4 h-4 text-gray-400"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:f&&(0,t.jsx)(J,{config:f,projectName:"Sample Project Name",customerName:"Mr. John Doe",companyName:e})})]})]}),(0,t.jsxs)(w.cN,{className:"px-6 py-4 border-t flex-shrink-0",children:[(0,t.jsx)(i.z,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),(0,t.jsx)(i.z,{onClick:I,disabled:x,children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Saving..."]}):"Save Template"})]})]})})]})}let G=()=>({header:{borderColor:"#0891b2",titleColor:"#0891b2",subtitleColor:"#666666"},categoryHeader:{backgroundPrimary:"#0891b2",backgroundSecondary:"#14b8a6",textColor:"#ffffff"},table:{headerBackground:"#f9fafb",headerTextColor:"#6b7280",borderColor:"#e5e7eb",bodyTextColor:"#333333"},subtotalRow:{background:"#f0fdfa",borderColor:"#14b8a6",textColor:"#333333"},noteRow:{background:"#fffbeb",textColor:"#92400e"},totals:{finalTotalBackground:"#0891b2",finalTotalTextColor:"#ffffff"}});function Y({label:e,value:s,onChange:a}){return(0,t.jsxs)("div",{className:"flex items-center justify-between py-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:e}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"color",value:s,onChange:e=>a(e.target.value),className:"w-8 h-8 rounded border cursor-pointer"}),(0,t.jsx)(o.I,{value:s,onChange:e=>a(e.target.value),className:"w-24 h-8 text-xs font-mono"})]})]})}function q({config:e}){return(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden bg-white shadow-sm",children:[(0,t.jsxs)("div",{className:"p-3",style:{borderBottom:`2px solid ${e.header.borderColor}`},children:[(0,t.jsx)("div",{className:"text-base font-bold",style:{color:e.header.titleColor},children:"Sample Project Name"}),(0,t.jsx)("div",{className:"text-xs",style:{color:e.header.subtitleColor},children:"Customer: John Doe"})]}),(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsx)("div",{className:"px-2 py-1 rounded-t text-xs font-bold",style:{background:`linear-gradient(135deg, ${e.categoryHeader.backgroundPrimary}, ${e.categoryHeader.backgroundSecondary})`,color:e.categoryHeader.textColor},children:"1. Sample Category"}),(0,t.jsxs)("table",{className:"w-full text-xs",style:{borderCollapse:"collapse"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-2 py-1 text-left font-semibold text-[10px] uppercase",style:{backgroundColor:e.table.headerBackground,color:e.table.headerTextColor,border:`1px solid ${e.table.borderColor}`},children:"Item"}),(0,t.jsx)("th",{className:"px-2 py-1 text-left font-semibold text-[10px] uppercase",style:{backgroundColor:e.table.headerBackground,color:e.table.headerTextColor,border:`1px solid ${e.table.borderColor}`},children:"Description"}),(0,t.jsx)("th",{className:"px-2 py-1 text-right font-semibold text-[10px] uppercase",style:{backgroundColor:e.table.headerBackground,color:e.table.headerTextColor,border:`1px solid ${e.table.borderColor}`},children:"Amount"})]})}),(0,t.jsxs)("tbody",{children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"px-2 py-1",style:{border:`1px solid ${e.table.borderColor}`,color:e.table.bodyTextColor},children:"1.1"}),(0,t.jsx)("td",{className:"px-2 py-1",style:{border:`1px solid ${e.table.borderColor}`,color:e.table.bodyTextColor},children:"Sample item description"}),(0,t.jsx)("td",{className:"px-2 py-1 text-right",style:{border:`1px solid ${e.table.borderColor}`,color:e.table.bodyTextColor},children:"1,000.00"})]}),(0,t.jsxs)("tr",{style:{backgroundColor:e.noteRow.background},children:[(0,t.jsx)("td",{className:"px-2 py-1",style:{border:`1px solid ${e.table.borderColor}`}}),(0,t.jsx)("td",{colSpan:2,className:"px-2 py-1 italic",style:{border:`1px solid ${e.table.borderColor}`,color:e.noteRow.textColor},children:"This is a sample note"})]}),(0,t.jsxs)("tr",{style:{backgroundColor:e.subtotalRow.background,color:e.subtotalRow.textColor},children:[(0,t.jsx)("td",{colSpan:2,className:"px-2 py-1 text-right font-bold",style:{borderTop:`2px solid ${e.subtotalRow.borderColor}`,border:`1px solid ${e.table.borderColor}`},children:"Subtotal"}),(0,t.jsx)("td",{className:"px-2 py-1 text-right font-bold",style:{borderTop:`2px solid ${e.subtotalRow.borderColor}`,border:`1px solid ${e.table.borderColor}`},children:"Rs. 1,000.00"})]})]})]}),(0,t.jsx)("div",{className:"mt-3 flex justify-end",children:(0,t.jsx)("div",{className:"px-3 py-2 rounded text-sm font-bold",style:{backgroundColor:e.totals.finalTotalBackground,color:e.totals.finalTotalTextColor},children:"Final Total: Rs. 1,180.00"})})]})]})}function K({companyName:e}){let[s,a]=(0,l.useState)([]),[r,n]=(0,l.useState)(!0),[m,x]=(0,l.useState)(!1),[h,p]=(0,l.useState)(null),[u,g]=(0,l.useState)(null),[f,y]=(0,l.useState)(""),[v,C]=(0,l.useState)(!1),k=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/pdf-themes");if(e.ok){let s=await e.json();a(s)}}catch(e){console.error("Error fetching themes:",e)}finally{n(!1)}},[]);(0,l.useEffect)(()=>{k()},[k]);let S=()=>{p(null),y("New Theme"),g(G()),C(!0)},Z=e=>{p(e),y(e.name),g(e.configJson),C(!0)},T=async()=>{if(!u||!f.trim()){N.ZP.error("Please enter a theme name");return}x(!0);try{let e=h?`/api/pdf-themes/${h.id}`:"/api/pdf-themes";if(!(await fetch(e,{method:h?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f,configJson:u,isDefault:0===s.length})})).ok)throw Error("Failed to save theme");N.ZP.success(h?"Theme updated":"Theme created"),C(!1),k()}catch(e){N.ZP.error("Failed to save theme")}finally{x(!1)}},z=async e=>{if(confirm("Are you sure you want to delete this theme?"))try{let s=await fetch(`/api/pdf-themes/${e}`,{method:"DELETE"});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to delete")}N.ZP.success("Theme deleted"),k()}catch(e){N.ZP.error(e.message||"Failed to delete theme")}},B=async e=>{try{if(!(await fetch(`/api/pdf-themes/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isDefault:!0})})).ok)throw Error("Failed to set default");N.ZP.success("Default theme updated"),k()}catch(e){N.ZP.error("Failed to set default theme")}},_=(e,s)=>{if(!u)return;let a=JSON.parse(JSON.stringify(u)),t=a;for(let s=0;s<e.length-1;s++)t=t[e[s]];t[e[e.length-1]]=s,g(a)};return r?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(j.Z,{className:"w-6 h-6 animate-spin text-cyan-600"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"PDF Color Themes"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Customize colors and shading for BOQ pages"})]}),(0,t.jsxs)(i.z,{onClick:S,children:[(0,t.jsx)(F.Z,{className:"w-4 h-4 mr-2"}),"New Theme"]})]}),0===s.length?(0,t.jsxs)(c.Zb,{className:"p-8 text-center",children:[(0,t.jsx)(b.Z,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"No themes yet"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"Create your first color theme to customize your PDF exports"}),(0,t.jsxs)(i.z,{onClick:S,children:[(0,t.jsx)(F.Z,{className:"w-4 h-4 mr-2"}),"Create Theme"]})]}):(0,t.jsx)("div",{className:"grid gap-4",children:s.map(e=>(0,t.jsx)(c.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(b.Z,{className:"w-5 h-5 text-cyan-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[e.isDefault&&(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-cyan-100 text-cyan-800 mr-2",children:[(0,t.jsx)($.Z,{className:"w-3 h-3 mr-1"}),"Default"]}),"Updated ",new Date(e.updatedAt).toLocaleDateString()]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isDefault&&(0,t.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>B(e.id),children:"Set Default"}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",onClick:()=>Z(e),children:(0,t.jsx)(R.Z,{className:"w-4 h-4"})}),(0,t.jsx)(i.z,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700",onClick:()=>z(e.id),children:(0,t.jsx)(P.Z,{className:"w-4 h-4"})})]})]})},e.id))}),(0,t.jsx)(w.Vq,{open:v,onOpenChange:C,children:(0,t.jsxs)(w.cZ,{className:"max-w-5xl h-[90vh] flex flex-col p-0",children:[(0,t.jsx)(w.fK,{className:"px-6 py-4 border-b flex-shrink-0",children:(0,t.jsx)(w.$N,{children:h?"Edit Theme":"New Theme"})}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 flex",children:[(0,t.jsx)("div",{className:"w-1/2 flex flex-col min-h-0",children:(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d._,{children:"Theme Name"}),(0,t.jsx)(o.I,{value:f,onChange:e=>y(e.target.value),placeholder:"Enter theme name"})]}),u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(d._,{className:"text-sm font-semibold",children:"Page Header"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[(0,t.jsx)(Y,{label:"Border Color",value:u.header.borderColor,onChange:e=>_(["header","borderColor"],e)}),(0,t.jsx)(Y,{label:"Title Color",value:u.header.titleColor,onChange:e=>_(["header","titleColor"],e)}),(0,t.jsx)(Y,{label:"Subtitle Color",value:u.header.subtitleColor,onChange:e=>_(["header","subtitleColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(d._,{className:"text-sm font-semibold",children:"Category Header"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[(0,t.jsx)(Y,{label:"Background Primary",value:u.categoryHeader.backgroundPrimary,onChange:e=>_(["categoryHeader","backgroundPrimary"],e)}),(0,t.jsx)(Y,{label:"Background Secondary",value:u.categoryHeader.backgroundSecondary,onChange:e=>_(["categoryHeader","backgroundSecondary"],e)}),(0,t.jsx)(Y,{label:"Text Color",value:u.categoryHeader.textColor,onChange:e=>_(["categoryHeader","textColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(d._,{className:"text-sm font-semibold",children:"Table"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[(0,t.jsx)(Y,{label:"Header Background",value:u.table.headerBackground,onChange:e=>_(["table","headerBackground"],e)}),(0,t.jsx)(Y,{label:"Header Text Color",value:u.table.headerTextColor,onChange:e=>_(["table","headerTextColor"],e)}),(0,t.jsx)(Y,{label:"Border Color",value:u.table.borderColor,onChange:e=>_(["table","borderColor"],e)}),(0,t.jsx)(Y,{label:"Body Text Color",value:u.table.bodyTextColor,onChange:e=>_(["table","bodyTextColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(d._,{className:"text-sm font-semibold",children:"Subtotal Row"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[(0,t.jsx)(Y,{label:"Background",value:u.subtotalRow.background,onChange:e=>_(["subtotalRow","background"],e)}),(0,t.jsx)(Y,{label:"Border Color",value:u.subtotalRow.borderColor,onChange:e=>_(["subtotalRow","borderColor"],e)}),(0,t.jsx)(Y,{label:"Text Color",value:u.subtotalRow.textColor,onChange:e=>_(["subtotalRow","textColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(d._,{className:"text-sm font-semibold",children:"Note Row"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[(0,t.jsx)(Y,{label:"Background",value:u.noteRow.background,onChange:e=>_(["noteRow","background"],e)}),(0,t.jsx)(Y,{label:"Text Color",value:u.noteRow.textColor,onChange:e=>_(["noteRow","textColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(d._,{className:"text-sm font-semibold",children:"Final Total"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[(0,t.jsx)(Y,{label:"Background",value:u.totals.finalTotalBackground,onChange:e=>_(["totals","finalTotalBackground"],e)}),(0,t.jsx)(Y,{label:"Text Color",value:u.totals.finalTotalTextColor,onChange:e=>_(["totals","finalTotalTextColor"],e)})]})]})]})]})}),(0,t.jsxs)("div",{className:"w-1/2 border-l flex flex-col min-h-0",children:[(0,t.jsx)("div",{className:"px-6 py-3 border-b flex-shrink-0",children:(0,t.jsx)(d._,{children:"Preview"})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:u&&(0,t.jsx)(q,{config:u})})]})]}),(0,t.jsxs)(w.cN,{className:"px-6 py-4 border-t flex-shrink-0",children:[(0,t.jsx)(i.z,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),(0,t.jsx)(i.z,{onClick:T,disabled:m,children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Saving..."]}):"Save Theme"})]})]})})]})}var X=a(1335),ee=a(6772),es=a(3394),ea=a(3492),et=a(7665),el=a(179);let er={starter:{key:"starter",name:"Starter",priceId:"",price:19,boqLimit:10,description:"10 BOQ creations per month"},business:{key:"business",name:"Business",priceId:"",price:39,boqLimit:null,description:"Unlimited BOQ creations"}};function en({isAdmin:e}){let[s,a]=(0,l.useState)(null),[r,n]=(0,l.useState)(!0),[m,x]=(0,l.useState)(null),[h,p]=(0,l.useState)(!1),[g,f]=(0,l.useState)(""),[y,b]=(0,l.useState)(!1),[v,w]=(0,l.useState)(null);(0,l.useEffect)(()=>{C()},[]);let C=async()=>{try{let e=await fetch("/api/billing/status");if(e.ok){let s=await e.json();a(s)}}catch(e){console.error("Failed to fetch billing status:",e)}finally{n(!1)}},k=async s=>{if(!e){N.ZP.error("Only company admins can manage billing");return}x(s);try{let e=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planKey:s,promoCode:g||void 0})}),a=await e.json();if(!e.ok)throw Error(a.error||"Failed to create checkout session");window.open(a.url,"_blank")}catch(e){N.ZP.error(e instanceof Error?e.message:"Failed to start checkout")}finally{x(null)}},S=async()=>{if(!e){N.ZP.error("Only company admins can manage billing");return}p(!0);try{let e=await fetch("/api/billing/portal",{method:"POST"}),s=await e.json();if(!e.ok)throw Error(s.error||"Failed to open billing portal");window.open(s.url,"_blank")}catch(e){N.ZP.error(e instanceof Error?e.message:"Failed to open billing portal")}finally{p(!1)}},P=async()=>{if(!g.trim()){w(null);return}b(!0);try{let e=await fetch("/api/billing/validate-promo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g})}),s=await e.json();w({valid:e.ok,message:s.message||(e.ok?"Valid promo code!":"Invalid promo code")})}catch(e){w({valid:!1,message:"Failed to validate promo code"})}finally{b(!1)}};if(r)return(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(j.Z,{className:"w-8 h-8 animate-spin text-primary"})});let Z=s?.hasActiveSubscription,T=s?.planKey?er[s.planKey]:null;return(0,t.jsxs)("div",{className:"space-y-6",children:[Z&&T&&(0,t.jsxs)(c.Zb,{className:"shadow-md border-0 bg-gradient-to-br from-emerald-50 to-teal-50",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-400 rounded-lg flex items-center justify-center",children:(0,t.jsx)(u.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ll,{className:"text-lg",children:"Current Subscription"}),(0,t.jsx)(c.SZ,{children:"Your active plan details"})]})]}),(0,t.jsx)(X.C,{variant:s?.status==="active"?"default":"secondary",className:"capitalize",children:s?.status==="trialing"?"Trial":s?.status})]})}),(0,t.jsxs)(c.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Plan"}),(0,t.jsx)("p",{className:"text-lg font-semibold",children:T.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Price"}),(0,t.jsxs)("p",{className:"text-lg font-semibold",children:["$",T.price,"/month"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"BOQs This Period"}),(0,t.jsxs)("p",{className:"text-lg font-semibold",children:[s?.boqsUsedThisPeriod??0,s?.boqLimit?` / ${s.boqLimit}`:" (unlimited)"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Renews On"}),(0,t.jsx)("p",{className:"text-lg font-semibold",children:s?.currentPeriodEnd?(0,el.WU)(new Date(s.currentPeriodEnd),"MMM d, yyyy"):"-"})]})]}),s?.cancelAtPeriodEnd&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-amber-100 text-amber-800 rounded-lg",children:[(0,t.jsx)(ee.Z,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"Your subscription will cancel at the end of this billing period"})]}),e&&(0,t.jsx)("div",{className:"flex gap-3 pt-2",children:(0,t.jsxs)(i.z,{onClick:S,disabled:h,variant:"outline",className:"flex items-center gap-2",children:[h?(0,t.jsx)(j.Z,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(es.Z,{className:"w-4 h-4"}),"Manage Billing"]})})]})]}),(!Z||T?.key==="starter")&&(0,t.jsxs)(c.Zb,{className:"shadow-md border-0",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-violet-400 to-purple-400 rounded-lg flex items-center justify-center",children:(0,t.jsx)(ea.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ll,{className:"text-lg",children:Z?"Upgrade Your Plan":"Choose a Plan"}),(0,t.jsx)(c.SZ,{children:Z?"Get unlimited BOQ creations":"Subscribe to start creating BOQs"})]})]})}),(0,t.jsxs)(c.aY,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(d._,{htmlFor:"promoCode",className:"flex items-center gap-2",children:[(0,t.jsx)(et.Z,{className:"w-4 h-4"}),"Promo Code (Optional)"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.I,{id:"promoCode",value:g,onChange:e=>{f(e.target.value.toUpperCase()),w(null)},placeholder:"Enter promo code",className:"uppercase"}),(0,t.jsx)(i.z,{variant:"outline",onClick:P,disabled:y||!g.trim(),children:y?(0,t.jsx)(j.Z,{className:"w-4 h-4 animate-spin"}):"Apply"})]}),v&&(0,t.jsx)("p",{className:`text-sm ${v.valid?"text-emerald-600":"text-red-600"}`,children:v.message})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:`relative rounded-xl border-2 p-6 transition-all ${T?.key==="starter"?"border-emerald-400 bg-emerald-50":"border-gray-200 hover:border-primary/50"}`,children:[T?.key==="starter"&&(0,t.jsx)(X.C,{className:"absolute -top-3 left-4 bg-emerald-500",children:"Current Plan"}),(0,t.jsx)("h3",{className:"text-xl font-bold",children:"Starter"}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("span",{className:"text-3xl font-bold",children:"$19"}),(0,t.jsx)("span",{className:"text-gray-500",children:"/month"})]}),(0,t.jsxs)("ul",{className:"mt-4 space-y-2",children:[(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),"10 BOQ creations per month"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),"PDF export with themes"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),"Custom cover pages"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),"Customer management"]})]}),T?.key!=="starter"&&e&&(0,t.jsxs)(i.z,{className:"w-full mt-6",variant:"outline",onClick:()=>k("starter"),disabled:"starter"===m,children:["starter"===m?(0,t.jsx)(j.Z,{className:"w-4 h-4 animate-spin mr-2"}):null,Z?"Switch to Starter":"Get Started"]})]}),(0,t.jsxs)("div",{className:`relative rounded-xl border-2 p-6 transition-all ${T?.key==="business"?"border-emerald-400 bg-emerald-50":"border-primary bg-gradient-to-br from-primary/5 to-primary/10"}`,children:[T?.key==="business"&&(0,t.jsx)(X.C,{className:"absolute -top-3 left-4 bg-emerald-500",children:"Current Plan"}),T?.key!=="business"&&(0,t.jsx)(X.C,{className:"absolute -top-3 left-4 bg-primary",children:"Recommended"}),(0,t.jsx)("h3",{className:"text-xl font-bold",children:"Business"}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("span",{className:"text-3xl font-bold",children:"$39"}),(0,t.jsx)("span",{className:"text-gray-500",children:"/month"})]}),(0,t.jsxs)("ul",{className:"mt-4 space-y-2",children:[(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),(0,t.jsx)("strong",{children:"Unlimited"})," BOQ creations"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),"PDF export with themes"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),"Custom cover pages"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),"Customer management"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)($.Z,{className:"w-4 h-4 text-emerald-500"}),"Priority support"]})]}),T?.key!=="business"&&e&&(0,t.jsxs)(i.z,{className:"w-full mt-6",onClick:()=>k("business"),disabled:"business"===m,children:["business"===m?(0,t.jsx)(j.Z,{className:"w-4 h-4 animate-spin mr-2"}):null,T?.key==="starter"?"Upgrade to Business":"Get Business"]})]})]}),!e&&(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Contact your company admin to manage billing."})]})]})]})}function ei({company:e,isAdmin:s}){let a=(0,r.useSearchParams)(),[v,w]=(0,l.useState)(e),[C,k]=(0,l.useState)(!1),[S,P]=(0,l.useState)("company");(0,l.useEffect)(()=>{let e=a?.get("tab");e&&["company","pdf","billing"].includes(e)&&P(e)},[a]);let Z=async()=>{k(!0);try{if(!(await fetch("/api/company",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:v?.name,currencySymbol:v?.currencySymbol,currencyPosition:v?.currencyPosition,defaultVatPercent:v?.defaultVatPercent})})).ok)throw Error("Failed to save");N.ZP.success("Settings saved successfully")}catch(e){N.ZP.error("Failed to save settings")}finally{k(!1)}};return(0,t.jsx)(n.AppLayout,{children:(0,t.jsxs)("div",{className:"p-6 max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),(0,t.jsx)("p",{className:"text-gray-500 mt-1",children:"Manage your company and PDF settings"})]}),(0,t.jsxs)(x.mQ,{value:S,onValueChange:P,className:"space-y-6",children:[(0,t.jsxs)(x.dr,{className:"grid w-full grid-cols-3 max-w-lg",children:[(0,t.jsxs)(x.SP,{value:"company",className:"flex items-center gap-2",children:[(0,t.jsx)(h.Z,{className:"w-4 h-4"}),"Company"]}),(0,t.jsxs)(x.SP,{value:"pdf",className:"flex items-center gap-2",children:[(0,t.jsx)(p.Z,{className:"w-4 h-4"}),"PDF Templates"]}),(0,t.jsxs)(x.SP,{value:"billing",className:"flex items-center gap-2",children:[(0,t.jsx)(u.Z,{className:"w-4 h-4"}),"Billing"]})]}),(0,t.jsxs)(x.nU,{value:"company",className:"space-y-6",children:[(0,t.jsxs)(c.Zb,{className:"shadow-md border-0",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-cyan-400 to-teal-400 rounded-lg flex items-center justify-center",children:(0,t.jsx)(h.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ll,{className:"text-lg",children:"Company Information"}),(0,t.jsx)(c.SZ,{children:"Update your company details"})]})]})}),(0,t.jsx)(c.aY,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d._,{htmlFor:"companyName",children:"Company Name"}),(0,t.jsx)(o.I,{id:"companyName",value:v?.name??"",onChange:e=>w({...v??{},name:e.target.value}),placeholder:"Enter company name"})]})})]}),(0,t.jsxs)(c.Zb,{className:"shadow-md border-0",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-400 to-green-400 rounded-lg flex items-center justify-center",children:(0,t.jsx)(g.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ll,{className:"text-lg",children:"Currency Settings"}),(0,t.jsx)(c.SZ,{children:"Configure how currency is displayed"})]})]})}),(0,t.jsxs)(c.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d._,{htmlFor:"currencySymbol",children:"Currency Symbol"}),(0,t.jsx)(o.I,{id:"currencySymbol",value:v?.currencySymbol??"",onChange:e=>w({...v??{},currencySymbol:e.target.value}),placeholder:"Rs."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d._,{htmlFor:"currencyPosition",children:"Symbol Position"}),(0,t.jsxs)(m.Ph,{value:v?.currencyPosition??"left",onValueChange:e=>w({...v??{},currencyPosition:e}),children:[(0,t.jsx)(m.i4,{children:(0,t.jsx)(m.ki,{})}),(0,t.jsxs)(m.Bw,{children:[(0,t.jsxs)(m.Ql,{value:"left",children:["Left (",v?.currencySymbol||"Rs.","1,000)"]}),(0,t.jsxs)(m.Ql,{value:"right",children:["Right (1,000",v?.currencySymbol||"Rs.",")"]})]})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Preview"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:v?.currencyPosition==="left"?`${v?.currencySymbol??"Rs."}1,234.56`:`1,234.56${v?.currencySymbol??"Rs."}`})]})]})]}),(0,t.jsxs)(c.Zb,{className:"shadow-md border-0",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-400 to-indigo-400 rounded-lg flex items-center justify-center",children:(0,t.jsx)(f.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ll,{className:"text-lg",children:"Default VAT Settings"}),(0,t.jsx)(c.SZ,{children:"Set the default VAT percentage for new BOQs"})]})]})}),(0,t.jsx)(c.aY,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d._,{htmlFor:"defaultVatPercent",children:"Default VAT Percentage"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(o.I,{id:"defaultVatPercent",type:"number",step:"0.01",min:"0",max:"100",value:v?.defaultVatPercent??18,onChange:e=>w({...v??{},defaultVatPercent:parseFloat(e.target.value)||0}),className:"w-24"}),(0,t.jsx)("span",{className:"text-gray-500",children:"%"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"This percentage will be used as the default VAT for all new BOQs."})]})})]}),(0,t.jsx)(i.z,{onClick:Z,disabled:C,className:"w-full",children:C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Save Settings"]})})]}),(0,t.jsxs)(x.nU,{value:"pdf",className:"space-y-8",children:[(0,t.jsxs)(c.Zb,{className:"shadow-md border-0",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-cyan-400 to-teal-400 rounded-lg flex items-center justify-center",children:(0,t.jsx)(p.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ll,{className:"text-lg",children:"Cover Page Templates"}),(0,t.jsx)(c.SZ,{children:"Customize cover page content and formatting"})]})]})}),(0,t.jsx)(c.aY,{children:(0,t.jsx)(H,{companyName:v?.name??"Company"})})]}),(0,t.jsxs)(c.Zb,{className:"shadow-md border-0",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-lg flex items-center justify-center",children:(0,t.jsx)(b.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ll,{className:"text-lg",children:"BOQ Color Themes"}),(0,t.jsx)(c.SZ,{children:"Customize colors and shading for BOQ pages"})]})]})}),(0,t.jsx)(c.aY,{children:(0,t.jsx)(K,{companyName:v?.name??"Company"})})]})]}),(0,t.jsx)(x.nU,{value:"billing",children:(0,t.jsx)(en,{isAdmin:s})})]})]})})}},1335:function(e,s,a){"use strict";a.d(s,{C:function(){return i}});var t=a(5444);a(9300);var l=a(2371),r=a(5522);let n=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:s,...a}){return(0,t.jsx)("div",{className:(0,r.cn)(n({variant:s}),e),...a})}},489:function(e,s,a){"use strict";a.d(s,{Bw:function(){return u},Ph:function(){return d},Ql:function(){return g},i4:function(){return x},ki:function(){return m}});var t=a(5444),l=a(9300),r=a(3280),n=a(3751),i=a(6997),o=a(7248),c=a(5522);let d=r.fC;r.ZA;let m=r.B4,x=l.forwardRef(({className:e,children:s,...a},l)=>(0,t.jsxs)(r.xz,{ref:l,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-lg border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...a,children:[s,(0,t.jsx)(r.JO,{asChild:!0,children:(0,t.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]}));x.displayName=r.xz.displayName;let h=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.u_,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...s,children:(0,t.jsx)(i.Z,{className:"h-4 w-4"})}));h.displayName=r.u_.displayName;let p=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.$G,{ref:a,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...s,children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})}));p.displayName=r.$G.displayName;let u=l.forwardRef(({className:e,children:s,position:a="popper",...l},n)=>(0,t.jsx)(r.h_,{children:(0,t.jsxs)(r.VY,{ref:n,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-lg border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...l,children:[(0,t.jsx)(h,{}),(0,t.jsx)(r.l_,{className:(0,c.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,t.jsx)(p,{})]})}));u.displayName=r.VY.displayName,l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.__,{ref:a,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s})).displayName=r.__.displayName;let g=l.forwardRef(({className:e,children:s,...a},l)=>(0,t.jsxs)(r.ck,{ref:l,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-md py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(r.wU,{children:(0,t.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(r.eT,{children:s})]}));g.displayName=r.ck.displayName,l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.Z0,{ref:a,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",e),...s})).displayName=r.Z0.displayName},5181:function(e,s,a){"use strict";a.d(s,{r:function(){return i}});var t=a(5444),l=a(9300),r=a(2312),n=a(5522);let i=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.fC,{className:(0,n.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...s,ref:a,children:(0,t.jsx)(r.bU,{className:(0,n.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));i.displayName=r.fC.displayName},6765:function(e,s,a){"use strict";a.d(s,{SP:function(){return c},dr:function(){return o},mQ:function(){return i},nU:function(){return d}});var t=a(5444),l=a(9300),r=a(9035),n=a(5522);let i=r.fC,o=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.aV,{ref:a,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));o.displayName=r.aV.displayName;let c=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.xz,{ref:a,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));c.displayName=r.xz.displayName;let d=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(r.VY,{ref:a,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));d.displayName=r.VY.displayName}},function(e){e.O(0,[762,162,853,512,984,233,523,538,543,629,386,156,744],function(){return e(e.s=739)}),_N_E=e.O()}]);