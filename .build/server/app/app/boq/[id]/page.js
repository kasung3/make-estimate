(()=>{var e={};e.id=8563,e.ids=[8563],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},24006:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),r(28405),r(87369),r(71363);var a=r(36576),s=r(72007),n=r(21818),i=r.n(n),l=r(88897),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["app",{children:["boq",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,28405)),"/home/ubuntu/make_estimate/nextjs_space/app/app/boq/[id]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,87369)),"/home/ubuntu/make_estimate/nextjs_space/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,71363,23)),"next/dist/client/components/not-found-error"]}],d=["/home/ubuntu/make_estimate/nextjs_space/app/app/boq/[id]/page.tsx"],u="/app/boq/[id]/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/app/boq/[id]/page",pathname:"/app/boq/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},96774:(e,t,r)=>{Promise.resolve().then(r.bind(r,79877))},79877:(e,t,r)=>{"use strict";r.d(t,{BoqEditorClient:()=>eA});var a=r(62901),s=r(24383),n=r(84374),i=r(62392),l=r(22270),o=r(27878),c=r(250),d=r(68637);let u=s.forwardRef(({className:e,...t},r)=>a.jsx("textarea",{className:(0,d.cn)("flex min-h-[100px] w-full rounded-xl border-2 border-purple-100 bg-white px-4 py-3 text-sm text-foreground transition-all duration-200","placeholder:text-muted-foreground","hover:border-purple-200","focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-muted","resize-none",e),ref:r,...t}));u.displayName="Textarea";var m=r(23803),p=r(82657),x=r(84377),h=r(16098),f=r(72388),g=r(65923),y=r(1940),b=r(56163),v=r(89291),j=r(8378),N=r(50430),w=r(65138),C=(r(4764),r(52490)),k=r(74132),P=r(42049),T=r(98106),E=r(18221),[_,D]=(0,v.b)("Tooltip",[w.D7]),S=(0,w.D7)(),I="TooltipProvider",M="tooltip.open",[R,O]=_(I),q=e=>{let{__scopeTooltip:t,delayDuration:r=700,skipDelayDuration:n=300,disableHoverableContent:i=!1,children:l}=e,[o,c]=s.useState(!0),d=s.useRef(!1),u=s.useRef(0);return s.useEffect(()=>{let e=u.current;return()=>window.clearTimeout(e)},[]),(0,a.jsx)(R,{scope:t,isOpenDelayed:o,delayDuration:r,onOpen:s.useCallback(()=>{window.clearTimeout(u.current),c(!1)},[]),onClose:s.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>c(!0),n)},[n]),isPointerInTransitRef:d,onPointerInTransitChange:s.useCallback(e=>{d.current=e},[]),disableHoverableContent:i,children:l})};q.displayName=I;var F="Tooltip",[Z,z]=_(F),$=e=>{let{__scopeTooltip:t,children:r,open:n,defaultOpen:i=!1,onOpenChange:l,disableHoverableContent:o,delayDuration:c}=e,d=O(F,e.__scopeTooltip),u=S(t),[m,p]=s.useState(null),x=(0,N.M)(),h=s.useRef(0),f=o??d.disableHoverableContent,g=c??d.delayDuration,y=s.useRef(!1),[b=!1,v]=(0,T.T)({prop:n,defaultProp:i,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(M))):d.onClose(),l?.(e)}}),j=s.useMemo(()=>b?y.current?"delayed-open":"instant-open":"closed",[b]),C=s.useCallback(()=>{window.clearTimeout(h.current),y.current=!1,v(!0)},[v]),k=s.useCallback(()=>{window.clearTimeout(h.current),v(!1)},[v]),P=s.useCallback(()=>{window.clearTimeout(h.current),h.current=window.setTimeout(()=>{y.current=!0,v(!0)},g)},[g,v]);return s.useEffect(()=>()=>window.clearTimeout(h.current),[]),(0,a.jsx)(w.fC,{...u,children:(0,a.jsx)(Z,{scope:t,contentId:x,open:b,stateAttribute:j,trigger:m,onTriggerChange:p,onTriggerEnter:s.useCallback(()=>{d.isOpenDelayed?P():C()},[d.isOpenDelayed,P,C]),onTriggerLeave:s.useCallback(()=>{f?k():window.clearTimeout(h.current)},[k,f]),onOpen:C,onClose:k,disableHoverableContent:f,children:r})})};$.displayName=F;var A="TooltipTrigger",L=s.forwardRef((e,t)=>{let{__scopeTooltip:r,...n}=e,i=z(A,r),l=O(A,r),o=S(r),c=s.useRef(null),d=(0,b.e)(t,c,i.onTriggerChange),u=s.useRef(!1),m=s.useRef(!1),p=s.useCallback(()=>u.current=!1,[]);return s.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),(0,a.jsx)(w.ee,{asChild:!0,...o,children:(0,a.jsx)(k.WV.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...n,ref:d,onPointerMove:(0,y.M)(e.onPointerMove,e=>{"touch"===e.pointerType||m.current||l.isPointerInTransitRef.current||(i.onTriggerEnter(),m.current=!0)}),onPointerLeave:(0,y.M)(e.onPointerLeave,()=>{i.onTriggerLeave(),m.current=!1}),onPointerDown:(0,y.M)(e.onPointerDown,()=>{u.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:(0,y.M)(e.onFocus,()=>{u.current||i.onOpen()}),onBlur:(0,y.M)(e.onBlur,i.onClose),onClick:(0,y.M)(e.onClick,i.onClose)})})});L.displayName=A;var[U,B]=_("TooltipPortal",{forceMount:void 0}),V="TooltipContent",J=s.forwardRef((e,t)=>{let r=B(V,e.__scopeTooltip),{forceMount:s=r.forceMount,side:n="top",...i}=e,l=z(V,e.__scopeTooltip);return(0,a.jsx)(C.z,{present:s||l.open,children:l.disableHoverableContent?(0,a.jsx)(X,{side:n,...i,ref:t}):(0,a.jsx)(Q,{side:n,...i,ref:t})})}),Q=s.forwardRef((e,t)=>{let r=z(V,e.__scopeTooltip),n=O(V,e.__scopeTooltip),i=s.useRef(null),l=(0,b.e)(t,i),[o,c]=s.useState(null),{trigger:d,onClose:u}=r,m=i.current,{onPointerInTransitChange:p}=n,x=s.useCallback(()=>{c(null),p(!1)},[p]),h=s.useCallback((e,t)=>{let r=e.currentTarget,a={x:e.clientX,y:e.clientY},s=function(e,t){let r=Math.abs(t.top-e.y),a=Math.abs(t.bottom-e.y),s=Math.abs(t.right-e.x),n=Math.abs(t.left-e.x);switch(Math.min(r,a,s,n)){case n:return"left";case s:return"right";case r:return"top";case a:return"bottom";default:throw Error("unreachable")}}(a,r.getBoundingClientRect());c(function(e){let t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();let t=[];for(let r=0;r<e.length;r++){let a=e[r];for(;t.length>=2;){let e=t[t.length-1],r=t[t.length-2];if((e.x-r.x)*(a.y-r.y)>=(e.y-r.y)*(a.x-r.x))t.pop();else break}t.push(a)}t.pop();let r=[];for(let t=e.length-1;t>=0;t--){let a=e[t];for(;r.length>=2;){let e=r[r.length-1],t=r[r.length-2];if((e.x-t.x)*(a.y-t.y)>=(e.y-t.y)*(a.x-t.x))r.pop();else break}r.push(a)}return(r.pop(),1===t.length&&1===r.length&&t[0].x===r[0].x&&t[0].y===r[0].y)?t:t.concat(r)}(t)}([...function(e,t,r=5){let a=[];switch(t){case"top":a.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":a.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":a.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":a.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r})}return a}(a,s),...function(e){let{top:t,right:r,bottom:a,left:s}=e;return[{x:s,y:t},{x:r,y:t},{x:r,y:a},{x:s,y:a}]}(t.getBoundingClientRect())])),p(!0)},[p]);return s.useEffect(()=>()=>x(),[x]),s.useEffect(()=>{if(d&&m){let e=e=>h(e,m),t=e=>h(e,d);return d.addEventListener("pointerleave",e),m.addEventListener("pointerleave",t),()=>{d.removeEventListener("pointerleave",e),m.removeEventListener("pointerleave",t)}}},[d,m,h,x]),s.useEffect(()=>{if(o){let e=e=>{let t=e.target,r={x:e.clientX,y:e.clientY},a=d?.contains(t)||m?.contains(t),s=!function(e,t){let{x:r,y:a}=e,s=!1;for(let e=0,n=t.length-1;e<t.length;n=e++){let i=t[e].x,l=t[e].y,o=t[n].x,c=t[n].y;l>a!=c>a&&r<(o-i)*(a-l)/(c-l)+i&&(s=!s)}return s}(r,o);a?x():s&&(x(),u())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[d,m,o,u,x]),(0,a.jsx)(X,{...e,ref:l})}),[H,K]=_(F,{isInside:!1}),X=s.forwardRef((e,t)=>{let{__scopeTooltip:r,children:n,"aria-label":i,onEscapeKeyDown:l,onPointerDownOutside:o,...c}=e,d=z(V,r),u=S(r),{onClose:m}=d;return s.useEffect(()=>(document.addEventListener(M,m),()=>document.removeEventListener(M,m)),[m]),s.useEffect(()=>{if(d.trigger){let e=e=>{let t=e.target;t?.contains(d.trigger)&&m()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[d.trigger,m]),(0,a.jsx)(j.XB,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:m,children:(0,a.jsxs)(w.VY,{"data-state":d.stateAttribute,...u,...c,ref:t,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,a.jsx)(P.A4,{children:n}),(0,a.jsx)(H,{scope:r,isInside:!0,children:(0,a.jsx)(E.f,{id:d.contentId,role:"tooltip",children:i||n})})]})})});J.displayName=V;var W="TooltipArrow";s.forwardRef((e,t)=>{let{__scopeTooltip:r,...s}=e,n=S(r);return K(W,r).isInside?null:(0,a.jsx)(w.Eh,{...n,...s,ref:t})}).displayName=W;let G=s.forwardRef(({className:e,sideOffset:t=4,...r},s)=>a.jsx(J,{ref:s,sideOffset:t,className:(0,d.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));G.displayName=J.displayName;var Y=r(41790),ee="Collapsible",[et,er]=(0,v.b)(ee),[ea,es]=et(ee),en=s.forwardRef((e,t)=>{let{__scopeCollapsible:r,open:n,defaultOpen:i,disabled:l,onOpenChange:o,...c}=e,[d=!1,u]=(0,T.T)({prop:n,defaultProp:i,onChange:o});return(0,a.jsx)(ea,{scope:r,disabled:l,contentId:(0,N.M)(),open:d,onOpenToggle:s.useCallback(()=>u(e=>!e),[u]),children:(0,a.jsx)(k.WV.div,{"data-state":eu(d),"data-disabled":l?"":void 0,...c,ref:t})})});en.displayName=ee;var ei="CollapsibleTrigger",el=s.forwardRef((e,t)=>{let{__scopeCollapsible:r,...s}=e,n=es(ei,r);return(0,a.jsx)(k.WV.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":eu(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...s,ref:t,onClick:(0,y.M)(e.onClick,n.onOpenToggle)})});el.displayName=ei;var eo="CollapsibleContent",ec=s.forwardRef((e,t)=>{let{forceMount:r,...s}=e,n=es(eo,e.__scopeCollapsible);return(0,a.jsx)(C.z,{present:r||n.open,children:({present:e})=>(0,a.jsx)(ed,{...s,ref:t,present:e})})});ec.displayName=eo;var ed=s.forwardRef((e,t)=>{let{__scopeCollapsible:r,present:n,children:i,...l}=e,o=es(eo,r),[c,d]=s.useState(n),u=s.useRef(null),m=(0,b.e)(t,u),p=s.useRef(0),x=p.current,h=s.useRef(0),f=h.current,g=o.open||c,y=s.useRef(g),v=s.useRef();return s.useEffect(()=>{let e=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,Y.b)(()=>{let e=u.current;if(e){v.current=v.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";let t=e.getBoundingClientRect();p.current=t.height,h.current=t.width,y.current||(e.style.transitionDuration=v.current.transitionDuration,e.style.animationName=v.current.animationName),d(n)}},[o.open,n]),(0,a.jsx)(k.WV.div,{"data-state":eu(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!g,...l,ref:m,style:{"--radix-collapsible-content-height":x?`${x}px`:void 0,"--radix-collapsible-content-width":f?`${f}px`:void 0,...e.style},children:g&&i})});function eu(e){return e?"open":"closed"}var em=r(6e4),ep=r(71945);let ex=(0,ep.Z)("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);var eh=r(42594),ef=r(85453);let eg=(0,ep.Z)("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);var ey=r(71028),eb=r(26026),ev=r(7259),ej=r(97718),eN=r(75909),ew=r(10333);let eC=(0,ep.Z)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var ek=r(32317),eP=r(35797),eT=r(76021);let eE=(0,ep.Z)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var e_=r(40422),eD=r(52256),eS=r(14726),eI=r(39350),eM=r(74317),eR=r(88846),eO=r(7409),eq=r(12174),eF=r(89280);function eZ(e){return`${e.grip}px ${e.number}px minmax(200px, 1fr) ${e.unit}px ${e.unitCost}px ${e.markup}px ${e.unitPrice}px ${e.qty}px ${e.amount}px ${e.actions}px`}function ez({item:e,itemNumber:t,categoryId:r,categoryName:s,columnWidths:n,getItemValue:i,handleUpdateItem:l,handleDeleteItem:d,openEditItemDialog:m,handleNoteClick:p,inlineEditingNoteId:x,inlineEditText:f,setInlineEditText:g,inlineTextareaRef:y,handleInlineNoteKeyDown:b,saveInlineEdit:v,cancelInlineEdit:j,sanitizeHtml:N,formatNumber:w,formatCurrency:C}){let{attributes:k,listeners:P,setNodeRef:T,setActivatorNodeRef:E,transform:_,transition:D,isDragging:S}=(0,eO.nB)({id:e.id}),I={transform:eq.ux.Transform.toString(_),transition:D,display:"grid",gridTemplateColumns:eZ(n)};if(e?.isNote)return(0,a.jsxs)("div",{ref:T,style:I,...k,className:`items-center border-b border-gray-100 bg-amber-50 ${S?"opacity-50 bg-amber-100 shadow-lg z-50":""}`,role:"row",children:[a.jsx("div",{className:"py-2 px-1 flex items-center justify-center",role:"cell",children:a.jsx("div",{ref:E,...P,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},children:a.jsx(em.Z,{className:"w-4 h-4 text-gray-400 pointer-events-none"})})}),a.jsx("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:a.jsx(ex,{className:"w-4 h-4 text-amber-500"})}),a.jsx("div",{className:"py-2 px-2",role:"cell",style:{gridColumn:"3 / 10"},children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[x===e.id?(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[a.jsx(u,{ref:y,value:f,onChange:e=>g(e.target.value),onBlur:()=>v(e.id),onKeyDown:t=>b(t,e.id),className:"min-h-[60px] text-sm resize-none",placeholder:"Enter note text..."}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-xs text-gray-400",children:"Basic edit (Ctrl+Enter to save, Esc to cancel). Use expand for formatting."}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsxs)(o.z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-gray-500 hover:text-gray-700",onClick:e=>{e.preventDefault(),j()},children:[a.jsx(eh.Z,{className:"w-3 h-3 mr-1"}),"Cancel"]}),(0,a.jsxs)(o.z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-cyan-600 hover:text-cyan-700",onClick:t=>{t.preventDefault(),v(e.id)},children:[a.jsx(ef.Z,{className:"w-3 h-3 mr-1"}),"Save"]})]})]})]}):a.jsx("div",{className:"flex-1 min-h-[32px] px-3 py-1.5 bg-white border rounded-lg text-sm cursor-text hover:border-cyan-400 transition-colors",onClick:()=>p(e,r,s,i(e.id,"noteContent",e?.noteContent)??""),title:"Click to edit",children:i(e.id,"noteContent",e?.noteContent)?a.jsx("div",{className:"prose prose-sm max-w-none [&_strong]:font-bold [&_b]:font-bold [&_em]:italic [&_i]:italic [&_u]:underline",dangerouslySetInnerHTML:{__html:N(i(e.id,"noteContent",e?.noteContent)??"")}}):a.jsx("span",{className:"text-gray-400",children:"Click to add note..."})}),a.jsx(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-cyan-600 flex-shrink-0",onClick:()=>m(e,r,s,null),title:"Edit note with formatting (B/I/U)",children:a.jsx(eg,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(h.X,{id:`pdf-${e.id}`,checked:i(e.id,"includeInPdf",e?.includeInPdf)??!0,onCheckedChange:t=>l(e?.id,{includeInPdf:t},!0)}),a.jsx("label",{htmlFor:`pdf-${e.id}`,className:"text-xs text-gray-500",children:"Include in PDF"})]})})]})}),a.jsx("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:a.jsx(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-500",onClick:()=>d(e?.id),children:a.jsx(ey.Z,{className:"w-4 h-4"})})})]});let M=i(e.id,"unitCost",e?.unitCost)??0,R=i(e.id,"markupPct",e?.markupPct)??0,O=i(e.id,"quantity",e?.quantity)??0,q=M*(1+R/100);return(0,a.jsxs)("div",{ref:T,style:I,...k,className:`items-center border-b border-gray-100 hover:bg-gray-50 ${S?"opacity-50 bg-gray-100 shadow-lg z-50":""}`,role:"row",children:[a.jsx("div",{className:"py-2 px-1 flex items-center justify-center",role:"cell",children:a.jsx("div",{ref:E,...P,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},children:a.jsx(em.Z,{className:"w-4 h-4 text-gray-400 pointer-events-none"})})}),a.jsx("div",{className:"py-2 px-2 text-gray-500 text-sm",role:"cell",children:t}),a.jsx("div",{className:"py-2 px-2 min-w-0",role:"cell",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[a.jsx(c.I,{value:i(e.id,"description",e?.description)??"",onChange:t=>l(e?.id,{description:t.target.value}),className:"h-8 text-sm w-full",placeholder:"Description"}),a.jsx(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-cyan-600 flex-shrink-0",onClick:()=>m(e,r,s,t),title:"Expand to edit",children:a.jsx(eg,{className:"w-4 h-4"})})]})}),a.jsx("div",{className:"py-2 px-2",role:"cell",children:a.jsx(c.I,{value:i(e.id,"unit",e?.unit)??"",onChange:t=>l(e?.id,{unit:t.target.value}),className:"h-8 text-sm w-full",placeholder:"Unit"})}),a.jsx("div",{className:"py-2 px-2",role:"cell",children:a.jsx(c.I,{type:"number",step:"0.01",value:M,onChange:t=>l(e?.id,{unitCost:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),a.jsx("div",{className:"py-2 px-2",role:"cell",children:a.jsx(c.I,{type:"number",step:"0.01",value:R,onChange:t=>l(e?.id,{markupPct:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),a.jsx("div",{className:"py-2 px-2 text-right font-medium text-gray-700 text-sm whitespace-nowrap",role:"cell",children:w(q)}),a.jsx("div",{className:"py-2 px-2",role:"cell",children:a.jsx(c.I,{type:"number",step:"0.01",value:O,onChange:t=>l(e?.id,{quantity:parseFloat(t.target.value)||0}),className:"h-8 text-sm text-right w-full"})}),a.jsx("div",{className:"py-2 px-2 text-right font-semibold text-cyan-600 text-sm whitespace-nowrap",role:"cell",children:C(q*O)}),a.jsx("div",{className:"py-2 px-2 flex items-center justify-center",role:"cell",children:a.jsx(o.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-500",onClick:()=>d(e?.id),children:a.jsx(ey.Z,{className:"w-4 h-4"})})})]})}function e$({category:e,categoryIndex:t,isExpanded:r,toggleCategory:n,getCategoryName:i,handleUpdateCategory:l,handleDeleteCategory:d,handleAddItem:u,formatCurrency:p,getCategorySubtotal:x,columnWidths:h,handleResizeStart:f,sensors:g,getItemNumber:y,handleItemDragStart:b,handleItemDragEnd:v,getItemValue:j,handleUpdateItem:N,handleDeleteItem:w,openEditItemDialog:C,handleNoteClick:k,inlineEditingNoteId:P,inlineEditText:T,setInlineEditText:E,inlineTextareaRef:_,handleInlineNoteKeyDown:D,saveInlineEdit:S,cancelInlineEdit:I,sanitizeHtml:M,formatNumber:R,itemLimit:O,currentItemCount:q,isAtItemLimit:F,planKey:Z}){let{attributes:z,listeners:$,setNodeRef:A,setActivatorNodeRef:L,transform:U,transition:B,isDragging:V}=(0,eO.nB)({id:e.id}),J={transform:eq.ux.Transform.toString(U),transition:B},Q=(0,s.useMemo)(()=>(e?.items??[]).map(e=>e?.id),[e?.items]);return a.jsx("div",{ref:A,style:J,...z,className:V?"opacity-50":"",children:a.jsx(m.Zb,{className:`shadow-md border-0 overflow-hidden transition-shadow ${V?"shadow-xl ring-2 ring-cyan-400":""}`,children:(0,a.jsxs)(en,{open:r,onOpenChange:()=>n(e?.id),children:[a.jsx(el,{asChild:!0,children:a.jsx(m.Ol,{className:"cursor-pointer hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[a.jsx("div",{ref:L,...$,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-200 rounded select-none",style:{touchAction:"none",userSelect:"none"},onClick:e=>e.stopPropagation(),children:a.jsx(em.Z,{className:"w-5 h-5 text-gray-400 flex-shrink-0 pointer-events-none"})}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-500 flex-shrink-0",children:[t+1,"."]}),a.jsx(c.I,{value:i(e),onChange:t=>{t.stopPropagation(),l(e?.id,t.target.value)},onClick:e=>e.stopPropagation(),className:"text-lg font-semibold border-0 p-0 h-auto focus-visible:ring-0 bg-transparent flex-1 min-w-0"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 flex-shrink-0",children:["(",(e?.items??[]).filter(e=>!e?.isNote).length," items)"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[a.jsx("span",{className:"text-lg font-semibold text-cyan-600",children:p(x(e))}),a.jsx(o.z,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-red-500",onClick:t=>{t.stopPropagation(),d(e?.id)},children:a.jsx(ey.Z,{className:"w-4 h-4"})}),r?a.jsx(eb.Z,{className:"w-5 h-5 text-gray-400"}):a.jsx(ev.Z,{className:"w-5 h-5 text-gray-400"})]})]})})}),a.jsx(ec,{children:(0,a.jsxs)(m.aY,{className:"pt-0",children:[a.jsx(eR.LB,{sensors:g,collisionDetection:eR.pE,onDragStart:b,onDragEnd:t=>v(t,e.id),modifiers:[eF.DL],children:a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("div",{className:"text-sm flex flex-col",role:"table",style:{minWidth:"900px"},children:[(0,a.jsxs)("div",{role:"row",style:{display:"grid",gridTemplateColumns:eZ(h)},children:[a.jsx("div",{className:"py-2 px-1 font-medium text-gray-500 border-b border-gray-200",role:"columnheader"}),(0,a.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["#",a.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"number")})]}),(0,a.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Description",a.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"description")})]}),(0,a.jsxs)("div",{className:"py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit",a.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unit")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit Cost",a.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unitCost")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Markup %",a.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"markup")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Unit Price",a.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"unitPrice")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Qty",a.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"qty")})]}),(0,a.jsxs)("div",{className:"text-right py-2 px-2 font-medium text-gray-500 relative border-b border-gray-200",role:"columnheader",children:["Amount",a.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-cyan-300 transition-colors",onMouseDown:e=>f(e,"amount")})]}),a.jsx("div",{className:"border-b border-gray-200",role:"columnheader"})]}),a.jsx(eO.Fo,{items:Q,strategy:eO.qw,children:(e?.items??[]).map((r,s)=>a.jsx(ez,{item:r,itemNumber:y(t,e?.items??[],s),categoryId:e.id,categoryName:e.name??"",columnWidths:h,getItemValue:j,handleUpdateItem:N,handleDeleteItem:w,openEditItemDialog:C,handleNoteClick:k,inlineEditingNoteId:P,inlineEditText:T,setInlineEditText:E,inlineTextareaRef:_,handleInlineNoteKeyDown:D,saveInlineEdit:S,cancelInlineEdit:I,sanitizeHtml:M,formatNumber:R,formatCurrency:p},r?.id))})]})})}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2 mt-3",children:[F&&(0,a.jsxs)("div",{className:"text-xs text-amber-600 bg-amber-50 px-3 py-2 rounded-md border border-amber-200",children:["Item limit reached (",q,"/",O,").",a.jsx("a",{href:"/pricing",className:"ml-1 underline hover:text-amber-700",children:"Upgrade"})," to add more items."]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(o.z,{variant:"ghost",className:`flex-1 ${F?"text-gray-400 cursor-not-allowed":"text-cyan-600 hover:text-cyan-700 hover:bg-cyan-50"}`,onClick:()=>u(e?.id,!1),disabled:F,children:[a.jsx(ej.Z,{className:"w-4 h-4 mr-2"}),"Add Item ",null!==O&&`(${q}/${O})`]}),(0,a.jsxs)(o.z,{variant:"ghost",className:"text-amber-600 hover:text-amber-700 hover:bg-amber-50",onClick:()=>u(e?.id,!0),children:[a.jsx(ex,{className:"w-4 h-4 mr-2"}),"Add Note"]})]})]})]})})]})})})}function eA({boq:e,customers:t,company:r,coverTemplates:d,pdfThemes:y}){let b=(0,n.useRouter)(),[v,j]=(0,s.useState)(e),[N,w]=(0,s.useState)(t??[]),[C,k]=(0,s.useState)(d??[]),[P,T]=(0,s.useState)(y??[]),[E,_]=(0,s.useState)(new Set((e?.categories??[]).map(e=>e?.id))),[D,S]=(0,s.useState)(!1),[I,M]=(0,s.useState)(null),[R,O]=(0,s.useState)(!1),[F,Z]=(0,s.useState)(""),[z,A]=(0,s.useState)(""),[U,B]=(0,s.useState)(""),[V,J]=(0,s.useState)(!1),[Q,H]=(0,s.useState)(null),[K,X]=(0,s.useState)(null),[W,Y]=(0,s.useState)(null),[ee,et]=(0,s.useState)({}),er=(0,s.useRef)(null),ea=(0,s.useRef)(null),[es,en]=(0,s.useState)(null),[ei,el]=(0,s.useState)(""),eo=(0,s.useRef)(null),[ec,ed]=(0,s.useState)(e?.projectName??""),[eu,em]=(0,s.useState)({}),[ep,ex]=(0,s.useState)({}),eh={grip:32,number:52,description:280,unit:80,unitCost:100,markup:80,unitPrice:100,qty:70,amount:130,actions:44},[eg,ey]=(0,s.useState)(eh),[eb,ev]=(0,s.useState)(null),eq=(0,s.useRef)(0),eZ=(0,s.useRef)(0),ez=(0,s.useRef)(null),eA=(0,s.useRef)({}),eL=r?.currencySymbol??"Rs.",eU=r?.currencyPosition??"left",eB=(0,s.useCallback)(e=>e||"",[]),eV=(0,s.useCallback)(e=>!!e&&!!(RegExp("<(strong|b|em|i|u|ul|ol|li|h1|h2|h3|h4|h5|h6|blockquote|code|pre)(\\s[^>]*)?>","i").test(e)||/<span\s+[^>]*style\s*=/i.test(e)||/<[^>]+\s+style\s*=/i.test(e)),[]),eJ=(0,s.useCallback)(e=>e||"",[]),eQ=(0,s.useCallback)(e=>e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>"):"",[]),eH=(0,s.useCallback)((e,t=2)=>e.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t}),[]),eK=(0,s.useCallback)(e=>{let t=eH(e??0,2);return"left"===eU?`${eL} ${t}`:`${t} ${eL}`},[eL,eU,eH]),eX=(0,s.useCallback)(()=>{let e=0,t=0;(v?.categories??[]).forEach(r=>{(r?.items??[]).forEach(r=>{if(r?.isNote)return;let a=r?.quantity??0;if(a>0){let s=(r?.unitCost??0)*(1+(r?.markupPct??0)/100);e+=s*a,t+=(r?.unitCost??0)*a}})});let r=0;v?.discountEnabled&&(r=v?.discountType==="percent"?(v?.discountValue??0)/100*e:v?.discountValue??0);let a=e-r,s=v?.vatEnabled?(v?.vatPercent??0)/100*a:0,n=a-t;return{subtotal:Math.round(100*e)/100,discount:Math.round(100*r)/100,vatAmount:Math.round(100*s)/100,finalTotal:Math.round(100*(a+s))/100,totalCost:Math.round(100*t)/100,priceAfterDiscount:Math.round(100*a)/100,profit:Math.round(100*n)/100,grossProfitPct:Math.round(100*(a>0?n/a*100:0))/100}},[v])(),eW=(0,s.useRef)(null),eG=(0,s.useCallback)(async()=>{S(!0);try{await fetch(`/api/boqs/${v?.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectName:v?.projectName,customerId:v?.customerId,coverTemplateId:v?.coverTemplateId,pdfThemeId:v?.pdfThemeId,dateMode:v?.dateMode,preparationDate:v?.preparationDate,discountEnabled:v?.discountEnabled,discountType:v?.discountType,discountValue:v?.discountValue,vatEnabled:v?.vatEnabled,vatPercent:v?.vatPercent,status:v?.status})}),M(new Date)}catch(e){console.error("Autosave failed:",e)}finally{S(!1)}},[v]),eY=(0,s.useCallback)(()=>{ez.current&&clearTimeout(ez.current),ez.current=setTimeout(()=>{eW.current=eG()},1500)},[eG]),e0=(0,s.useCallback)(async()=>{ez.current&&(clearTimeout(ez.current),ez.current=null),eW.current&&await eW.current,await eG()},[eG]),e2=(0,s.useMemo)(()=>v?.categories?v.categories.reduce((e,t)=>t?.items?e+t.items.filter(e=>!e?.isNote).length:e,0):0,[v?.categories]),e1=null!==Q&&e2>=Q,e4=(0,s.useCallback)(e=>{try{localStorage.setItem("boq_column_widths",JSON.stringify(e))}catch(e){}},[]),e3=(0,s.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),ev(t),eq.current=e.clientX,eZ.current=eg[t]},[eg]);(0,s.useCallback)(e=>{if(!eb)return;let t=e.clientX-eq.current,r=Math.max(40,eZ.current+t);ey(e=>({...e,[eb]:r}))},[eb]),(0,s.useCallback)(()=>{eb&&e4(eg),ev(null)},[eb,eg,e4]);let e5=(0,s.useCallback)(()=>{ey(eh);try{localStorage.removeItem("boq_column_widths")}catch(e){}eI.ZP.success("Column widths reset to default")},[]),e8=e=>{j(t=>({...t??{},...e})),eY()},e6=e=>{ed(e),eA.current.projectName&&clearTimeout(eA.current.projectName),eA.current.projectName=setTimeout(()=>{e8({projectName:e})},500)},e7=async()=>{try{let e=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({boqId:v?.id,name:"New Category",sortOrder:v?.categories?.length??0})}),t=await e.json();j(e=>({...e??{},categories:[...e?.categories??[],{...t,items:[]}]})),_(e=>new Set([...e,t?.id]))}catch(e){eI.ZP.error("Failed to add category")}},e9=async(e,t)=>{em(r=>({...r,[e]:t})),eA.current[`cat_${e}`]&&clearTimeout(eA.current[`cat_${e}`]),eA.current[`cat_${e}`]=setTimeout(async()=>{try{await fetch(`/api/categories/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})}),j(r=>({...r??{},categories:(r?.categories??[]).map(r=>r?.id===e?{...r??{},name:t}:r)}))}catch(e){eI.ZP.error("Failed to update category")}},500)},te=(0,s.useCallback)(e=>eu[e.id]??e.name??"",[eu]),tt=async e=>{if(confirm("Delete this category and all its items?"))try{await fetch(`/api/categories/${e}`,{method:"DELETE"}),j(t=>({...t??{},categories:(t?.categories??[]).filter(t=>t?.id!==e)}))}catch(e){eI.ZP.error("Failed to delete category")}},tr=async(e,t=!1)=>{let r=(v?.categories??[]).find(t=>t?.id===e);try{let a=await fetch("/api/items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoryId:e,description:"",unit:"",unitCost:0,markupPct:0,quantity:0,sortOrder:r?.items?.length??0,isNote:t,noteContent:t?"":null,includeInPdf:!0})}),s=await a.json();if(403===a.status&&"Item limit reached"===s.error){(0,eM.PR)("ReachedLimit",{limit_type:"items_per_boq",plan_key:s.plan_key||"unknown"}),eI.ZP.error(s.message||"Item limit reached. Upgrade to add more items.",{duration:5e3});return}if(!a.ok)throw Error(s.error||"Failed to add item");j(t=>({...t??{},categories:(t?.categories??[]).map(t=>t?.id===e?{...t??{},items:[...t?.items??[],s]}:t)}))}catch(e){eI.ZP.error("Failed to add item")}},ta=(0,s.useCallback)((e,t,r)=>ep[e]?.[t]??r,[ep]),ts=(0,s.useCallback)(async(e,t,r=!1)=>{ex(r=>({...r,[e]:{...r[e]??{},...t}})),j(r=>({...r??{},categories:(r?.categories??[]).map(r=>({...r??{},items:(r?.items??[]).map(r=>r?.id===e?{...r??{},...t}:r)}))}));let a=`item_${e}`;eA.current[a]&&clearTimeout(eA.current[a]);let s=async()=>{try{await fetch(`/api/items/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),M(new Date)}catch(e){console.error("Failed to update item:",e)}};r?s():eA.current[a]=setTimeout(s,500)},[]),tn=(0,s.useCallback)(async e=>{try{await fetch(`/api/items/${e}`,{method:"DELETE"}),j(t=>({...t??{},categories:(t?.categories??[]).map(t=>({...t??{},items:(t?.items??[]).filter(t=>t?.id!==e)}))}))}catch(e){eI.ZP.error("Failed to delete item")}},[]),ti=(0,s.useCallback)(()=>{en(null),el("")},[]),tl=(0,s.useCallback)(async e=>{let t=eQ(ei);await ts(e,{noteContent:t},!0),en(null),el("")},[ei,eQ,ts]),to=(0,s.useCallback)((e,t)=>{if("Escape"===e.key){e.preventDefault(),ti();return}(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),tl(t))},[ti,tl]),tc=(0,eR.Dy)((0,eR.VT)(eR.we,{activationConstraint:{distance:3}}),(0,eR.VT)(eR.Lg,{coordinateGetter:eO.is})),td=(0,s.useCallback)(e=>{console.log("Item drag started:",e.active.id)},[]),tu=(0,s.useCallback)(async(e,t)=>{let{active:r,over:a}=e;if(console.log("Item drag ended:",r.id,"over:",a?.id),!a||r.id===a.id)return;let s=(v?.categories??[]).find(e=>e?.id===t);if(!s)return;let n=[...s.items??[]],i=n.findIndex(e=>e.id===r.id),l=n.findIndex(e=>e.id===a.id);if(-1===i||-1===l||i===l)return;let o=(0,eO.Rp)(n,i,l).map((e,t)=>({...e,sortOrder:t}));j(e=>({...e??{},categories:(e?.categories??[]).map(e=>e?.id===t?{...e,items:o}:e)}));try{await Promise.all(o.map(e=>fetch(`/api/items/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:e.sortOrder})}))),M(new Date)}catch(e){eI.ZP.error("Failed to reorder items")}},[v?.categories]),tm=(0,s.useCallback)(e=>{},[]),tp=(0,s.useCallback)(async e=>{let{active:t,over:r}=e;if(!r||t.id===r.id)return;let a=[...v?.categories??[]],s=a.findIndex(e=>e.id===t.id),n=a.findIndex(e=>e.id===r.id);if(-1===s||-1===n||s===n)return;let i=(0,eO.Rp)(a,s,n).map((e,t)=>({...e,sortOrder:t}));j(e=>({...e??{},categories:i}));try{await Promise.all(i.map(e=>fetch(`/api/categories/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sortOrder:e.sortOrder})}))),M(new Date)}catch(e){eI.ZP.error("Failed to reorder categories")}},[v?.categories]),tx=(0,s.useCallback)((e,t,r,a)=>{let s=e.noteContent,n=ep[e.id]?.noteContent;void 0!==n&&(s=n),ea.current=null,Y({item:{...e,noteContent:s},categoryId:t,categoryName:r,itemNumber:a}),et({description:e.description,unit:e.unit,unitCost:e.unitCost,markupPct:e.markupPct,quantity:e.quantity,noteContent:s,includeInPdf:e.includeInPdf})},[ep]),th=(0,s.useCallback)((e,t,r,a)=>{if(eV(a)){tx(e,t,r,null);return}el(eJ(a)),en(e.id),setTimeout(()=>{eo.current?.focus()},50)},[eV,tx,eJ]),tf=async()=>{W&&(await ts(W.item.id,ee,!0),Y(null),et({}))},tg=(0,s.useCallback)(e=>{if(er.current&&er.current.focus(),document.execCommand(e,!1),er.current){let e=er.current.innerHTML;et(t=>({...t,noteContent:e}))}},[]),ty=(0,s.useCallback)(e=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&("b"===e.key||"B"===e.key?(e.preventDefault(),tg("bold")):"i"===e.key||"I"===e.key?(e.preventDefault(),tg("italic")):("u"===e.key||"U"===e.key)&&(e.preventDefault(),tg("underline")))},[tg]),tb=async()=>{if(!F?.trim?.()){eI.ZP.error("Please enter a customer name");return}try{let e=await fetch("/api/customers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:F,email:z||null,phone:U||null})}),t=await e.json();if(!e.ok){eI.ZP.error(t?.error||"Failed to create customer");return}w([...N??[],t]),e8({customerId:t?.id}),O(!1),Z(""),A(""),B(""),eI.ZP.success("Customer created")}catch(e){eI.ZP.error("An error occurred")}},tv=async()=>{let e;J(!0);try{await e0(),e=eI.ZP.loading("Starting PDF export...");let t=await fetch(`/api/boqs/${v?.id}/pdf/async`,{method:"POST"});if(!t.ok)throw Error("Failed to start PDF export");let{jobId:r,status:a,message:s}=await t.json();if(!r)throw Error("No job ID returned");eI.ZP.loading("Generating PDF...",{id:e});let n=0;for(;n<300;){await new Promise(e=>setTimeout(e,1e3));let t=await fetch(`/api/pdf-jobs/${r}`);if(!t.ok)throw Error("Failed to check job status");let{status:a,pdfUrl:s,errorMessage:i,elapsedMs:l}=await t.json();if("processing"===a&&l>0&&eI.ZP.loading(`Generating PDF... (${Math.round(l/1e3)}s)`,{id:e}),"completed"===a&&s){if(eI.ZP.loading("Downloading PDF...",{id:e}),s.startsWith("data:")){let e=s.split(",")[1],t=atob(e),r=Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);let a=new Uint8Array(r),n=new Blob([a],{type:"application/pdf"}),i=window.URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.download=`${v?.projectName??"BOQ"}.pdf`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(i),document.body.removeChild(l)}else{let e=document.createElement("a");e.href=s,e.download=`${v?.projectName??"BOQ"}.pdf`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}(0,eM.PR)("ExportPDF",{kind:"boq"}),eI.ZP.success("PDF downloaded",{id:e});return}if("failed"===a)throw Error(i||"PDF generation failed");n++}throw Error("PDF generation timed out")}catch(r){let t=r instanceof Error?r.message:"Failed to export PDF";e?eI.ZP.error(t,{id:e}):eI.ZP.error(t)}finally{J(!1)}},tj=(0,s.useCallback)(e=>{_(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),tN=(0,s.useCallback)(e=>(e?.items??[]).reduce((e,t)=>{if(t?.isNote)return e;let r=t?.quantity??0;return r>0?e+(t?.unitCost??0)*(1+(t?.markupPct??0)/100)*r:e},0),[]),tw=(0,s.useCallback)((e,t,r)=>{let a=t[r];if(a?.isNote)return null;let s=0;for(let e=0;e<=r;e++)!t[e]?.isNote&&s++;return`${e+1}.${s}`},[]),tC=(0,s.useMemo)(()=>(v?.categories??[]).map(e=>e?.id),[v?.categories]);return a.jsx(l.AppLayout,{children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[a.jsx(i.default,{href:"/dashboard",children:a.jsx(o.z,{variant:"ghost",size:"icon",className:"flex-shrink-0",children:a.jsx(eN.Z,{className:"w-5 h-5"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 max-w-2xl",children:[a.jsx(c.I,{value:ec,onChange:e=>e6(e.target.value),className:"text-xl font-semibold border-0 p-0 h-auto focus-visible:ring-0 bg-transparent w-full",placeholder:"Project Name"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsxs)(f.Ph,{value:v?.customerId??"none",onValueChange:e=>e8({customerId:"none"===e?null:e}),children:[a.jsx(f.i4,{className:"h-8 text-sm w-[200px]",children:a.jsx(f.ki,{placeholder:"Select customer"})}),(0,a.jsxs)(f.Bw,{children:[a.jsx(f.Ql,{value:"none",children:"No customer"}),(N??[]).map(e=>a.jsx(f.Ql,{value:e?.id??"",children:e?.name},e?.id))]})]}),a.jsx(o.z,{variant:"outline",size:"sm",onClick:()=>O(!0),children:a.jsx(ej.Z,{className:"w-4 h-4"})})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[a.jsx("div",{className:"flex items-center text-sm text-gray-500",children:D?(0,a.jsxs)(a.Fragment,{children:[a.jsx(ew.Z,{className:"w-4 h-4 animate-spin mr-1"}),"Saving..."]}):I?(0,a.jsxs)(a.Fragment,{children:[a.jsx(ef.Z,{className:"w-4 h-4 text-green-500 mr-1"}),"Saved"]}):null}),a.jsx(q,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 border-l pl-3",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[a.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Cover Page"}),(0,a.jsxs)($,{children:[a.jsx(L,{asChild:!0,children:a.jsx(eC,{className:"w-3 h-3 text-gray-400 cursor-help"})}),a.jsx(G,{children:a.jsx("p",{className:"text-xs max-w-48",children:"Controls the cover page elements, layout, and styling"})})]})]}),(0,a.jsxs)(f.Ph,{value:v?.coverTemplateId||"default",onValueChange:e=>{if("create_new"===e){b.push("/app/settings?tab=pdf");return}e8({coverTemplateId:"default"===e?null:e})},children:[(0,a.jsxs)(f.i4,{className:"w-40 h-8 text-xs",children:[a.jsx(ek.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),a.jsx(f.ki,{placeholder:"Cover Template"})]}),(0,a.jsxs)(f.Bw,{children:[a.jsx(f.Ql,{value:"default",children:"Company Default"}),C.map(e=>(0,a.jsxs)(f.Ql,{value:e.id,children:[e.name," ",e.isDefault&&"★"]},e.id)),a.jsx("div",{className:"border-t my-1"}),(0,a.jsxs)(f.Ql,{value:"create_new",className:"text-cyan-600",children:[a.jsx(ej.Z,{className:"w-3 h-3 mr-1 inline"}),"Create new template..."]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[a.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"PDF Theme"}),(0,a.jsxs)($,{children:[a.jsx(L,{asChild:!0,children:a.jsx(eC,{className:"w-3 h-3 text-gray-400 cursor-help"})}),a.jsx(G,{children:a.jsx("p",{className:"text-xs max-w-48",children:"Controls colors/shading for BOQ pages (layout unchanged)"})})]})]}),(0,a.jsxs)(f.Ph,{value:v?.pdfThemeId||"default",onValueChange:e=>{if("create_new"===e){b.push("/app/settings?tab=pdf");return}e8({pdfThemeId:"default"===e?null:e})},children:[(0,a.jsxs)(f.i4,{className:"w-36 h-8 text-xs",children:[a.jsx(eP.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),a.jsx(f.ki,{placeholder:"Color Theme"})]}),(0,a.jsxs)(f.Bw,{children:[a.jsx(f.Ql,{value:"default",children:"Default Theme"}),P.map(e=>(0,a.jsxs)(f.Ql,{value:e.id,children:[e.name," ",e.isDefault&&"★"]},e.id)),a.jsx("div",{className:"border-t my-1"}),(0,a.jsxs)(f.Ql,{value:"create_new",className:"text-cyan-600",children:[a.jsx(ej.Z,{className:"w-3 h-3 mr-1 inline"}),"Create new theme..."]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[a.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Date"}),(0,a.jsxs)($,{children:[a.jsx(L,{asChild:!0,children:a.jsx(eC,{className:"w-3 h-3 text-gray-400 cursor-help"})}),a.jsx(G,{children:a.jsx("p",{className:"text-xs max-w-48",children:"Date shown on PDF cover page"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)(f.Ph,{value:v?.dateMode||"export_date",onValueChange:e=>{e8({dateMode:e})},children:[(0,a.jsxs)(f.i4,{className:"w-32 h-8 text-xs",children:[a.jsx(eT.Z,{className:"w-3 h-3 mr-1 text-gray-400"}),a.jsx(f.ki,{})]}),(0,a.jsxs)(f.Bw,{children:[a.jsx(f.Ql,{value:"export_date",children:"Export Date"}),a.jsx(f.Ql,{value:"preparation_date",children:"Custom Date"})]})]}),v?.dateMode==="preparation_date"&&a.jsx("input",{type:"date",value:v?.preparationDate?new Date(v.preparationDate).toISOString().split("T")[0]:"",onChange:e=>e8({preparationDate:e.target.value?new Date(e.target.value).toISOString():null}),className:"h-8 px-2 text-xs border rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]})]})}),(0,a.jsxs)(o.z,{variant:"outline",onClick:tv,disabled:V,children:[V?a.jsx(ew.Z,{className:"w-4 h-4 animate-spin mr-2"}):a.jsx(eE,{className:"w-4 h-4 mr-2"}),"Export PDF"]})]})]}),a.jsx("div",{className:"flex-1 overflow-auto p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(m.Zb,{className:"shadow-md border-0 bg-gradient-to-br from-cyan-50 to-teal-50",children:[a.jsx(m.Ol,{className:"pb-2",children:a.jsx(m.ll,{className:"text-lg",children:"Totals"})}),(0,a.jsxs)(m.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-1",children:[a.jsx("span",{className:"text-gray-600",children:"Subtotal"}),a.jsx("span",{className:"font-semibold",children:eK(eX.subtotal)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx(p._,{className:"text-gray-600",children:"Discount"}),a.jsx(x.r,{checked:v?.discountEnabled??!1,onCheckedChange:e=>e8({discountEnabled:e})})]}),v?.discountEnabled&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(f.Ph,{value:v?.discountType??"percent",onValueChange:e=>e8({discountType:e}),children:[a.jsx(f.i4,{className:"w-20 h-8",children:a.jsx(f.ki,{})}),(0,a.jsxs)(f.Bw,{children:[a.jsx(f.Ql,{value:"percent",children:"%"}),a.jsx(f.Ql,{value:"fixed",children:"Fixed"})]})]}),a.jsx(c.I,{type:"number",step:"0.01",value:v?.discountValue??0,onChange:e=>e8({discountValue:parseFloat(e.target.value)||0}),className:"w-24 h-8"}),eX.discount>0&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["-",eK(eX.discount)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx(p._,{className:"text-gray-600",children:"VAT"}),a.jsx(x.r,{checked:v?.vatEnabled??!1,onCheckedChange:e=>e8({vatEnabled:e})})]}),v?.vatEnabled&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(c.I,{type:"number",step:"0.01",value:v?.vatPercent??0,onChange:e=>e8({vatPercent:parseFloat(e.target.value)||0}),className:"w-20 h-8"}),a.jsx("span",{className:"text-gray-500",children:"%"}),(0,a.jsxs)("span",{className:"text-gray-500",children:["+",eK(eX.vatAmount)]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-t-2 border-cyan-200",children:[a.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Final Total"}),a.jsx("span",{className:"text-2xl font-bold text-cyan-600",children:eK(eX.finalTotal)})]})]})]}),(0,a.jsxs)(m.Zb,{className:"shadow-md border-0",children:[a.jsx(m.Ol,{className:"pb-2",children:a.jsx(m.ll,{className:"text-lg",children:"Profit Analysis"})}),(0,a.jsxs)(m.aY,{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-600",children:"Total Cost"}),a.jsx("span",{className:"font-medium",children:eK(eX.totalCost)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-600",children:"Price (after discount)"}),a.jsx("span",{className:"font-medium",children:eK(eX.priceAfterDiscount)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[a.jsx("span",{className:"text-gray-600",children:"Profit"}),a.jsx("span",{className:`font-semibold ${eX.profit>=0?"text-emerald-600":"text-red-600"}`,children:eK(eX.profit)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-600",children:"Gross Profit %"}),(0,a.jsxs)("span",{className:`font-semibold ${eX.grossProfitPct>=0?"text-emerald-600":"text-red-600"}`,children:[eH(eX.grossProfitPct),"%"]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{onClick:e5,className:"text-xs text-gray-500 hover:text-cyan-600 transition-colors",title:"Reset column widths to default",children:"Reset column widths"})}),a.jsx(eR.LB,{sensors:tc,collisionDetection:eR.pE,onDragStart:tm,onDragEnd:tp,modifiers:[eF.DL],children:a.jsx(eO.Fo,{items:tC,strategy:eO.qw,children:(v?.categories??[]).map((e,t)=>a.jsx(e$,{category:e,categoryIndex:t,isExpanded:E.has(e?.id),toggleCategory:tj,getCategoryName:te,handleUpdateCategory:e9,handleDeleteCategory:tt,handleAddItem:tr,formatCurrency:eK,getCategorySubtotal:tN,columnWidths:eg,handleResizeStart:e3,sensors:tc,getItemNumber:tw,handleItemDragStart:td,handleItemDragEnd:tu,getItemValue:ta,handleUpdateItem:ts,handleDeleteItem:tn,openEditItemDialog:tx,handleNoteClick:th,inlineEditingNoteId:es,inlineEditText:ei,setInlineEditText:el,inlineTextareaRef:eo,handleInlineNoteKeyDown:to,saveInlineEdit:tl,cancelInlineEdit:ti,sanitizeHtml:eB,formatNumber:eH,itemLimit:Q,currentItemCount:e2,isAtItemLimit:e1,planKey:K},e?.id))})}),(0,a.jsxs)(o.z,{variant:"outline",className:"w-full border-dashed border-2",onClick:e7,children:[a.jsx(ej.Z,{className:"w-4 h-4 mr-2"}),"Add Category"]})]})]})}),a.jsx(g.Vq,{open:R,onOpenChange:O,children:(0,a.jsxs)(g.cZ,{children:[a.jsx(g.fK,{children:a.jsx(g.$N,{children:"Add New Customer"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{htmlFor:"customerName",children:"Name"}),a.jsx(c.I,{id:"customerName",placeholder:"Customer name",value:F,onChange:e=>Z(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{htmlFor:"customerEmail",children:"Email (Optional)"}),a.jsx(c.I,{id:"customerEmail",type:"email",placeholder:"customer@email.com",value:z,onChange:e=>A(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{htmlFor:"customerPhone",children:"Phone (Optional)"}),a.jsx(c.I,{id:"customerPhone",placeholder:"Phone number",value:U,onChange:e=>B(e.target.value)})]})]}),(0,a.jsxs)(g.cN,{children:[a.jsx(o.z,{variant:"outline",onClick:()=>O(!1),children:"Cancel"}),a.jsx(o.z,{onClick:tb,children:"Add Customer"})]})]})}),a.jsx(g.Vq,{open:!!W,onOpenChange:e=>!e&&Y(null),children:(0,a.jsxs)(g.cZ,{className:"max-w-2xl",children:[(0,a.jsxs)(g.fK,{children:[a.jsx(g.$N,{children:W?.item.isNote?"Edit Note":`Edit Item ${W?.itemNumber??""}`}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Category: ",W?.categoryName]})]}),a.jsx("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto",children:W?.item.isNote?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{children:"Note Content"}),(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1 p-2 border-b bg-gray-50",children:[a.jsx(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0 font-bold",onMouseDown:e=>{e.preventDefault(),tg("bold")},title:"Bold (Ctrl+B)",children:a.jsx(e_.Z,{className:"w-4 h-4"})}),a.jsx(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onMouseDown:e=>{e.preventDefault(),tg("italic")},title:"Italic (Ctrl+I)",children:a.jsx(eD.Z,{className:"w-4 h-4"})}),a.jsx(o.z,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onMouseDown:e=>{e.preventDefault(),tg("underline")},title:"Underline (Ctrl+U)",children:a.jsx(eS.Z,{className:"w-4 h-4"})}),a.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"Select text and click to format (or use Ctrl+B/I/U)"})]}),a.jsx("div",{ref:er,contentEditable:!0,suppressContentEditableWarning:!0,className:"min-h-[150px] p-3 focus:outline-none text-sm prose prose-sm max-w-none [&_strong]:font-bold [&_b]:font-bold [&_em]:italic [&_i]:italic [&_u]:underline",onInput:e=>{let t=e.currentTarget;et(e=>({...e,noteContent:t.innerHTML}))},onKeyDown:ty})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(h.X,{id:"edit-includeInPdf",checked:ee.includeInPdf??!0,onCheckedChange:e=>et(t=>({...t,includeInPdf:e}))}),a.jsx("label",{htmlFor:"edit-includeInPdf",className:"text-sm text-gray-600",children:"Include in PDF"})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{htmlFor:"edit-description",children:"Description"}),a.jsx(u,{id:"edit-description",placeholder:"Enter item description...",value:ee.description??"",onChange:e=>et(t=>({...t,description:e.target.value})),className:"min-h-[100px]"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{htmlFor:"edit-unit",children:"Unit"}),a.jsx(c.I,{id:"edit-unit",placeholder:"e.g., Sqm, Cub, Nos",value:ee.unit??"",onChange:e=>et(t=>({...t,unit:e.target.value}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{htmlFor:"edit-unitCost",children:"Unit Cost"}),a.jsx(c.I,{id:"edit-unitCost",type:"number",step:"0.01",value:ee.unitCost??0,onChange:e=>et(t=>({...t,unitCost:parseFloat(e.target.value)||0}))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{htmlFor:"edit-markupPct",children:"Markup %"}),a.jsx(c.I,{id:"edit-markupPct",type:"number",step:"0.01",value:ee.markupPct??0,onChange:e=>et(t=>({...t,markupPct:parseFloat(e.target.value)||0}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(p._,{htmlFor:"edit-quantity",children:"Quantity"}),a.jsx(c.I,{id:"edit-quantity",type:"number",step:"0.01",value:ee.quantity??0,onChange:e=>et(t=>({...t,quantity:parseFloat(e.target.value)||0}))})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Unit Price:"}),a.jsx("span",{className:"font-medium",children:eK((ee.unitCost??0)*(1+(ee.markupPct??0)/100))})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Amount:"}),a.jsx("span",{className:"font-semibold text-cyan-600",children:eK((ee.unitCost??0)*(1+(ee.markupPct??0)/100)*(ee.quantity??0))})]})]})]})}),(0,a.jsxs)(g.cN,{children:[a.jsx(o.z,{variant:"outline",onClick:()=>Y(null),children:"Cancel"}),a.jsx(o.z,{onClick:tf,children:"Save Changes"})]})]})})]})})}},84377:(e,t,r)=>{"use strict";r.d(t,{r:()=>l});var a=r(62901),s=r(24383),n=r(59094),i=r(68637);let l=s.forwardRef(({className:e,...t},r)=>a.jsx(n.fC,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-all duration-200","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-gradient-to-r data-[state=checked]:from-purple-500 data-[state=checked]:to-lavender-500","data-[state=unchecked]:bg-purple-200",e),...t,ref:r,children:a.jsx(n.bU,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-white shadow-md ring-0 transition-transform duration-200","data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));l.displayName=n.fC.displayName},75909:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});let a=(0,r(71945).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},71028:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});let a=(0,r(71945).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},28405:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u,dynamic:()=>d});var a=r(83537),s=r(57978),n=r(86023),i=r(15438),l=r(83178);let o=(0,r(88895).createProxy)(String.raw`/home/ubuntu/make_estimate/nextjs_space/app/app/boq/[id]/_components/boq-editor-client.tsx#BoqEditorClient`);var c=r(90391);let d="force-dynamic";async function u({params:e}){let t=await (0,s.getServerSession)(n.L);t?.user||(0,i.redirect)("/login");let r=t.user?.companyId;r||(0,i.redirect)("/login"),(await (0,c.qf)(r)).hasActiveSubscription||(0,i.redirect)("/pricing?subscription=required");let[d,u,m,p,x]=await Promise.all([l._.boq.findFirst({where:{id:e?.id,companyId:r},include:{customer:!0,coverTemplate:!0,pdfTheme:!0,categories:{include:{items:{orderBy:{sortOrder:"asc"}}},orderBy:{sortOrder:"asc"}}}}),l._.customer.findMany({where:{companyId:r},orderBy:{name:"asc"}}),l._.company.findUnique({where:{id:r}}),l._.pdfCoverTemplate.findMany({where:{companyId:r},orderBy:[{isDefault:"desc"},{name:"asc"}]}),l._.pdfTheme.findMany({where:{companyId:r},orderBy:[{isDefault:"desc"},{name:"asc"}]})]);return d||(0,i.redirect)("/app/dashboard"),a.jsx(o,{boq:JSON.parse(JSON.stringify(d)),customers:JSON.parse(JSON.stringify(u??[])),company:JSON.parse(JSON.stringify(m??{})),coverTemplates:JSON.parse(JSON.stringify(p??[])),pdfThemes:JSON.parse(JSON.stringify(x??[]))})}},15438:(e,t,r)=>{"use strict";var a=r(34513);r.o(a,"redirect")&&r.d(t,{redirect:function(){return a.redirect}})},34513:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyURLSearchParams:function(){return i},RedirectType:function(){return a.RedirectType},notFound:function(){return s.notFound},permanentRedirect:function(){return a.permanentRedirect},redirect:function(){return a.redirect}});let a=r(69138),s=r(18403);class n extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class i extends URLSearchParams{append(){throw new n}delete(){throw new n}set(){throw new n}sort(){throw new n}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},18403:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isNotFoundError:function(){return s},notFound:function(){return a}});let r="NEXT_NOT_FOUND";function a(){let e=Error(r);throw e.digest=r,e}function s(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},34769:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}}),function(e){e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect"}(r||(r={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},69138:(e,t,r)=>{"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RedirectType:function(){return a},getRedirectError:function(){return o},getRedirectStatusCodeFromError:function(){return x},getRedirectTypeFromError:function(){return p},getURLFromRedirectError:function(){return m},isRedirectError:function(){return u},permanentRedirect:function(){return d},redirect:function(){return c}});let s=r(54580),n=r(72934),i=r(34769),l="NEXT_REDIRECT";function o(e,t,r){void 0===r&&(r=i.RedirectStatusCode.TemporaryRedirect);let a=Error(l);a.digest=l+";"+t+";"+e+";"+r+";";let n=s.requestAsyncStorage.getStore();return n&&(a.mutableCookies=n.mutableCookies),a}function c(e,t){void 0===t&&(t="replace");let r=n.actionAsyncStorage.getStore();throw o(e,t,(null==r?void 0:r.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.TemporaryRedirect)}function d(e,t){void 0===t&&(t="replace");let r=n.actionAsyncStorage.getStore();throw o(e,t,(null==r?void 0:r.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.PermanentRedirect)}function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r,a,s]=e.digest.split(";",4),n=Number(s);return t===l&&("replace"===r||"push"===r)&&"string"==typeof a&&!isNaN(n)&&n in i.RedirectStatusCode}function m(e){return u(e)?e.digest.split(";",3)[2]:null}function p(e){if(!u(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function x(e){if(!u(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(function(e){e.push="push",e.replace="replace"})(a||(a={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4372,7329,5990,5410,1263,2392,4866,5083,7463,1108,391,9845,4297],()=>r(24006));module.exports=a})();