(()=>{var e={};e.id=7378,e.ids=[7378],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},85274:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d}),a(53218),a(87369),a(71363);var t=a(36576),r=a(72007),l=a(21818),n=a.n(l),i=a(88897),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);a.d(s,o);let d=["",{children:["app",{children:["settings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,53218)),"/home/ubuntu/make_estimate/nextjs_space/app/app/settings/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,87369)),"/home/ubuntu/make_estimate/nextjs_space/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,71363,23)),"next/dist/client/components/not-found-error"]}],c=["/home/ubuntu/make_estimate/nextjs_space/app/app/settings/page.tsx"],m="/app/settings/page",x={require:a,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/app/settings/page",pathname:"/app/settings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},97731:(e,s,a)=>{Promise.resolve().then(a.bind(a,18175))},18175:(e,s,a)=>{"use strict";a.d(s,{SettingsClient:()=>eo});var t=a(62901),r=a(24383),l=a(84374),n=a(22270),i=a(27878),o=a(250),d=a(23803),c=a(82657),m=a(72388),x=a(84227),p=a(1320),h=a(32317),u=a(76244),g=a(79357),f=a(71945);let y=(0,f.Z)("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);var j=a(10333);let b=(0,f.Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var N=a(35797),v=a(39350),w=a(84377),C=a(65923);let k=(0,f.Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var S=a(42594),P=a(6e4),T=a(71028),Z=a(40422),_=a(52256),z=a(14726);let E=(0,f.Z)("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]),R=(0,f.Z)("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]),B=(0,f.Z)("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);var D=a(97718),$=a(85453),O=a(53275),F=a(91334),U=a(88846),M=a(7409),I=a(12174),q=a(89280);let L={project_name:"Project Name",subtitle:"Subtitle",prepared_for:"Prepared For",company_name:"Company Name",logo:"Logo",date:"Date",prepared_by:"Prepared By",custom_text:"Custom Text"},A={fontSize:16,fontWeight:"normal",italic:!1,underline:!1,color:"#333333",align:"center",marginTop:10,marginBottom:10},Q=()=>({page:{backgroundColor:"#ffffff",padding:40,defaultFontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"},elements:[{id:"project_name",type:"project_name",enabled:!0,style:{...A,fontSize:36,fontWeight:"bold",color:"#0891b2",marginBottom:20}},{id:"subtitle",type:"subtitle",enabled:!0,text:"Bill of Quantities",style:{...A,fontSize:18,color:"#666666",marginBottom:10}},{id:"prepared_for",type:"prepared_for",enabled:!0,style:{...A,fontSize:18,color:"#666666",marginBottom:40}},{id:"company_name",type:"company_name",enabled:!0,style:{...A,fontSize:16,color:"#333333"}}]});function V({element:e,onUpdate:s,logoUploadAllowed:a=!0}){let l=(0,r.useRef)(null),[n,d]=(0,r.useState)(!1),m=async a=>{let t=a.target.files?.[0];if(t){if(!["image/png","image/jpeg","image/jpg","image/webp","image/svg+xml"].includes(t.type)){v.ZP.error("Invalid file type. Please use PNG, JPG, WEBP or SVG.");return}if(t.size>5242880){v.ZP.error("File too large. Max 5MB allowed.");return}d(!0);try{let a=await fetch("/api/upload/presigned",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:t.name,contentType:t.type,isPublic:!0})});if(!a.ok)throw Error("Failed to get upload URL");let{uploadUrl:r,cloud_storage_path:l}=await a.json(),n=r.match(/X-Amz-SignedHeaders=([^&]+)/),i=(n?decodeURIComponent(n[1]).split(";"):[]).includes("content-disposition"),o={"Content-Type":t.type};if(i&&(o["Content-Disposition"]="attachment"),!(await fetch(r,{method:"PUT",headers:o,body:t})).ok)throw Error("Failed to upload file");let d=new URL(r),c=`${d.protocol}//${d.host}/${l}`;s({logoUrl:c,logoWidth:e.logoWidth||200,logoMaxWidthPercent:e.logoMaxWidthPercent||50}),v.ZP.success("Logo uploaded successfully")}catch(e){console.error("Upload error:",e),v.ZP.error("Failed to upload logo")}finally{d(!1),l.current&&(l.current.value="")}}};return(0,t.jsxs)("div",{className:"space-y-3",children:[!a&&(0,t.jsxs)("div",{className:"text-xs text-amber-600 bg-amber-50 px-3 py-2 rounded-md border border-amber-200",children:["Logo upload is not available on your current plan.",t.jsx("a",{href:"/pricing",className:"ml-1 underline hover:text-amber-700",children:"Upgrade"})," to upload a custom logo."]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[e.logoUrl?t.jsx("div",{className:"flex-shrink-0 border rounded-lg p-2 bg-gray-50",children:t.jsx("img",{src:e.logoUrl,alt:"Logo preview",style:{maxWidth:`${e.logoWidth||200}px`,height:"auto"},className:"max-h-20 object-contain"})}):t.jsx("div",{className:"flex-shrink-0 w-20 h-20 border-2 border-dashed rounded-lg flex items-center justify-center bg-gray-50",children:t.jsx(k,{className:"w-6 h-6 text-gray-400"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[t.jsx("input",{ref:l,type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp,image/svg+xml",onChange:m,className:"hidden",disabled:!a}),(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx(i.z,{variant:"outline",size:"sm",onClick:()=>l.current?.click(),disabled:n||!a,title:a?void 0:"Upgrade to upload a custom logo",children:n?(0,t.jsxs)(t.Fragment,{children:[t.jsx(j.Z,{className:"w-4 h-4 animate-spin mr-1"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(k,{className:"w-4 h-4 mr-1"}),e.logoUrl?"Change":"Upload"," Logo"]})}),e.logoUrl&&(0,t.jsxs)(i.z,{variant:"ghost",size:"sm",onClick:()=>{s({logoUrl:void 0,logoWidth:void 0,logoMaxWidthPercent:void 0})},className:"text-red-500 hover:text-red-700",children:[t.jsx(S.Z,{className:"w-4 h-4 mr-1"}),"Remove"]})]}),t.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, WEBP or SVG (max 5MB)"})]})]}),e.logoUrl&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(c._,{className:"text-xs text-gray-500",children:"Width (px):"}),t.jsx(o.I,{type:"number",min:"50",max:"600",value:e.logoWidth||200,onChange:e=>s({logoWidth:parseInt(e.target.value)||200}),className:"h-7 w-20 text-xs"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(c._,{className:"text-xs text-gray-500",children:"Max width (%):"}),t.jsx(o.I,{type:"number",min:"10",max:"100",value:e.logoMaxWidthPercent||50,onChange:e=>s({logoMaxWidthPercent:parseInt(e.target.value)||50}),className:"h-7 w-16 text-xs"}),t.jsx("span",{className:"text-xs text-gray-400",children:"of page"})]})]})]})}function W({element:e,onUpdate:s,onDelete:a,logoUploadAllowed:r=!0}){let{attributes:l,listeners:n,setNodeRef:d,setActivatorNodeRef:x,transform:p,transition:h,isDragging:u}=(0,M.nB)({id:e.id}),g={transform:I.ux.Transform.toString(p),transition:h},f=a=>{s(e.id,{style:{...e.style,...a}})};return t.jsx("div",{ref:d,style:g,...l,className:`border rounded-lg p-4 bg-white ${u?"opacity-50 shadow-lg z-50":""}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[t.jsx("div",{ref:x,...n,className:"cursor-grab active:cursor-grabbing p-1 hover:bg-gray-100 rounded mt-1",style:{touchAction:"none"},children:t.jsx(P.Z,{className:"w-4 h-4 text-gray-400"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"font-medium text-sm",children:L[e.type]}),t.jsx(w.r,{checked:e.enabled,onCheckedChange:a=>s(e.id,{enabled:a})})]}),t.jsx(i.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-red-500",onClick:()=>a(e.id),title:"Delete element",children:t.jsx(T.Z,{className:"w-4 h-4"})})]}),e.enabled&&(0,t.jsxs)(t.Fragment,{children:[("custom_text"===e.type||"subtitle"===e.type||"prepared_by"===e.type)&&t.jsx(o.I,{value:e.text||"",onChange:a=>s(e.id,{text:a.target.value}),placeholder:"prepared_by"===e.type?"Prepared by: [Name]":"Enter text...",className:"h-8 text-sm"}),"date"===e.type&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(m.Ph,{value:e.dateMode||"today",onValueChange:a=>s(e.id,{dateMode:a}),children:[t.jsx(m.i4,{className:"w-32 h-8",children:t.jsx(m.ki,{})}),(0,t.jsxs)(m.Bw,{children:[t.jsx(m.Ql,{value:"today",children:"Current Date"}),t.jsx(m.Ql,{value:"custom",children:"Custom Date"})]})]}),"custom"===e.dateMode&&t.jsx(o.I,{type:"date",value:e.customDate||"",onChange:a=>s(e.id,{customDate:a.target.value}),className:"h-8 text-sm w-40"})]}),"logo"===e.type&&t.jsx(V,{element:e,onUpdate:a=>s(e.id,a),logoUploadAllowed:r}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx(c._,{className:"text-xs text-gray-500",children:"Size:"}),t.jsx(o.I,{type:"number",min:"8",max:"72",value:e.style.fontSize,onChange:e=>f({fontSize:parseInt(e.target.value)||16}),className:"h-7 w-16 text-xs"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx(c._,{className:"text-xs text-gray-500",children:"Color:"}),t.jsx("input",{type:"color",value:e.style.color,onChange:e=>f({color:e.target.value}),className:"w-7 h-7 rounded border cursor-pointer"})]}),(0,t.jsxs)("div",{className:"flex items-center border rounded",children:[t.jsx(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none ${"bold"===e.style.fontWeight?"bg-gray-200":""}`,onClick:()=>f({fontWeight:"bold"===e.style.fontWeight?"normal":"bold"}),children:t.jsx(Z.Z,{className:"w-3 h-3"})}),t.jsx(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none border-l ${e.style.italic?"bg-gray-200":""}`,onClick:()=>f({italic:!e.style.italic}),children:t.jsx(_.Z,{className:"w-3 h-3"})}),t.jsx(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none border-l ${e.style.underline?"bg-gray-200":""}`,onClick:()=>f({underline:!e.style.underline}),children:t.jsx(z.Z,{className:"w-3 h-3"})})]}),(0,t.jsxs)("div",{className:"flex items-center border rounded",children:[t.jsx(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none ${"left"===e.style.align?"bg-gray-200":""}`,onClick:()=>f({align:"left"}),children:t.jsx(E,{className:"w-3 h-3"})}),t.jsx(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none border-l ${"center"===e.style.align?"bg-gray-200":""}`,onClick:()=>f({align:"center"}),children:t.jsx(R,{className:"w-3 h-3"})}),t.jsx(i.z,{variant:"ghost",size:"icon",className:`h-7 w-7 rounded-none border-l ${"right"===e.style.align?"bg-gray-200":""}`,onClick:()=>f({align:"right"}),children:t.jsx(B,{className:"w-3 h-3"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx(c._,{className:"text-xs text-gray-500",children:"Top:"}),t.jsx(o.I,{type:"number",min:"0",max:"200",value:e.style.marginTop,onChange:e=>f({marginTop:parseInt(e.target.value)||0}),className:"h-7 w-14 text-xs"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx(c._,{className:"text-xs text-gray-500",children:"Bottom:"}),t.jsx(o.I,{type:"number",min:"0",max:"200",value:e.style.marginBottom,onChange:e=>f({marginBottom:parseInt(e.target.value)||0}),className:"h-7 w-14 text-xs"})]})]})]})]})]})})}function H({config:e,projectName:s,customerName:a,companyName:r}){return t.jsx("div",{className:"border rounded-lg overflow-hidden shadow-sm",style:{backgroundColor:e.page.backgroundColor||"#ffffff",fontFamily:e.page.defaultFontFamily||"'Segoe UI', sans-serif",aspectRatio:"210 / 297",maxHeight:"500px"},children:t.jsx("div",{style:{padding:`${e.page.padding||40}px`,height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:e.elements.map(e=>{if(!e.enabled)return null;let l={fontSize:`${e.style.fontSize}px`,fontWeight:e.style.fontWeight,fontStyle:e.style.italic?"italic":"normal",textDecoration:e.style.underline?"underline":"none",color:e.style.color,textAlign:e.style.align,marginTop:`${e.style.marginTop}px`,marginBottom:`${e.style.marginBottom}px`},n="";switch(e.type){case"project_name":n=s||"Project Name";break;case"subtitle":n=e.text||"Bill of Quantities";break;case"prepared_for":n=a?`Prepared for: ${a}`:"Prepared for: [Customer Name]";break;case"company_name":n=r||"Company Name";break;case"logo":if(e.logoUrl){let s=e.logoWidth||200,a=e.logoMaxWidthPercent?`${e.logoMaxWidthPercent}%`:`${s}px`;return t.jsx("div",{style:{...l,display:"flex",justifyContent:e.style.align},children:t.jsx("img",{src:e.logoUrl,alt:"Logo",style:{width:`${s}px`,maxWidth:a,height:"auto"}})},e.id)}return t.jsx("div",{style:l,className:"text-gray-400",children:"[Logo]"},e.id);case"date":n="custom"===e.dateMode&&e.customDate?new Date(e.customDate).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"}):new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"});break;case"prepared_by":n=e.text||"Prepared by: [Name]";break;case"custom_text":n=e.text||"[Custom Text]"}return t.jsx("div",{style:l,children:n},e.id)})})})}function G({companyName:e}){let[s,a]=(0,r.useState)([]),[l,n]=(0,r.useState)(!0),[x,p]=(0,r.useState)(!1),[u,g]=(0,r.useState)(null),[f,y]=(0,r.useState)(null),[b,N]=(0,r.useState)(""),[w,k]=(0,r.useState)(!1),[S,P]=(0,r.useState)(!0),Z=(0,U.Dy)((0,U.VT)(U.we,{activationConstraint:{distance:5}}),(0,U.VT)(U.Lg,{coordinateGetter:M.is})),_=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/cover-templates");if(e.ok){let s=await e.json();a(s)}}catch(e){console.error("Error fetching templates:",e)}finally{n(!1)}},[]);(0,r.useCallback)(async()=>{try{let e=await fetch("/api/billing/status");if(e.ok){let s=await e.json();P(s.logoUploadAllowed??!0)}}catch(e){console.error("Error fetching billing status:",e)}},[]);let z=()=>{g(null),N("New Cover Template"),y(Q()),k(!0)},E=e=>{g(e),N(e.name),y(e.configJson),k(!0)},R=async()=>{if(!f||!b.trim()){v.ZP.error("Please enter a template name");return}p(!0);try{let e=u?`/api/cover-templates/${u.id}`:"/api/cover-templates";if(!(await fetch(e,{method:u?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b,configJson:f,isDefault:0===s.length})})).ok)throw Error("Failed to save template");v.ZP.success(u?"Template updated":"Template created"),k(!1),_()}catch(e){v.ZP.error("Failed to save template")}finally{p(!1)}},B=async e=>{if(confirm("Are you sure you want to delete this template?"))try{let s=await fetch(`/api/cover-templates/${e}`,{method:"DELETE"});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to delete")}v.ZP.success("Template deleted"),_()}catch(e){v.ZP.error(e.message||"Failed to delete template")}},I=async e=>{try{if(!(await fetch(`/api/cover-templates/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isDefault:!0})})).ok)throw Error("Failed to set default");v.ZP.success("Default template updated"),_()}catch(e){v.ZP.error("Failed to set default template")}},L=(e,s)=>{f&&y({...f,elements:f.elements.map(a=>a.id===e?{...a,...s}:a)})},V=e=>{f&&y({...f,elements:f.elements.filter(s=>s.id!==e)})},G=e=>{let s;if(!f)return;let a={...A};switch(e){case"project_name":a={...A,fontSize:36,fontWeight:"bold",color:"#0891b2",marginBottom:20};break;case"subtitle":s="Bill of Quantities",a={...A,fontSize:18,color:"#666666",marginBottom:10};break;case"prepared_for":a={...A,fontSize:18,color:"#666666",marginBottom:40};break;case"company_name":a={...A,fontSize:16,color:"#333333"};break;case"prepared_by":s="Prepared by: [Name]";break;case"custom_text":s="Custom text here"}let t={id:`${e}_${Date.now()}`,type:e,enabled:!0,text:s,dateMode:"date"===e?"today":void 0,style:a};y({...f,elements:[...f.elements,t]})};return l?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(j.Z,{className:"w-6 h-6 animate-spin text-cyan-600"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-lg font-medium",children:"PDF Cover Templates"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Customize the cover page for your BOQ PDFs"})]}),(0,t.jsxs)(i.z,{onClick:z,children:[t.jsx(D.Z,{className:"w-4 h-4 mr-2"}),"New Template"]})]}),0===s.length?(0,t.jsxs)(d.Zb,{className:"p-8 text-center",children:[t.jsx(h.Z,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"No templates yet"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first cover template to customize your PDF exports"}),(0,t.jsxs)(i.z,{onClick:z,children:[t.jsx(D.Z,{className:"w-4 h-4 mr-2"}),"Create Template"]})]}):t.jsx("div",{className:"grid gap-4",children:s.map(e=>t.jsx(d.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx(h.Z,{className:"w-5 h-5 text-cyan-600"}),(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"font-medium",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[e.isDefault&&(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-cyan-100 text-cyan-800 mr-2",children:[t.jsx($.Z,{className:"w-3 h-3 mr-1"}),"Default"]}),"Updated ",new Date(e.updatedAt).toLocaleDateString()]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isDefault&&t.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>I(e.id),children:"Set Default"}),t.jsx(i.z,{variant:"ghost",size:"icon",onClick:()=>E(e),children:t.jsx(O.Z,{className:"w-4 h-4"})}),t.jsx(i.z,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700",onClick:()=>B(e.id),children:t.jsx(T.Z,{className:"w-4 h-4"})})]})]})},e.id))}),t.jsx(C.Vq,{open:w,onOpenChange:k,children:(0,t.jsxs)(C.cZ,{className:"max-w-6xl h-[90vh] flex flex-col p-0",children:[t.jsx(C.fK,{className:"px-6 py-4 border-b flex-shrink-0",children:t.jsx(C.$N,{children:u?"Edit Template":"New Template"})}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 flex",children:[t.jsx("div",{className:"w-1/2 flex flex-col min-h-0",children:(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Template Name"}),t.jsx(o.I,{value:b,onChange:e=>N(e.target.value),placeholder:"Enter template name"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Page Background Color"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"color",value:f?.page.backgroundColor||"#ffffff",onChange:e=>f&&y({...f,page:{...f.page,backgroundColor:e.target.value}}),className:"w-10 h-10 rounded border cursor-pointer"}),t.jsx(o.I,{value:f?.page.backgroundColor||"#ffffff",onChange:e=>f&&y({...f,page:{...f.page,backgroundColor:e.target.value}}),className:"w-28"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx(c._,{children:"Elements"}),(0,t.jsxs)(m.Ph,{onValueChange:e=>G(e),children:[(0,t.jsxs)(m.i4,{className:"w-40 h-8",children:[t.jsx(D.Z,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"text-sm",children:"Add Element"})]}),(0,t.jsxs)(m.Bw,{children:[t.jsx(m.Ql,{value:"project_name",children:"Project Name"}),t.jsx(m.Ql,{value:"subtitle",children:"Subtitle"}),t.jsx(m.Ql,{value:"prepared_for",children:"Prepared For"}),t.jsx(m.Ql,{value:"company_name",children:"Company Name"}),t.jsx(m.Ql,{value:"logo",children:"Logo"}),t.jsx(m.Ql,{value:"date",children:"Date"}),t.jsx(m.Ql,{value:"prepared_by",children:"Prepared By"}),t.jsx(m.Ql,{value:"custom_text",children:"Custom Text"})]})]})]}),f&&t.jsx(U.LB,{sensors:Z,collisionDetection:U.pE,onDragEnd:e=>{let{active:s,over:a}=e;if(!a||s.id===a.id||!f)return;let t=f.elements.findIndex(e=>e.id===s.id),r=f.elements.findIndex(e=>e.id===a.id);y({...f,elements:(0,M.Rp)(f.elements,t,r)})},modifiers:[q.DL],children:t.jsx(M.Fo,{items:f.elements.map(e=>e.id),strategy:M.qw,children:t.jsx("div",{className:"space-y-2",children:f.elements.map(e=>t.jsx(W,{element:e,onUpdate:L,onDelete:V,logoUploadAllowed:S},e.id))})})})]})]})}),(0,t.jsxs)("div",{className:"w-1/2 border-l flex flex-col min-h-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-3 border-b flex-shrink-0",children:[t.jsx(c._,{children:"Live Preview"}),t.jsx(F.Z,{className:"w-4 h-4 text-gray-400"})]}),t.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:f&&t.jsx(H,{config:f,projectName:"Sample Project Name",customerName:"Mr. John Doe",companyName:e})})]})]}),(0,t.jsxs)(C.cN,{className:"px-6 py-4 border-t flex-shrink-0",children:[t.jsx(i.z,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),t.jsx(i.z,{onClick:R,disabled:x,children:x?(0,t.jsxs)(t.Fragment,{children:[t.jsx(j.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Saving..."]}):"Save Template"})]})]})})]})}let J=()=>({header:{borderColor:"#0891b2",titleColor:"#0891b2",subtitleColor:"#666666"},categoryHeader:{backgroundPrimary:"#0891b2",backgroundSecondary:"#14b8a6",textColor:"#ffffff"},table:{headerBackground:"#f9fafb",headerTextColor:"#6b7280",borderColor:"#e5e7eb",bodyTextColor:"#333333"},subtotalRow:{background:"#f0fdfa",borderColor:"#14b8a6",textColor:"#333333"},noteRow:{background:"#fffbeb",textColor:"#92400e"},totals:{finalTotalBackground:"#0891b2",finalTotalTextColor:"#ffffff"}});function Y({label:e,value:s,onChange:a}){return(0,t.jsxs)("div",{className:"flex items-center justify-between py-2",children:[t.jsx("span",{className:"text-sm text-gray-600",children:e}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"color",value:s,onChange:e=>a(e.target.value),className:"w-8 h-8 rounded border cursor-pointer"}),t.jsx(o.I,{value:s,onChange:e=>a(e.target.value),className:"w-24 h-8 text-xs font-mono"})]})]})}function K({config:e}){return(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden bg-white shadow-sm",children:[(0,t.jsxs)("div",{className:"p-3",style:{borderBottom:`2px solid ${e.header.borderColor}`},children:[t.jsx("div",{className:"text-base font-bold",style:{color:e.header.titleColor},children:"Sample Project Name"}),t.jsx("div",{className:"text-xs",style:{color:e.header.subtitleColor},children:"Customer: John Doe"})]}),(0,t.jsxs)("div",{className:"p-3",children:[t.jsx("div",{className:"px-2 py-1 rounded-t text-xs font-bold",style:{background:`linear-gradient(135deg, ${e.categoryHeader.backgroundPrimary}, ${e.categoryHeader.backgroundSecondary})`,color:e.categoryHeader.textColor},children:"1. Sample Category"}),(0,t.jsxs)("table",{className:"w-full text-xs",style:{borderCollapse:"collapse"},children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{children:[t.jsx("th",{className:"px-2 py-1 text-left font-semibold text-[10px] uppercase",style:{backgroundColor:e.table.headerBackground,color:e.table.headerTextColor,border:`1px solid ${e.table.borderColor}`},children:"Item"}),t.jsx("th",{className:"px-2 py-1 text-left font-semibold text-[10px] uppercase",style:{backgroundColor:e.table.headerBackground,color:e.table.headerTextColor,border:`1px solid ${e.table.borderColor}`},children:"Description"}),t.jsx("th",{className:"px-2 py-1 text-right font-semibold text-[10px] uppercase",style:{backgroundColor:e.table.headerBackground,color:e.table.headerTextColor,border:`1px solid ${e.table.borderColor}`},children:"Amount"})]})}),(0,t.jsxs)("tbody",{children:[(0,t.jsxs)("tr",{children:[t.jsx("td",{className:"px-2 py-1",style:{border:`1px solid ${e.table.borderColor}`,color:e.table.bodyTextColor},children:"1.1"}),t.jsx("td",{className:"px-2 py-1",style:{border:`1px solid ${e.table.borderColor}`,color:e.table.bodyTextColor},children:"Sample item description"}),t.jsx("td",{className:"px-2 py-1 text-right",style:{border:`1px solid ${e.table.borderColor}`,color:e.table.bodyTextColor},children:"1,000.00"})]}),(0,t.jsxs)("tr",{style:{backgroundColor:e.noteRow.background},children:[t.jsx("td",{className:"px-2 py-1",style:{border:`1px solid ${e.table.borderColor}`}}),t.jsx("td",{colSpan:2,className:"px-2 py-1 italic",style:{border:`1px solid ${e.table.borderColor}`,color:e.noteRow.textColor},children:"This is a sample note"})]}),(0,t.jsxs)("tr",{style:{backgroundColor:e.subtotalRow.background,color:e.subtotalRow.textColor},children:[t.jsx("td",{colSpan:2,className:"px-2 py-1 text-right font-bold",style:{borderTop:`2px solid ${e.subtotalRow.borderColor}`,border:`1px solid ${e.table.borderColor}`},children:"Subtotal"}),t.jsx("td",{className:"px-2 py-1 text-right font-bold",style:{borderTop:`2px solid ${e.subtotalRow.borderColor}`,border:`1px solid ${e.table.borderColor}`},children:"Rs. 1,000.00"})]})]})]}),t.jsx("div",{className:"mt-3 flex justify-end",children:t.jsx("div",{className:"px-3 py-2 rounded text-sm font-bold",style:{backgroundColor:e.totals.finalTotalBackground,color:e.totals.finalTotalTextColor},children:"Final Total: Rs. 1,180.00"})})]})]})}function X({companyName:e}){let[s,a]=(0,r.useState)([]),[l,n]=(0,r.useState)(!0),[m,x]=(0,r.useState)(!1),[p,h]=(0,r.useState)(null),[u,g]=(0,r.useState)(null),[f,y]=(0,r.useState)(""),[b,w]=(0,r.useState)(!1),k=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/pdf-themes");if(e.ok){let s=await e.json();a(s)}}catch(e){console.error("Error fetching themes:",e)}finally{n(!1)}},[]),S=()=>{h(null),y("New Theme"),g(J()),w(!0)},P=e=>{h(e),y(e.name),g(e.configJson),w(!0)},Z=async()=>{if(!u||!f.trim()){v.ZP.error("Please enter a theme name");return}x(!0);try{let e=p?`/api/pdf-themes/${p.id}`:"/api/pdf-themes";if(!(await fetch(e,{method:p?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f,configJson:u,isDefault:0===s.length})})).ok)throw Error("Failed to save theme");v.ZP.success(p?"Theme updated":"Theme created"),w(!1),k()}catch(e){v.ZP.error("Failed to save theme")}finally{x(!1)}},_=async e=>{if(confirm("Are you sure you want to delete this theme?"))try{let s=await fetch(`/api/pdf-themes/${e}`,{method:"DELETE"});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to delete")}v.ZP.success("Theme deleted"),k()}catch(e){v.ZP.error(e.message||"Failed to delete theme")}},z=async e=>{try{if(!(await fetch(`/api/pdf-themes/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isDefault:!0})})).ok)throw Error("Failed to set default");v.ZP.success("Default theme updated"),k()}catch(e){v.ZP.error("Failed to set default theme")}},E=(e,s)=>{if(!u)return;let a=JSON.parse(JSON.stringify(u)),t=a;for(let s=0;s<e.length-1;s++)t=t[e[s]];t[e[e.length-1]]=s,g(a)};return l?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(j.Z,{className:"w-6 h-6 animate-spin text-cyan-600"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-lg font-medium",children:"PDF Color Themes"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Customize colors and shading for BOQ pages"})]}),(0,t.jsxs)(i.z,{onClick:S,children:[t.jsx(D.Z,{className:"w-4 h-4 mr-2"}),"New Theme"]})]}),0===s.length?(0,t.jsxs)(d.Zb,{className:"p-8 text-center",children:[t.jsx(N.Z,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"No themes yet"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first color theme to customize your PDF exports"}),(0,t.jsxs)(i.z,{onClick:S,children:[t.jsx(D.Z,{className:"w-4 h-4 mr-2"}),"Create Theme"]})]}):t.jsx("div",{className:"grid gap-4",children:s.map(e=>t.jsx(d.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx(N.Z,{className:"w-5 h-5 text-cyan-600"}),(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"font-medium",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[e.isDefault&&(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-cyan-100 text-cyan-800 mr-2",children:[t.jsx($.Z,{className:"w-3 h-3 mr-1"}),"Default"]}),"Updated ",new Date(e.updatedAt).toLocaleDateString()]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isDefault&&t.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>z(e.id),children:"Set Default"}),t.jsx(i.z,{variant:"ghost",size:"icon",onClick:()=>P(e),children:t.jsx(O.Z,{className:"w-4 h-4"})}),t.jsx(i.z,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700",onClick:()=>_(e.id),children:t.jsx(T.Z,{className:"w-4 h-4"})})]})]})},e.id))}),t.jsx(C.Vq,{open:b,onOpenChange:w,children:(0,t.jsxs)(C.cZ,{className:"max-w-5xl h-[90vh] flex flex-col p-0",children:[t.jsx(C.fK,{className:"px-6 py-4 border-b flex-shrink-0",children:t.jsx(C.$N,{children:p?"Edit Theme":"New Theme"})}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 flex",children:[t.jsx("div",{className:"w-1/2 flex flex-col min-h-0",children:(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Theme Name"}),t.jsx(o.I,{value:f,onChange:e=>y(e.target.value),placeholder:"Enter theme name"})]}),u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(c._,{className:"text-sm font-semibold",children:"Page Header"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[t.jsx(Y,{label:"Border Color",value:u.header.borderColor,onChange:e=>E(["header","borderColor"],e)}),t.jsx(Y,{label:"Title Color",value:u.header.titleColor,onChange:e=>E(["header","titleColor"],e)}),t.jsx(Y,{label:"Subtitle Color",value:u.header.subtitleColor,onChange:e=>E(["header","subtitleColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(c._,{className:"text-sm font-semibold",children:"Category Header"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[t.jsx(Y,{label:"Background Primary",value:u.categoryHeader.backgroundPrimary,onChange:e=>E(["categoryHeader","backgroundPrimary"],e)}),t.jsx(Y,{label:"Background Secondary",value:u.categoryHeader.backgroundSecondary,onChange:e=>E(["categoryHeader","backgroundSecondary"],e)}),t.jsx(Y,{label:"Text Color",value:u.categoryHeader.textColor,onChange:e=>E(["categoryHeader","textColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(c._,{className:"text-sm font-semibold",children:"Table"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[t.jsx(Y,{label:"Header Background",value:u.table.headerBackground,onChange:e=>E(["table","headerBackground"],e)}),t.jsx(Y,{label:"Header Text Color",value:u.table.headerTextColor,onChange:e=>E(["table","headerTextColor"],e)}),t.jsx(Y,{label:"Border Color",value:u.table.borderColor,onChange:e=>E(["table","borderColor"],e)}),t.jsx(Y,{label:"Body Text Color",value:u.table.bodyTextColor,onChange:e=>E(["table","bodyTextColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(c._,{className:"text-sm font-semibold",children:"Subtotal Row"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[t.jsx(Y,{label:"Background",value:u.subtotalRow.background,onChange:e=>E(["subtotalRow","background"],e)}),t.jsx(Y,{label:"Border Color",value:u.subtotalRow.borderColor,onChange:e=>E(["subtotalRow","borderColor"],e)}),t.jsx(Y,{label:"Text Color",value:u.subtotalRow.textColor,onChange:e=>E(["subtotalRow","textColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(c._,{className:"text-sm font-semibold",children:"Note Row"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[t.jsx(Y,{label:"Background",value:u.noteRow.background,onChange:e=>E(["noteRow","background"],e)}),t.jsx(Y,{label:"Text Color",value:u.noteRow.textColor,onChange:e=>E(["noteRow","textColor"],e)})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(c._,{className:"text-sm font-semibold",children:"Final Total"}),(0,t.jsxs)("div",{className:"pl-2 border-l-2 border-gray-200",children:[t.jsx(Y,{label:"Background",value:u.totals.finalTotalBackground,onChange:e=>E(["totals","finalTotalBackground"],e)}),t.jsx(Y,{label:"Text Color",value:u.totals.finalTotalTextColor,onChange:e=>E(["totals","finalTotalTextColor"],e)})]})]})]})]})}),(0,t.jsxs)("div",{className:"w-1/2 border-l flex flex-col min-h-0",children:[t.jsx("div",{className:"px-6 py-3 border-b flex-shrink-0",children:t.jsx(c._,{children:"Preview"})}),t.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:u&&t.jsx(K,{config:u})})]})]}),(0,t.jsxs)(C.cN,{className:"px-6 py-4 border-t flex-shrink-0",children:[t.jsx(i.z,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),t.jsx(i.z,{onClick:Z,disabled:m,children:m?(0,t.jsxs)(t.Fragment,{children:[t.jsx(j.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Saving..."]}):"Save Theme"})]})]})})]})}var ee=a(31606),es=a(35825),ea=a(83898),et=a(23422);let er=(0,f.Z)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var el=a(27221);let en={starter:{key:"starter",name:"Starter",priceId:"",price:19,boqLimit:10,description:"10 BOQ creations per month"},business:{key:"business",name:"Business",priceId:"",price:39,boqLimit:null,description:"Unlimited BOQ creations"}};function ei({isAdmin:e}){let[s,a]=(0,r.useState)(null),[l,n]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[p,h]=(0,r.useState)(!1),[g,f]=(0,r.useState)(""),[y,b]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),C=async s=>{if(!e){v.ZP.error("Only company admins can manage billing");return}x(s);try{let e=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planKey:s,promoCode:g||void 0})}),a=await e.json();if(!e.ok)throw Error(a.error||"Failed to create checkout session");window.open(a.url,"_blank")}catch(e){v.ZP.error(e instanceof Error?e.message:"Failed to start checkout")}finally{x(null)}},k=async()=>{if(!e){v.ZP.error("Only company admins can manage billing");return}h(!0);try{let e=await fetch("/api/billing/portal",{method:"POST"}),s=await e.json();if(!e.ok)throw Error(s.error||"Failed to open billing portal");window.open(s.url,"_blank")}catch(e){v.ZP.error(e instanceof Error?e.message:"Failed to open billing portal")}finally{h(!1)}},S=async()=>{if(!g.trim()){w(null);return}b(!0);try{let e=await fetch("/api/billing/validate-promo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g})}),s=await e.json();w({valid:e.ok,message:s.message||(e.ok?"Valid promo code!":"Invalid promo code")})}catch(e){w({valid:!1,message:"Failed to validate promo code"})}finally{b(!1)}};if(l)return t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(j.Z,{className:"w-8 h-8 animate-spin text-primary"})});let P=s?.hasActiveSubscription,T=s?.planKey?en[s.planKey]:null;return(0,t.jsxs)("div",{className:"space-y-6",children:[P&&T&&(0,t.jsxs)(d.Zb,{className:"shadow-md border-0 bg-gradient-to-br from-emerald-50 to-teal-50",children:[t.jsx(d.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-400 rounded-lg flex items-center justify-center",children:t.jsx(u.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[t.jsx(d.ll,{className:"text-lg",children:"Current Subscription"}),t.jsx(d.SZ,{children:"Your active plan details"})]})]}),t.jsx(ee.C,{variant:s?.status==="active"?"default":"secondary",className:"capitalize",children:s?.status==="trialing"?"Trial":s?.status})]})}),(0,t.jsxs)(d.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Plan"}),t.jsx("p",{className:"text-lg font-semibold",children:T.name})]}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Price"}),(0,t.jsxs)("p",{className:"text-lg font-semibold",children:["$",T.price,"/month"]})]}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"BOQs This Period"}),(0,t.jsxs)("p",{className:"text-lg font-semibold",children:[s?.boqsUsedThisPeriod??0,s?.boqLimit?` / ${s.boqLimit}`:" (unlimited)"]})]}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Renews On"}),t.jsx("p",{className:"text-lg font-semibold",children:s?.currentPeriodEnd?(0,el.WU)(new Date(s.currentPeriodEnd),"MMM d, yyyy"):"-"})]})]}),s?.cancelAtPeriodEnd&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-amber-100 text-amber-800 rounded-lg",children:[t.jsx(es.Z,{className:"w-5 h-5"}),t.jsx("span",{children:"Your subscription will cancel at the end of this billing period"})]}),e&&t.jsx("div",{className:"flex gap-3 pt-2",children:(0,t.jsxs)(i.z,{onClick:k,disabled:p,variant:"outline",className:"flex items-center gap-2",children:[p?t.jsx(j.Z,{className:"w-4 h-4 animate-spin"}):t.jsx(ea.Z,{className:"w-4 h-4"}),"Manage Billing"]})})]})]}),(!P||T?.key==="starter")&&(0,t.jsxs)(d.Zb,{className:"shadow-md border-0",children:[t.jsx(d.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-violet-400 to-purple-400 rounded-lg flex items-center justify-center",children:t.jsx(et.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[t.jsx(d.ll,{className:"text-lg",children:P?"Upgrade Your Plan":"Choose a Plan"}),t.jsx(d.SZ,{children:P?"Get unlimited BOQ creations":"Subscribe to start creating BOQs"})]})]})}),(0,t.jsxs)(d.aY,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(c._,{htmlFor:"promoCode",className:"flex items-center gap-2",children:[t.jsx(er,{className:"w-4 h-4"}),"Promo Code (Optional)"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx(o.I,{id:"promoCode",value:g,onChange:e=>{f(e.target.value.toUpperCase()),w(null)},placeholder:"Enter promo code",className:"uppercase"}),t.jsx(i.z,{variant:"outline",onClick:S,disabled:y||!g.trim(),children:y?t.jsx(j.Z,{className:"w-4 h-4 animate-spin"}):"Apply"})]}),N&&t.jsx("p",{className:`text-sm ${N.valid?"text-emerald-600":"text-red-600"}`,children:N.message})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:`relative rounded-xl border-2 p-6 transition-all ${T?.key==="starter"?"border-emerald-400 bg-emerald-50":"border-gray-200 hover:border-primary/50"}`,children:[T?.key==="starter"&&t.jsx(ee.C,{className:"absolute -top-3 left-4 bg-emerald-500",children:"Current Plan"}),t.jsx("h3",{className:"text-xl font-bold",children:"Starter"}),(0,t.jsxs)("div",{className:"mt-2",children:[t.jsx("span",{className:"text-3xl font-bold",children:"$19"}),t.jsx("span",{className:"text-gray-500",children:"/month"})]}),(0,t.jsxs)("ul",{className:"mt-4 space-y-2",children:[(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),"10 BOQ creations per month"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),"PDF export with themes"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),"Custom cover pages"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),"Customer management"]})]}),T?.key!=="starter"&&e&&(0,t.jsxs)(i.z,{className:"w-full mt-6",variant:"outline",onClick:()=>C("starter"),disabled:"starter"===m,children:["starter"===m?t.jsx(j.Z,{className:"w-4 h-4 animate-spin mr-2"}):null,P?"Switch to Starter":"Get Started"]})]}),(0,t.jsxs)("div",{className:`relative rounded-xl border-2 p-6 transition-all ${T?.key==="business"?"border-emerald-400 bg-emerald-50":"border-primary bg-gradient-to-br from-primary/5 to-primary/10"}`,children:[T?.key==="business"&&t.jsx(ee.C,{className:"absolute -top-3 left-4 bg-emerald-500",children:"Current Plan"}),T?.key!=="business"&&t.jsx(ee.C,{className:"absolute -top-3 left-4 bg-primary",children:"Recommended"}),t.jsx("h3",{className:"text-xl font-bold",children:"Business"}),(0,t.jsxs)("div",{className:"mt-2",children:[t.jsx("span",{className:"text-3xl font-bold",children:"$39"}),t.jsx("span",{className:"text-gray-500",children:"/month"})]}),(0,t.jsxs)("ul",{className:"mt-4 space-y-2",children:[(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),t.jsx("strong",{children:"Unlimited"})," BOQ creations"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),"PDF export with themes"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),"Custom cover pages"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),"Customer management"]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[t.jsx($.Z,{className:"w-4 h-4 text-emerald-500"}),"Priority support"]})]}),T?.key!=="business"&&e&&(0,t.jsxs)(i.z,{className:"w-full mt-6",onClick:()=>C("business"),disabled:"business"===m,children:["business"===m?t.jsx(j.Z,{className:"w-4 h-4 animate-spin mr-2"}):null,T?.key==="starter"?"Upgrade to Business":"Get Business"]})]})]}),!e&&t.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Contact your company admin to manage billing."})]})]})]})}function eo({company:e,isAdmin:s}){(0,l.useSearchParams)();let[a,f]=(0,r.useState)(e),[w,C]=(0,r.useState)(!1),[k,S]=(0,r.useState)("company"),P=async()=>{C(!0);try{if(!(await fetch("/api/company",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a?.name,currencySymbol:a?.currencySymbol,currencyPosition:a?.currencyPosition,defaultVatPercent:a?.defaultVatPercent})})).ok)throw Error("Failed to save");v.ZP.success("Settings saved successfully")}catch(e){v.ZP.error("Failed to save settings")}finally{C(!1)}};return t.jsx(n.AppLayout,{children:(0,t.jsxs)("div",{className:"p-6 max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),t.jsx("p",{className:"text-gray-500 mt-1",children:"Manage your company and PDF settings"})]}),(0,t.jsxs)(x.mQ,{value:k,onValueChange:S,className:"space-y-6",children:[(0,t.jsxs)(x.dr,{className:"grid w-full grid-cols-3 max-w-lg",children:[(0,t.jsxs)(x.SP,{value:"company",className:"flex items-center gap-2",children:[t.jsx(p.Z,{className:"w-4 h-4"}),"Company"]}),(0,t.jsxs)(x.SP,{value:"pdf",className:"flex items-center gap-2",children:[t.jsx(h.Z,{className:"w-4 h-4"}),"PDF Templates"]}),(0,t.jsxs)(x.SP,{value:"billing",className:"flex items-center gap-2",children:[t.jsx(u.Z,{className:"w-4 h-4"}),"Billing"]})]}),(0,t.jsxs)(x.nU,{value:"company",className:"space-y-6",children:[(0,t.jsxs)(d.Zb,{className:"shadow-md border-0",children:[t.jsx(d.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-cyan-400 to-teal-400 rounded-lg flex items-center justify-center",children:t.jsx(p.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[t.jsx(d.ll,{className:"text-lg",children:"Company Information"}),t.jsx(d.SZ,{children:"Update your company details"})]})]})}),t.jsx(d.aY,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{htmlFor:"companyName",children:"Company Name"}),t.jsx(o.I,{id:"companyName",value:a?.name??"",onChange:e=>f({...a??{},name:e.target.value}),placeholder:"Enter company name"})]})})]}),(0,t.jsxs)(d.Zb,{className:"shadow-md border-0",children:[t.jsx(d.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-400 to-green-400 rounded-lg flex items-center justify-center",children:t.jsx(g.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[t.jsx(d.ll,{className:"text-lg",children:"Currency Settings"}),t.jsx(d.SZ,{children:"Configure how currency is displayed"})]})]})}),(0,t.jsxs)(d.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{htmlFor:"currencySymbol",children:"Currency Symbol"}),t.jsx(o.I,{id:"currencySymbol",value:a?.currencySymbol??"",onChange:e=>f({...a??{},currencySymbol:e.target.value}),placeholder:"Rs."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{htmlFor:"currencyPosition",children:"Symbol Position"}),(0,t.jsxs)(m.Ph,{value:a?.currencyPosition??"left",onValueChange:e=>f({...a??{},currencyPosition:e}),children:[t.jsx(m.i4,{children:t.jsx(m.ki,{})}),(0,t.jsxs)(m.Bw,{children:[(0,t.jsxs)(m.Ql,{value:"left",children:["Left (",a?.currencySymbol||"Rs.","1,000)"]}),(0,t.jsxs)(m.Ql,{value:"right",children:["Right (1,000",a?.currencySymbol||"Rs.",")"]})]})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Preview"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a?.currencyPosition==="left"?`${a?.currencySymbol??"Rs."}1,234.56`:`1,234.56${a?.currencySymbol??"Rs."}`})]})]})]}),(0,t.jsxs)(d.Zb,{className:"shadow-md border-0",children:[t.jsx(d.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-400 to-indigo-400 rounded-lg flex items-center justify-center",children:t.jsx(y,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[t.jsx(d.ll,{className:"text-lg",children:"Default VAT Settings"}),t.jsx(d.SZ,{children:"Set the default VAT percentage for new BOQs"})]})]})}),t.jsx(d.aY,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{htmlFor:"defaultVatPercent",children:"Default VAT Percentage"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[t.jsx(o.I,{id:"defaultVatPercent",type:"number",step:"0.01",min:"0",max:"100",value:a?.defaultVatPercent??18,onChange:e=>f({...a??{},defaultVatPercent:parseFloat(e.target.value)||0}),className:"w-24"}),t.jsx("span",{className:"text-gray-500",children:"%"})]}),t.jsx("p",{className:"text-sm text-gray-500",children:"This percentage will be used as the default VAT for all new BOQs."})]})})]}),t.jsx(i.z,{onClick:P,disabled:w,className:"w-full",children:w?(0,t.jsxs)(t.Fragment,{children:[t.jsx(j.Z,{className:"w-4 h-4 animate-spin mr-2"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(b,{className:"w-4 h-4 mr-2"}),"Save Settings"]})})]}),(0,t.jsxs)(x.nU,{value:"pdf",className:"space-y-8",children:[(0,t.jsxs)(d.Zb,{className:"shadow-md border-0",children:[t.jsx(d.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-cyan-400 to-teal-400 rounded-lg flex items-center justify-center",children:t.jsx(h.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[t.jsx(d.ll,{className:"text-lg",children:"Cover Page Templates"}),t.jsx(d.SZ,{children:"Customize cover page content and formatting"})]})]})}),t.jsx(d.aY,{children:t.jsx(G,{companyName:a?.name??"Company"})})]}),(0,t.jsxs)(d.Zb,{className:"shadow-md border-0",children:[t.jsx(d.Ol,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-lg flex items-center justify-center",children:t.jsx(N.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[t.jsx(d.ll,{className:"text-lg",children:"BOQ Color Themes"}),t.jsx(d.SZ,{children:"Customize colors and shading for BOQ pages"})]})]})}),t.jsx(d.aY,{children:t.jsx(X,{companyName:a?.name??"Company"})})]})]}),t.jsx(x.nU,{value:"billing",children:t.jsx(ei,{isAdmin:s})})]})]})})}},31606:(e,s,a)=>{"use strict";a.d(s,{C:()=>i});var t=a(62901);a(24383);var r=a(47279),l=a(68637);let n=(0,r.j)("inline-flex items-center rounded-full border px-3 py-1 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-gradient-to-r from-purple-500 to-lavender-500 text-white",secondary:"border-transparent bg-purple-100 text-purple-700 hover:bg-purple-200",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"border-purple-200 text-purple-700 bg-white",success:"border-transparent bg-emerald-100 text-emerald-700",warning:"border-transparent bg-amber-100 text-amber-700"}},defaultVariants:{variant:"default"}});function i({className:e,variant:s,...a}){return t.jsx("div",{className:(0,l.cn)(n({variant:s}),e),...a})}},65923:(e,s,a)=>{"use strict";a.d(s,{$N:()=>u,Be:()=>g,Vq:()=>o,cN:()=>h,cZ:()=>x,fK:()=>p,hg:()=>d});var t=a(62901),r=a(24383),l=a(18832),n=a(42594),i=a(68637);let o=l.fC,d=l.xz,c=l.h_;l.x8;let m=r.forwardRef(({className:e,...s},a)=>t.jsx(l.aV,{ref:a,className:(0,i.cn)("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));m.displayName=l.aV.displayName;let x=r.forwardRef(({className:e,children:s,...a},r)=>(0,t.jsxs)(c,{children:[t.jsx(m,{}),(0,t.jsxs)(l.VY,{ref:r,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-purple-100 bg-white p-6 shadow-xl duration-200","rounded-2xl","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...a,children:[s,(0,t.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-lg p-1.5 text-muted-foreground transition-colors hover:bg-purple-100 hover:text-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-200 disabled:pointer-events-none",children:[t.jsx(n.Z,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));x.displayName=l.VY.displayName;let p=({className:e,...s})=>t.jsx("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});p.displayName="DialogHeader";let h=({className:e,...s})=>t.jsx("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});h.displayName="DialogFooter";let u=r.forwardRef(({className:e,...s},a)=>t.jsx(l.Dx,{ref:a,className:(0,i.cn)("text-xl font-semibold leading-none tracking-tight text-foreground",e),...s}));u.displayName=l.Dx.displayName;let g=r.forwardRef(({className:e,...s},a)=>t.jsx(l.dk,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",e),...s}));g.displayName=l.dk.displayName},250:(e,s,a)=>{"use strict";a.d(s,{I:()=>n});var t=a(62901),r=a(24383),l=a(68637);let n=r.forwardRef(({className:e,type:s,...a},r)=>t.jsx("input",{type:s,className:(0,l.cn)("flex h-11 w-full rounded-xl border-2 border-purple-100 bg-white px-4 py-2 text-sm text-foreground transition-all duration-200","placeholder:text-muted-foreground","hover:border-purple-200","focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-muted","file:border-0 file:bg-transparent file:text-sm file:font-medium",e),ref:r,...a}));n.displayName="Input"},82657:(e,s,a)=>{"use strict";a.d(s,{_:()=>d});var t=a(62901),r=a(24383),l=a(8388),n=a(47279),i=a(68637);let o=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef(({className:e,...s},a)=>t.jsx(l.f,{ref:a,className:(0,i.cn)(o(),e),...s}));d.displayName=l.f.displayName},72388:(e,s,a)=>{"use strict";a.d(s,{Bw:()=>u,Ph:()=>c,Ql:()=>g,i4:()=>x,ki:()=>m});var t=a(62901),r=a(24383),l=a(76960),n=a(7259),i=a(26026),o=a(85453),d=a(68637);let c=l.fC;l.ZA;let m=l.B4,x=r.forwardRef(({className:e,children:s,...a},r)=>(0,t.jsxs)(l.xz,{ref:r,className:(0,d.cn)("flex h-11 w-full items-center justify-between gap-2 rounded-xl border-2 border-purple-100 bg-white px-4 py-2 text-sm","transition-all duration-200","placeholder:text-muted-foreground","hover:border-purple-200","focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-100","disabled:cursor-not-allowed disabled:opacity-50","[&>span]:line-clamp-1",e),...a,children:[s,t.jsx(l.JO,{asChild:!0,children:t.jsx(n.Z,{className:"h-4 w-4 text-purple-400 transition-transform duration-200"})})]}));x.displayName=l.xz.displayName;let p=r.forwardRef(({className:e,...s},a)=>t.jsx(l.u_,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1 text-purple-400",e),...s,children:t.jsx(i.Z,{className:"h-4 w-4"})}));p.displayName=l.u_.displayName;let h=r.forwardRef(({className:e,...s},a)=>t.jsx(l.$G,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1 text-purple-400",e),...s,children:t.jsx(n.Z,{className:"h-4 w-4"})}));h.displayName=l.$G.displayName;let u=r.forwardRef(({className:e,children:s,position:a="popper",...r},n)=>t.jsx(l.h_,{children:(0,t.jsxs)(l.VY,{ref:n,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-xl border border-purple-100 bg-white shadow-lg","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2","data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...r,children:[t.jsx(p,{}),t.jsx(l.l_,{className:(0,d.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),t.jsx(h,{})]})}));u.displayName=l.VY.displayName,r.forwardRef(({className:e,...s},a)=>t.jsx(l.__,{ref:a,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold text-purple-700",e),...s})).displayName=l.__.displayName;let g=r.forwardRef(({className:e,children:s,...a},r)=>(0,t.jsxs)(l.ck,{ref:r,className:(0,d.cn)("relative flex w-full cursor-pointer select-none items-center rounded-lg py-2 pl-8 pr-2 text-sm outline-none","transition-colors duration-150","hover:bg-purple-50 hover:text-purple-700","focus:bg-purple-50 focus:text-purple-700","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(l.wU,{children:t.jsx(o.Z,{className:"h-4 w-4 text-purple-500"})})}),t.jsx(l.eT,{children:s})]}));g.displayName=l.ck.displayName,r.forwardRef(({className:e,...s},a)=>t.jsx(l.Z0,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-purple-100",e),...s})).displayName=l.Z0.displayName},84377:(e,s,a)=>{"use strict";a.d(s,{r:()=>i});var t=a(62901),r=a(24383),l=a(59094),n=a(68637);let i=r.forwardRef(({className:e,...s},a)=>t.jsx(l.fC,{className:(0,n.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-all duration-200","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-gradient-to-r data-[state=checked]:from-purple-500 data-[state=checked]:to-lavender-500","data-[state=unchecked]:bg-purple-200",e),...s,ref:a,children:t.jsx(l.bU,{className:(0,n.cn)("pointer-events-none block h-5 w-5 rounded-full bg-white shadow-md ring-0 transition-transform duration-200","data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));i.displayName=l.fC.displayName},84227:(e,s,a)=>{"use strict";a.d(s,{SP:()=>d,dr:()=>o,mQ:()=>i,nU:()=>c});var t=a(62901),r=a(24383),l=a(61380),n=a(68637);let i=l.fC,o=r.forwardRef(({className:e,...s},a)=>t.jsx(l.aV,{ref:a,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));o.displayName=l.aV.displayName;let d=r.forwardRef(({className:e,...s},a)=>t.jsx(l.xz,{ref:a,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));d.displayName=l.xz.displayName;let c=r.forwardRef(({className:e,...s},a)=>t.jsx(l.VY,{ref:a,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));c.displayName=l.VY.displayName},35825:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(71945).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},76244:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(71945).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},79357:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(71945).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},83898:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(71945).Z)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},91334:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(71945).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},23422:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});let t=(0,a(71945).Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]])},53218:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>c,dynamic:()=>d});var t=a(83537),r=a(57978),l=a(86023),n=a(15438),i=a(83178);let o=(0,a(88895).createProxy)(String.raw`/home/ubuntu/make_estimate/nextjs_space/app/app/settings/_components/settings-client.tsx#SettingsClient`),d="force-dynamic";async function c(){let e=await (0,r.getServerSession)(l.L);e?.user||(0,n.redirect)("/login");let s=e.user?.companyId,a=e.user?.id;s||(0,n.redirect)("/login");let[d,c]=await Promise.all([i._.company.findUnique({where:{id:s}}),i._.companyMembership.findFirst({where:{userId:a,companyId:s}})]);d||(0,n.redirect)("/app/dashboard");let m=c?.role==="ADMIN";return t.jsx(o,{company:JSON.parse(JSON.stringify(d)),isAdmin:m})}},86023:(e,s,a)=>{"use strict";a.d(s,{L:()=>i});var t=a(66291),r=a(3390),l=a.n(r),n=a(83178);let i={providers:[(0,t.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let s=await n._.user.findUnique({where:{email:e.email},include:{memberships:{include:{company:!0}}}});if(!s||!await l().compare(e.password,s.password))return null;await n._.user.update({where:{id:s.id},data:{lastLoginAt:new Date}}).catch(e=>console.error("Failed to update lastLoginAt:",e));let a=s?.memberships?.[0];return{id:s.id,email:s.email,name:s.name,companyId:a?.companyId??null,companyName:a?.company?.name??null,role:a?.role??"MEMBER"}}})],callbacks:{jwt:async({token:e,user:s})=>(s&&(e.id=s.id,e.companyId=s.companyId,e.companyName=s.companyName,e.role=s.role),e),session:async({session:e,token:s})=>(e?.user&&(e.user.id=s.id,e.user.companyId=s.companyId,e.user.companyName=s.companyName,e.user.role=s.role),e)},pages:{signIn:"/login"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET}},83178:(e,s,a)=>{"use strict";a.d(s,{_:()=>l});var t=a(53524),r=a(53609);let l=globalThis.prisma??function(){let e=new t.PrismaClient({log:[{level:"error",emit:"stdout"},{level:"warn",emit:"stdout"}]});return"true"===process.env.ENABLE_QUERY_LOGGING&&e.$on("query",e=>{let s=e.duration;(0,r.mV)({query:e.query,params:e.params,durationMs:s,timestamp:new Date,model:function(e){let s=e.match(/FROM\s+["']?public["']?\.?["']?(\w+)["']?/i),a=e.match(/INSERT\s+INTO\s+["']?public["']?\.?["']?(\w+)["']?/i),t=e.match(/UPDATE\s+["']?public["']?\.?["']?(\w+)["']?/i),r=e.match(/DELETE\s+FROM\s+["']?public["']?\.?["']?(\w+)["']?/i);return(s?.[1]||a?.[1]||t?.[1]||r?.[1]||"unknown").toLowerCase()}(e.query),action:function(e){let s=e.trim().toUpperCase();return s.startsWith("SELECT")?"select":s.startsWith("INSERT")?"insert":s.startsWith("UPDATE")?"update":s.startsWith("DELETE")?"delete":s.startsWith("BEGIN")?"transaction":s.startsWith("COMMIT")?"commit":"other"}(e.query)})}),e}()},53609:(e,s,a)=>{"use strict";a.d(s,{$B:()=>n,AT:()=>c,H:()=>o,eF:()=>d,mV:()=>i});let t=parseInt(process.env.SLOW_QUERY_THRESHOLD||"500",10),r=[],l=[];function n(e){let s=e.durationMs>1e3?"warn":"info",a={type:"REQUEST_METRICS",...e,timestamp:e.timestamp.toISOString()};"warn"===s?console.warn(`[SLOW_REQUEST] ${e.method} ${e.endpoint} took ${e.durationMs}ms`,JSON.stringify(a)):"true"===process.env.VERBOSE_LOGGING&&console.log(`[REQUEST] ${e.method} ${e.endpoint} - ${e.durationMs}ms`,JSON.stringify(a)),r.push(e),r.length>1e3&&r.shift()}function i(e){e.durationMs>=t&&(console.warn(`[SLOW_QUERY] ${e.model}.${e.action} took ${e.durationMs}ms`,JSON.stringify({type:"SLOW_QUERY",...e,timestamp:e.timestamp.toISOString()})),l.push(e),l.length>1e3&&l.shift())}function o(e,s){console.error(`[ERROR] ${s.action||s.endpoint||"Unknown"}`,JSON.stringify({type:"APP_ERROR",message:e.message,stack:e.stack,name:e.name,...s,timestamp:new Date().toISOString()}))}function d(){let e=performance.now();return{elapsed:()=>Math.round(performance.now()-e)}}function c(){return{requests:r.slice(-100),slowQueries:l.slice(-100),summary:{totalRequests:r.length,slowRequests:r.filter(e=>e.durationMs>1e3).length,slowQueries:l.length,avgRequestTime:r.length>0?Math.round(r.reduce((e,s)=>e+s.durationMs,0)/r.length):0}}}}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[4372,7329,5990,5410,1263,2392,5952,7463,7221,3153,1108,9845],()=>a(85274));module.exports=t})();